(()=>{"use strict";class e extends Error{constructor(e,t){super(e),this.name="AjaxError",this.statusCode=t}}const t=()=>{},n="rpsession-ping";var o,s=null,r=null,a=0;function i(){return-(new Date).getTimezoneOffset()}function c(){return window.scrollY}function d(){return"visible"===document.visibilityState}function u(o){if(t("sendSessionHeartbeatIfNeeded",n,o),!o&&!d()&&!r)return void t("Document is hidden, not sending session heartbeat");const u=c(),l=u!==s;t("sendSessionHeartbeatIfNeeded",u,s,l,r);const m=(new Date).getTime(),f=function(){try{let e=parseInt(localStorage.getItem(n),10);if(Number.isNaN(e))throw Error("NaN");return t("getLastSyncTime",e,"(localStorage)"),e}catch(e){return t("getLastSyncTime",a,"(in-memory)"),a}}();(l||r||0==f)&&(o||m-f>=12e4||0===f)?(o?function(){const e={tzoffset:i()};t("sendSessionHeartbeatBeacon ping",e),navigator.sendBeacon("/api/v1/session/",JSON.stringify(e))}():function(){const n={tzoffset:i()};var o;t("sendSessionHeartbeat ping",n),o={url:"/api/v1/session/",data:n,onError:e=>{t(e)},onSuccess:e=>{t(e)}},fetch(o.url,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","X-CSRFToken":function(e){var t=null;if(document.cookie&&""!==document.cookie)for(var n=document.cookie.split(";"),o=0;o<n.length;o++){var s=n[o].trim();if(s.substring(0,10)===e+"="){t=decodeURIComponent(s.substring(10));break}}return t}("csrftoken")},credentials:"same-origin",body:o.data?JSON.stringify(o.data):""}).then((t=>{if(!t.ok)throw new e(t.statusText,t.status);return 204===t.status?{}:t.json()})).then((e=>{o.onSuccess&&o.onSuccess(e)})).catch((e=>{o.onError&&o.onError(e)}))}(),s=c(),r=!1,function(e){t("setLastSyncTime",e),a=e;try{localStorage.setItem(n,e),t("setLastSyncTime: updated localStorage")}catch(e){t("setLastSyncTime: updated in-memory only")}}(m)):t("Not sending session heartbeat",m,f)}function l(){r=!0}o=()=>{u(!1),setInterval((()=>u(!1)),1e4),addEventListener("mousemove",l),addEventListener("mousedown",l),addEventListener("touchstart",l),addEventListener("keydown",l),navigator.sendBeacon&&addEventListener("visibilitychange",(()=>{d()||u(!0)}))},"complete"===document.readyState||"loading"!==document.readyState&&!document.documentElement.doScroll?o():document.addEventListener("DOMContentLoaded",o)})();
<!DOCTYPE html>
<!-- saved from url=(0060)https://realpython.com/build-llm-rag-chatbot-with-langchain/ -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><script type="text/javascript" src="./Build an LLM RAG Chatbot With LangChain – Real Python_files/vendor.0c11f266.js"></script><script type="text/javascript" src="./Build an LLM RAG Chatbot With LangChain – Real Python_files/main.bead18e5.js"></script><script async="" src="./Build an LLM RAG Chatbot With LangChain – Real Python_files/gist.min.js"></script><script async="" src="./Build an LLM RAG Chatbot With LangChain – Real Python_files/in-app.js"></script><script type="text/javascript" async="" src="./Build an LLM RAG Chatbot With LangChain – Real Python_files/saved_resource"></script><script async="" src="./Build an LLM RAG Chatbot With LangChain – Real Python_files/fbevents.js"></script><script async="" id="cio-tracker" data-site-id="7c2f77c7758d22126955" data-use-array-params="true" data-in-app-org-id="0ed756ae-4cd1-4bb7-912c-1b37e39b6595" data-use-in-app="true" src="./Build an LLM RAG Chatbot With LangChain – Real Python_files/track.js"></script><script type="text/javascript" async="" src="./Build an LLM RAG Chatbot With LangChain – Real Python_files/js"></script><script async="" src="./Build an LLM RAG Chatbot With LangChain – Real Python_files/analytics.js"></script><script src="chrome-extension://fgddmllnllkalaagkghckoinaemmogpe/scripts/content/gps.js"></script>
    
    
    <link href="https://files.realpython.com/" rel="preconnect">

    <title>Build an LLM RAG Chatbot With LangChain – Real Python</title>
    <meta name="author" content="Real Python">
    <meta name="description" content="Large language models (LLMs) have taken the world by storm, demonstrating unprecedented capabilities in natural language tasks. In this step-by-step tutorial, you&#39;ll leverage LLMs to build your own retrieval-augmented generation (RAG) chatbot using synthetic data with LangChain and Neo4j.">
    <meta name="keywords" content="">

    
  


    
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no, viewport-fit=cover">

    
      <link rel="stylesheet" href="./Build an LLM RAG Chatbot With LangChain – Real Python_files/realpython.min.027f39c57fbf.css">
      <link rel="stylesheet" href="./Build an LLM RAG Chatbot With LangChain – Real Python_files/font.5ac42994de49.css">
      <link rel="stylesheet" href="./Build an LLM RAG Chatbot With LangChain – Real Python_files/glightbox.min.9b438b29cef1.css" as="style" onload="this.onload=null;this.rel=&#39;stylesheet&#39;"><noscript><link rel="stylesheet" href="/static/glightbox.min.9b438b29cef1.css"></noscript>
    

    
  
    <link rel="stylesheet" href="./Build an LLM RAG Chatbot With LangChain – Real Python_files/noty.d00a705eac12.css" as="style" onload="this.onload=null;this.rel=&#39;stylesheet&#39;"><noscript><link rel="stylesheet" href="/static/noty.d00a705eac12.css"></noscript>
  
  
  <link rel="preload" as="image" href="./Build an LLM RAG Chatbot With LangChain – Real Python_files/Build-a-LLM-Application-with-LangChain_Watermarked.b9d023202ad2.jpg" imagesrcset="/cdn-cgi/image/width=480,format=auto/https://files.realpython.com/media/Build-a-LLM-Application-with-LangChain_Watermarked.b9d023202ad2.jpg 480w, /cdn-cgi/image/width=640,format=auto/https://files.realpython.com/media/Build-a-LLM-Application-with-LangChain_Watermarked.b9d023202ad2.jpg 640w, /cdn-cgi/image/width=960,format=auto/https://files.realpython.com/media/Build-a-LLM-Application-with-LangChain_Watermarked.b9d023202ad2.jpg 960w, /cdn-cgi/image/width=1920,format=auto/https://files.realpython.com/media/Build-a-LLM-Application-with-LangChain_Watermarked.b9d023202ad2.jpg 1920w" imagesizes="(min-width: 1200px) 690px, (min-width: 780px) calc(-5vw + 669px), (min-width: 580px) 510px, calc(100vw - 30px)">


    
    
      <link rel="canonical" href="https://realpython.com/build-llm-rag-chatbot-with-langchain/">

      
      
        <meta name="twitter:card" content="summary_large_image">
        <meta name="twitter:image" content="https://files.realpython.com/media/Build-a-LLM-Application-with-LangChain_Watermarked.b9d023202ad2.jpg">
        <meta property="og:image" content="https://files.realpython.com/media/Build-a-LLM-Application-with-LangChain_Watermarked.b9d023202ad2.jpg">
      
      <meta name="twitter:creator" content="@realpython">
      <meta name="twitter:site" content="@realpython">
      <meta property="og:title" content="Build an LLM RAG Chatbot With LangChain – Real Python">
      <meta property="og:type" content="article">
      <meta property="og:url" content="https://realpython.com/build-llm-rag-chatbot-with-langchain/">
      <meta property="og:description" content="Large language models (LLMs) have taken the world by storm, demonstrating unprecedented capabilities in natural language tasks. In this step-by-step tutorial, you&#39;ll leverage LLMs to build your own retrieval-augmented generation (RAG) chatbot using synthetic data with LangChain and Neo4j.">
    

    <link href="https://realpython.com/static/favicon.68cbf4197b0c.png" rel="icon">
    <link href="https://realpython.com/atom.xml" rel="alternate" title="Real Python" type="application/atom+xml">
    <link rel="manifest" href="https://realpython.com/manifest.json">

    

    
    

    
    <script id="icons-data" type="application/json">{"iconsUrl": "/static/icons.67f62bbffdec.svg"}</script>
    <script id="optins-data" type="application/json">{"turnstileSiteKey": "0x4AAAAAAAQQUCLRXBi8NnUh"}</script>

    
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  

  ga('create', 'UA-35184939-1', 'auto', {'allowLinker': true});

  

  

  
  
  ga('set', {
    dimension1: true,
    dimension2: false
  });
  

  ga('send', 'pageview');
  
</script>


<script async="" src="./Build an LLM RAG Chatbot With LangChain – Real Python_files/js(1)"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-L7L6L5F6Y6');

  
</script>

  <script src="./Build an LLM RAG Chatbot With LangChain – Real Python_files/OneSignalSDK.page.es6.js" defer=""></script><script src="./Build an LLM RAG Chatbot With LangChain – Real Python_files/count-data.js"></script><link rel="stylesheet" href="./Build an LLM RAG Chatbot With LangChain – Real Python_files/OneSignalSDK.page.styles.css"><style hs-beacon="active" data-styled-version="5.1.1"></style></head>
  <body>
    
      

<nav class="navbar fixed-top navbar-expand-lg navbar-dark flex-column ">
  <div class="container flex-row">

    <a class="navbar-brand" href="https://realpython.com/">
      <img src="./Build an LLM RAG Chatbot With LangChain – Real Python_files/real-python-logo.893c30edea53.svg" width="165" height="40" class="d-inline-block align-top" alt="Real Python">
    </a>

    
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse navbar-nav-scroll" id="navbarSupportedContent" role="navigation" aria-label="Main Navigation">

      <ul class="navbar-nav mr-2">

        <li class="nav-item">
          <a class="nav-link" href="https://realpython.com/start-here/">Start&nbsp;Here</a>
        </li>

        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#" id="navbarDropdownLibrary" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            <span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#brands--python"></use></svg></span> Learn Python
          </a>
          <div class="dropdown-menu" aria-labelledby="navbarDropdownLibrary">
            
<a class="dropdown-item " href="https://realpython.com/search?kind=article&amp;kind=course&amp;order=newest" style="color: #ff7e73; line-height: 110%;"><span class="icon baseline mr-1"><svg><use href="/static/icons.67f62bbffdec.svg#solid--graduation-cap"></use></svg></span>Python Tutorials&nbsp;→<br><small class="text-secondary">In-depth articles and video courses</small></a>


            
<a class="dropdown-item " href="https://realpython.com/learning-paths/" style="color: #ffc873; line-height: 110%;"><span class="icon baseline mr-1"><svg><use href="/static/icons.67f62bbffdec.svg#@learning-path"></use></svg></span>Learning Paths&nbsp;→<br><small class="text-secondary">Guided study plans for accelerated learning</small></a>


            
<a class="dropdown-item " href="https://realpython.com/quizzes/" style="color: #abe0e5; line-height: 110%;"><span class="icon baseline mr-1"><svg><use href="/static/icons.67f62bbffdec.svg#@quiz"></use></svg></span>Quizzes&nbsp;→<br><small class="text-secondary">Check your learning progress</small></a>


            
<a class="dropdown-item " href="https://realpython.com/tutorials/all/" style="color: #ccc; line-height: 110%;"><span class="icon baseline mr-1"><svg><use href="/static/icons.67f62bbffdec.svg#@category"></use></svg></span>Browse Topics&nbsp;→<br><small class="text-secondary">Focus on a specific area or skill level</small></a>


            
<a class="dropdown-item " href="https://realpython.com/community/" style="color: #e5c6ab; line-height: 110%;"><span class="icon baseline mr-1"><svg><use href="/static/icons.67f62bbffdec.svg#solid--message-smile"></use></svg></span>Community Chat&nbsp;→<br><small class="text-secondary">Learn with other Pythonistas</small></a>


            
<a class="dropdown-item " href="https://realpython.com/office-hours/" style="color: #e5c6ab; line-height: 110%;"><span class="icon baseline mr-1"><svg><use href="/static/icons.67f62bbffdec.svg#solid--users"></use></svg></span>Office Hours&nbsp;→<br><small class="text-secondary">Live Q&amp;A calls with Python experts</small></a>


            
<a class="dropdown-item " href="https://realpython.com/podcasts/rpp/" style="color: #b8abe5; line-height: 110%;"><span class="icon baseline mr-1"><svg><use href="/static/icons.67f62bbffdec.svg#@podcast"></use></svg></span>Podcast&nbsp;→<br><small class="text-secondary">Hear what’s new in the world of Python</small></a>


            
<a class="dropdown-item " href="https://realpython.com/products/books/" style="color: #abe5b1; line-height: 110%;"><span class="icon baseline mr-1"><svg><use href="/static/icons.67f62bbffdec.svg#solid--book-heart"></use></svg></span>Books&nbsp;→<br><small class="text-secondary">Round out your knowledge and learn offline</small></a>


            
              
              
<a class="dropdown-item border-top text-warning" href="https://realpython.com/account/join/" style="line-height: 110%;"><span class="icon baseline mr-1"><svg><use href="/static/icons.67f62bbffdec.svg#solid--star"></use></svg></span>Unlock All Content&nbsp;→</a>

            
          </div>
        </li>

        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#" id="navbarDropdownMore" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            More
          </a>
          <div class="dropdown-menu" aria-labelledby="navbarDropdownMore">
            <a class="dropdown-item" href="https://realpython.com/learner-stories/">Learner Stories</a>
            <a class="dropdown-item" href="https://realpython.com/newsletter/">Python Newsletter</a>
            <a class="dropdown-item" href="https://www.pythonjobshq.com/" target="_blank">Python Job Board</a>
            <a class="dropdown-item" href="https://realpython.com/team/">Meet the Team</a>
            <a class="dropdown-item" href="https://realpython.com/write-for-us/">Become a Tutorial Writer</a>
            <a class="dropdown-item" href="https://realpython.com/become-an-instructor/">Become a Video Instructor</a>
          </div>
        </li>

      </ul> 

      
      <div class="d-block d-lg-none"> 
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link" href="https://realpython.com/search" title="Search"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#v4--search"></use></svg></span> Search</a>
          </li>
        </ul>
      </div>
      
      <div class="d-none d-lg-flex align-items-center mr-2 flex-fill">
        <form class="form-inline w-100 position-relative" action="https://realpython.com/search" method="GET">
          <a class="js-search-form-submit position-absolute" href="https://realpython.com/search" title="Search"><span class="icon baseline text-muted pl-2"><svg><use href="/static/icons.67f62bbffdec.svg#v4--search"></use></svg></span></a>
          <input class="search-autocomplete search-field form-control form-control-md mr-sm-1 mr-lg-2 w-100" style="padding-left: 2rem;" maxlength="50" type="search" placeholder="Search" aria-label="Search" aria-keyshortcuts="/ Control+J Meta+J" name="q" autocomplete="off">
          <span class="search-hotkey-indicator position-absolute px-2 border border-input text-input rounded small user-select-none" style="right: 1em;" title="Press / (forward slash) or Ctrl+J to open search" aria-hidden="true">/</span>
          <input type="hidden" name="_from" value="nav">
        </form>
      </div>
      

      <ul class="navbar-nav ml-auto">
        
          
          <li class="nav-item form-inline mr-2">
            <a class="btn btn-sm btn-primary px-3" href="https://realpython.com/account/join/">Join</a>
          </li>
          
          <li class="nav-item dropdown">
            <a class="ml-2 ml-lg-0 btn text-light p-0 my-2" href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#" id="navbarDropdownAccount" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" title="My Account">
              <div class="media">
                <img loading="lazy" class="align-self-center rounded rounded-circle mr-1 flex-shrink-0" style="width: 45px; height: 45px;" width="500" height="500" src="./Build an LLM RAG Chatbot With LangChain – Real Python_files/6173fa8cda8066fead7de185102927ed.png" alt="User avatar">
                <span id="NO_badge_cont" class="NO_visible"><span id="NO_badge" class="NO_visible"></span></span>
                <p class="align-self-center p-0 m-0 dropdown-toggle"></p>
              </div>
            </a>
            <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdownAccount">
              



  
    <a class="dropdown-item" href="https://realpython.com/account/notifications/"><span class="icon baseline mr-1"><svg><use href="/static/icons.67f62bbffdec.svg#solid--bell"></use></svg></span>Notifications <span class="badge badge-pill badge-danger">9+</span></a>
  


<a class="dropdown-item" href="https://realpython.com/account/"><span class="icon baseline mr-1"><svg><use href="/static/icons.67f62bbffdec.svg#solid--sliders"></use></svg></span>Manage Account</a>


  <a class="dropdown-item" href="https://realpython.com/account/join/"><span class="icon baseline text-warning mr-1"><svg><use href="/static/icons.67f62bbffdec.svg#solid--star"></use></svg></span>Get Full Access</a>


<a class="dropdown-item" href="https://realpython.com/search?status=in-progress&amp;order=recent"><span class="icon baseline mr-1"><svg><use href="/static/icons.67f62bbffdec.svg#@continue-learning"></use></svg></span>Continue Learning</a>

<a class="dropdown-item" href="https://realpython.com/account/bookmarks/"><span class="icon baseline mr-1"><svg><use href="/static/icons.67f62bbffdec.svg#solid--bookmark"></use></svg></span>Bookmarks</a>

<a class="dropdown-item" href="https://realpython.com/certificates/"><span class="icon baseline mr-1"><svg><use href="/static/icons.67f62bbffdec.svg#@certificate"></use></svg></span>Certificates</a>

<a class="dropdown-item" href="https://realpython.com/account/purchases/"><span class="icon baseline mr-1"><svg><use href="/static/icons.67f62bbffdec.svg#solid--cart-shopping"></use></svg></span>Purchases</a>





<a class="dropdown-item" href="https://realpython.com/account/logout/"><span class="icon baseline mr-1"><svg><use href="/static/icons.67f62bbffdec.svg#solid--right-from-bracket"></use></svg></span>Sign Out</a>

            </div>
          </li>
        
      </ul>

    
    </div>

  </div>

  

</nav>

    

    <div class="container main-content">
      

      
  <div class="row justify-content-center">

    
    <aside class="col-md-7 col-lg-4 order-2 d-none d-lg-block">
      
  




<div class="card mb-3 bg-secondary">
  <form class="card-body" action="https://realpython.com/optins/process/" method="post">
    <div class="form-group">
      <p class="h5 text-muted text-center">— FREE Email Series —</p>
      <p class="h3 text-center">🐍 Python Tricks 💌</p>
      <p><img loading="lazy" class="img-fluid rounded" src="./Build an LLM RAG Chatbot With LangChain – Real Python_files/pytrick-dict-merge.webp" width="738" height="490" alt="Python Tricks Dictionary Merge"></p>
    </div>
    <div class="form-group">
      <input type="hidden" name="csrfmiddlewaretoken" value="KV2gamRumCgJkMjOxEKxpyzE5kh0zbd6LLDrApShhsxqaR8gtZebMfI086Za77AV">
      <input type="hidden" name="slug" value="static-python-tricks-sidebar">
      <input type="email" class="form-control form-control-md" name="email" placeholder="Email…" required="">
    </div>
    <button type="submit" name="submit" class="btn btn-primary btn-md btn-block">Get Python Tricks »</button>
    <p class="mb-0 mt-2 text-muted text-center">🔒 No spam. Unsubscribe any time.</p>
  </form>
</div>


  


<div class="sidebar-module sidebar-module-inset border">
  <a href="https://realpython.com/tutorials/all/" class="badge badge-light text-muted"><span class="icon baseline mr-1"><svg><use href="/static/icons.67f62bbffdec.svg#@category"></use></svg></span>Browse Topics</a>

  <a href="https://realpython.com/learning-paths/" class="badge badge-light text-muted"><span class="icon baseline mr-1"><svg><use href="/static/icons.67f62bbffdec.svg#solid--map-location-dot"></use></svg></span>Guided Learning Paths</a>

  <br>

  <a href="https://realpython.com/search?level=basics" class="badge badge-light text-muted"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#v4--angle-double-up"></use></svg></span> Basics</a>

  <a href="https://realpython.com/search?level=intermediate" class="badge badge-light text-muted"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#v4--angle-double-up"></use></svg></span><span class="icon baseline tight-left"><svg><use href="/static/icons.67f62bbffdec.svg#v4--angle-double-up"></use></svg></span> Intermediate</a>

  <a href="https://realpython.com/search?level=advanced" class="badge badge-light text-muted"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#v4--angle-double-up"></use></svg></span><span class="icon baseline tight-left"><svg><use href="/static/icons.67f62bbffdec.svg#v4--angle-double-up"></use></svg></span><span class="icon baseline tight-left"><svg><use href="/static/icons.67f62bbffdec.svg#v4--angle-double-up"></use></svg></span> Advanced</a>

  <hr class="my-2">

  
    
  
    
    <a href="https://realpython.com/tutorials/api/" class="badge badge-light text-muted">api</a>
    
  
    
  
    
    <a href="https://realpython.com/tutorials/best-practices/" class="badge badge-light text-muted">best-practices</a>
    
  
    
    <a href="https://realpython.com/tutorials/career/" class="badge badge-light text-muted">career</a>
    
  
    
    <a href="https://realpython.com/tutorials/community/" class="badge badge-light text-muted">community</a>
    
  
    
    <a href="https://realpython.com/tutorials/databases/" class="badge badge-light text-muted">databases</a>
    
  
    
    <a href="https://realpython.com/tutorials/data-science/" class="badge badge-light text-muted">data-science</a>
    
  
    
    <a href="https://realpython.com/tutorials/data-structures/" class="badge badge-light text-muted">data-structures</a>
    
  
    
    <a href="https://realpython.com/tutorials/data-viz/" class="badge badge-light text-muted">data-viz</a>
    
  
    
    <a href="https://realpython.com/tutorials/devops/" class="badge badge-light text-muted">devops</a>
    
  
    
    <a href="https://realpython.com/tutorials/django/" class="badge badge-light text-muted">django</a>
    
  
    
    <a href="https://realpython.com/tutorials/docker/" class="badge badge-light text-muted">docker</a>
    
  
    
    <a href="https://realpython.com/tutorials/editors/" class="badge badge-light text-muted">editors</a>
    
  
    
    <a href="https://realpython.com/tutorials/flask/" class="badge badge-light text-muted">flask</a>
    
  
    
    <a href="https://realpython.com/tutorials/front-end/" class="badge badge-light text-muted">front-end</a>
    
  
    
    <a href="https://realpython.com/tutorials/gamedev/" class="badge badge-light text-muted">gamedev</a>
    
  
    
    <a href="https://realpython.com/tutorials/gui/" class="badge badge-light text-muted">gui</a>
    
  
    
  
    
    <a href="https://realpython.com/tutorials/machine-learning/" class="badge badge-light text-muted">machine-learning</a>
    
  
    
    <a href="https://realpython.com/tutorials/numpy/" class="badge badge-light text-muted">numpy</a>
    
  
    
    <a href="https://realpython.com/tutorials/projects/" class="badge badge-light text-muted">projects</a>
    
  
    
    <a href="https://realpython.com/tutorials/python/" class="badge badge-light text-muted">python</a>
    
  
    
    <a href="https://realpython.com/tutorials/testing/" class="badge badge-light text-muted">testing</a>
    
  
    
    <a href="https://realpython.com/tutorials/tools/" class="badge badge-light text-muted">tools</a>
    
  
    
    <a href="https://realpython.com/tutorials/web-dev/" class="badge badge-light text-muted">web-dev</a>
    
  
    
    <a href="https://realpython.com/tutorials/web-scraping/" class="badge badge-light text-muted">web-scraping</a>
    
  
</div>



  
<div class="sidebar-module sidebar-module-inset p-0" style="overflow:hidden;">
  
<div style="display:block;position:relative;">
  <div style="display:block;width:100%;padding-top:100%;"></div>
  <div class="rpad" data-unit="1x1" style="position:absolute;left:0;top:0;right:0;bottom:0;overflow:hidden;"></div>
</div>


</div>



  <div class="sidebar-sticky ">
    
      <div class="bg-light sidebar-module sidebar-module-inset" id="sidebar-toc">
        <p class="h4 text-muted"><a class="link-unstyled" href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#toc">Table of Contents</a></p>
        <div class="toc">
<ul>
<li class=""><a href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#demo-an-llm-rag-chatbot-with-langchain-and-neo4j">Demo: An LLM RAG Chatbot With LangChain and Neo4j</a></li>
<li class=""><a href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#prerequisites">Prerequisites</a></li>
<li class=""><a href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#project-overview">Project Overview</a></li>
<li class="active"><a href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#step-1-get-familiar-with-langchain">Step 1: Get Familiar With LangChain</a><ul>
<li><a href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#chat-models">Chat Models</a></li>
<li><a href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#prompt-templates">Prompt Templates</a></li>
<li><a href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#chains-and-langchain-expression-language-lcel">Chains and LangChain Expression Language (LCEL)</a></li>
<li><a href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#retrieval-objects">Retrieval Objects</a></li>
<li><a href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#agents">Agents</a></li>
</ul>
</li>
<li><a href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#step-2-understand-the-business-requirements-and-data">Step 2: Understand the Business Requirements and Data</a><ul>
<li><a href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#understand-the-problem-and-requirements">Understand the Problem and Requirements</a></li>
<li><a href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#explore-the-available-data">Explore the Available Data</a></li>
<li><a href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#design-the-chatbot">Design the Chatbot</a></li>
</ul>
</li>
<li><a href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#step-3-set-up-a-neo4j-graph-database">Step 3: Set Up a Neo4j Graph Database</a><ul>
<li><a href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#a-brief-overview-of-graph-databases">A Brief Overview of Graph Databases</a></li>
<li><a href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#create-a-neo4j-account-and-auradb-instance">Create a Neo4j Account and AuraDB Instance</a></li>
<li><a href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#design-the-hospital-system-graph-database">Design the Hospital System Graph Database</a></li>
<li><a href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#upload-data-to-neo4j">Upload Data to Neo4j</a></li>
<li><a href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#query-the-hospital-system-graph">Query the Hospital System Graph</a></li>
</ul>
</li>
<li><a href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#step-4-build-a-graph-rag-chatbot-in-langchain">Step 4: Build a Graph RAG Chatbot in LangChain</a><ul>
<li><a href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#create-a-neo4j-vector-chain">Create a Neo4j Vector Chain</a></li>
<li><a href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#create-a-neo4j-cypher-chain">Create a Neo4j Cypher Chain</a></li>
<li><a href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#create-wait-time-functions">Create Wait Time Functions</a></li>
<li><a href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#create-the-chatbot-agent">Create the Chatbot Agent</a></li>
</ul>
</li>
<li><a href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#step-5-deploy-the-langchain-agent">Step 5: Deploy the LangChain Agent</a><ul>
<li><a href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#serve-the-agent-with-fastapi">Serve the Agent With FastAPI</a></li>
<li><a href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#create-a-chat-ui-with-streamlit">Create a Chat UI With Streamlit</a></li>
<li><a href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#orchestrate-the-project-with-docker-compose">Orchestrate the Project With Docker Compose</a></li>
</ul>
</li>
<li><a href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#conclusion">Conclusion</a></li>
</ul>
</div>

      </div>
    

    <div class="sidebar-module sidebar-module-inset text-center my-3 py-0">
      
<div class="jsCompletionStatusWidget btn-group mb-0">
  <button title="Click to mark as completed" class="jsBtnCompletion btn btn-secondary border-right" style="border-top-right-radius: 0; border-bottom-right-radius: 0;">Mark as Completed</button>
  <button title="Add bookmark" class="jsBtnBookmark btn btn-secondary border-left"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#light--bookmark"></use></svg></span></button>
</div>

      <div class="my-2">
        
<div class="btn-group mb-0">
  <a class="btn btn-secondary border-right" style="border-top-right-radius: 0; border-bottom-right-radius: 0;" title="Liked it" role="button" aria-label="Thumbs up (liked it)" href="https://realpython.com/feedback/survey/article/build-llm-rag-chatbot-with-langchain/liked/?from=article-sidebar" target="_blank"><span class="icon"><svg><use href="/static/icons.67f62bbffdec.svg#light--thumbs-up"></use></svg></span></a> 
  <a class="btn btn-secondary border-left" role="button" aria-label="Thumbs down (disliked it)" title="Disliked it" href="https://realpython.com/feedback/survey/article/build-llm-rag-chatbot-with-langchain/disliked/?from=article-sidebar" target="_blank"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#light--thumbs-down"></use></svg></span></a>
</div>

      </div>
    </div>

    
      <div class="sidebar-module sidebar-module-inset text-center my-3 py-0">
        

<span>
  <a target="_blank" rel="nofollow" href="https://twitter.com/intent/tweet/?text=Check%20out%20this%20%23Python%20tutorial:%20Build%20an%20LLM%20RAG%20Chatbot%20With%20LangChain%20by%20@realpython&amp;url=https%3A//realpython.com/build-llm-rag-chatbot-with-langchain/" class="mr-1 badge badge-x-twitter text-light mb-1"><span class="icon baseline mr-1 text-light"><svg><use href="/static/icons.67f62bbffdec.svg#brands--x-twitter"></use></svg></span>Share</a>
  <a target="_blank" rel="nofollow" href="https://facebook.com/sharer/sharer.php?u=https%3A//realpython.com/build-llm-rag-chatbot-with-langchain/" class="mr-1 badge badge-facebook text-light mb-1"><span class="icon baseline mr-1 text-light"><svg><use href="/static/icons.67f62bbffdec.svg#brands--facebook"></use></svg></span>Share</a>
  
  <a target="_blank" rel="nofollow" href="mailto:?subject=Python%20article%20for%20you&amp;body=Check%20out%20this%20Python%20tutorial:%0A%0ABuild%20an%20LLM%20RAG%20Chatbot%20With%20LangChain%0A%0Ahttps%3A//realpython.com/build-llm-rag-chatbot-with-langchain/" class="badge badge-red text-light mb-1"><span class="icon baseline mr-1 text-light"><svg><use href="/static/icons.67f62bbffdec.svg#solid--envelope"></use></svg></span>Email</a>
</span>

      </div>
    

    

    
      <div class="sidebar-module sidebar-module-inset p-0" style="overflow:hidden;">
        
<div style="display:block;position:relative;">
  <div style="display:block;width:100%;padding-top:25%;"></div>
  <div class="rpad" data-unit="4x1" style="position:absolute;left:0;top:0;right:0;bottom:0;overflow:hidden;"></div>
</div>


      </div>
    

    
  </div>


    </aside>

    <div class="col-md-11 col-lg-8 article with-headerlinks">
      

  
    <figure class="embed-responsive embed-responsive-16by9 rounded">
      
        <img class="card-img-top m-0 p-0 embed-responsive-item" style="object-fit: contain; background: #ff7e74;" alt="Build an LLM RAG Chatbot With LangChain" width="1920" height="1080" src="./Build an LLM RAG Chatbot With LangChain – Real Python_files/Build-a-LLM-Application-with-LangChain_Watermarked.b9d023202ad2.jpg" srcset="/cdn-cgi/image/width=480,format=auto/https://files.realpython.com/media/Build-a-LLM-Application-with-LangChain_Watermarked.b9d023202ad2.jpg 480w, /cdn-cgi/image/width=640,format=auto/https://files.realpython.com/media/Build-a-LLM-Application-with-LangChain_Watermarked.b9d023202ad2.jpg 640w, /cdn-cgi/image/width=960,format=auto/https://files.realpython.com/media/Build-a-LLM-Application-with-LangChain_Watermarked.b9d023202ad2.jpg 960w, /cdn-cgi/image/width=1920,format=auto/https://files.realpython.com/media/Build-a-LLM-Application-with-LangChain_Watermarked.b9d023202ad2.jpg 1920w" sizes="(min-width: 1200px) 690px, (min-width: 780px) calc(-5vw + 669px), (min-width: 580px) 510px, calc(100vw - 30px)" fetchpriority="high">
      
    </figure>
  

  <h1>Build an LLM RAG Chatbot With LangChain</h1>
  <div class="mb-0">
    
      <span class="text-muted">by <a class="text-muted" href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#author">Harrison Hoffman</a>
    
    
      <span class="icon baseline ml-2"><svg><use href="/static/icons.67f62bbffdec.svg#v4--clock-o"></use></svg></span> Mar 06, 2024
    
    
      <span class="icon baseline ml-2 mr-1"><svg><use href="/static/icons.67f62bbffdec.svg#solid--comments"></use></svg></span><a class="text-muted" href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#reader-comments"><span class="disqus-comment-count" data-disqus-identifier="https://realpython.com/build-llm-rag-chatbot-with-langchain/">0 Comments</span></a>
    
    

    <span class="d-inline d-md-block"> 
      <span class="icon baseline ml-2 ml-md-0"><svg><use href="/static/icons.67f62bbffdec.svg#@category"></use></svg></span>
      
        <a href="https://realpython.com/tutorials/databases/" class="badge badge-light text-muted">databases</a>
      
        <a href="https://realpython.com/tutorials/data-science/" class="badge badge-light text-muted">data-science</a>
      
        <a href="https://realpython.com/tutorials/intermediate/" class="badge badge-light text-muted">intermediate</a>
      
    </span>

    <div class="d-sm-flex flex-row justify-content-between my-3 text-center">
      
<div class="jsCompletionStatusWidget btn-group mb-0">
  <button title="Click to mark as completed" class="jsBtnCompletion btn btn-secondary border-right" style="border-top-right-radius: 0; border-bottom-right-radius: 0;">Mark as Completed</button>
  <button title="Add bookmark" class="jsBtnBookmark btn btn-secondary border-left"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#light--bookmark"></use></svg></span></button>
</div>

      
        <div class="align-self-center my-2">
          

<span>
  <a target="_blank" rel="nofollow" href="https://twitter.com/intent/tweet/?text=Check%20out%20this%20%23Python%20tutorial:%20Build%20an%20LLM%20RAG%20Chatbot%20With%20LangChain%20by%20@realpython&amp;url=https%3A//realpython.com/build-llm-rag-chatbot-with-langchain/" class="mr-1 badge badge-x-twitter text-light mb-1"><span class="icon baseline mr-1 text-light"><svg><use href="/static/icons.67f62bbffdec.svg#brands--x-twitter"></use></svg></span>Share</a>
  <a target="_blank" rel="nofollow" href="https://facebook.com/sharer/sharer.php?u=https%3A//realpython.com/build-llm-rag-chatbot-with-langchain/" class="mr-1 badge badge-facebook text-light mb-1"><span class="icon baseline mr-1 text-light"><svg><use href="/static/icons.67f62bbffdec.svg#brands--facebook"></use></svg></span>Share</a>
  
  <a target="_blank" rel="nofollow" href="mailto:?subject=Python%20article%20for%20you&amp;body=Check%20out%20this%20Python%20tutorial:%0A%0ABuild%20an%20LLM%20RAG%20Chatbot%20With%20LangChain%0A%0Ahttps%3A//realpython.com/build-llm-rag-chatbot-with-langchain/" class="badge badge-red text-light mb-1"><span class="icon baseline mr-1 text-light"><svg><use href="/static/icons.67f62bbffdec.svg#solid--envelope"></use></svg></span>Email</a>
</span>

        </div>
      
    </div>
  </span></div>

  

  <div class="article-body">
    
      <div class="bg-light sidebar-module sidebar-module-inset" id="toc">
        <p class="h3 mb-2 text-muted">Table of Contents</p>
        <div class="toc">
<ul>
<li><a href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#demo-an-llm-rag-chatbot-with-langchain-and-neo4j">Demo: An LLM RAG Chatbot With LangChain and Neo4j</a></li>
<li><a href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#prerequisites">Prerequisites</a></li>
<li><a href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#project-overview">Project Overview</a></li>
<li><a href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#step-1-get-familiar-with-langchain">Step 1: Get Familiar With LangChain</a><ul>
<li><a href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#chat-models">Chat Models</a></li>
<li><a href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#prompt-templates">Prompt Templates</a></li>
<li><a href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#chains-and-langchain-expression-language-lcel">Chains and LangChain Expression Language (LCEL)</a></li>
<li><a href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#retrieval-objects">Retrieval Objects</a></li>
<li><a href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#agents">Agents</a></li>
</ul>
</li>
<li><a href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#step-2-understand-the-business-requirements-and-data">Step 2: Understand the Business Requirements and Data</a><ul>
<li><a href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#understand-the-problem-and-requirements">Understand the Problem and Requirements</a></li>
<li><a href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#explore-the-available-data">Explore the Available Data</a></li>
<li><a href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#design-the-chatbot">Design the Chatbot</a></li>
</ul>
</li>
<li><a href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#step-3-set-up-a-neo4j-graph-database">Step 3: Set Up a Neo4j Graph Database</a><ul>
<li><a href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#a-brief-overview-of-graph-databases">A Brief Overview of Graph Databases</a></li>
<li><a href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#create-a-neo4j-account-and-auradb-instance">Create a Neo4j Account and AuraDB Instance</a></li>
<li><a href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#design-the-hospital-system-graph-database">Design the Hospital System Graph Database</a></li>
<li><a href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#upload-data-to-neo4j">Upload Data to Neo4j</a></li>
<li><a href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#query-the-hospital-system-graph">Query the Hospital System Graph</a></li>
</ul>
</li>
<li><a href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#step-4-build-a-graph-rag-chatbot-in-langchain">Step 4: Build a Graph RAG Chatbot in LangChain</a><ul>
<li><a href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#create-a-neo4j-vector-chain">Create a Neo4j Vector Chain</a></li>
<li><a href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#create-a-neo4j-cypher-chain">Create a Neo4j Cypher Chain</a></li>
<li><a href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#create-wait-time-functions">Create Wait Time Functions</a></li>
<li><a href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#create-the-chatbot-agent">Create the Chatbot Agent</a></li>
</ul>
</li>
<li><a href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#step-5-deploy-the-langchain-agent">Step 5: Deploy the LangChain Agent</a><ul>
<li><a href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#serve-the-agent-with-fastapi">Serve the Agent With FastAPI</a></li>
<li><a href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#create-a-chat-ui-with-streamlit">Create a Chat UI With Streamlit</a></li>
<li><a href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#orchestrate-the-project-with-docker-compose">Orchestrate the Project With Docker Compose</a></li>
</ul>
</li>
<li><a href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#conclusion">Conclusion</a></li>
</ul>
</div>

      </div>
    

    
    <div class="sidebar-module sidebar-module-inset p-0" style="overflow:hidden;">
      

<div style="display:block;position:relative;">
  <div style="display:block;width:100%;padding-top:12.5%;"></div>
  <div class="rpad rounded border" data-unit="8x1" style="position:absolute;left:0;top:0;right:0;bottom:0;overflow:hidden;"></div>
</div>
<a class="small text-muted" href="https://realpython.com/account/join/" rel="nofollow"><span class="icon baseline mr-1"><svg><use href="/static/icons.67f62bbffdec.svg#solid--circle-info"></use></svg></span>Remove ads</a>


    </div>
    

    

    <p>You’ve likely interacted with large language models (LLMs), like the ones behind OpenAI’s ChatGPT, and experienced their remarkable ability to answer questions, summarize documents, write code, and much more. While LLMs are remarkable by themselves, with a little programming knowledge, you can leverage libraries like <a href="https://python.langchain.com/docs/get_started/introduction">LangChain</a> to create your own LLM-powered chatbots that can do just about anything.</p>
<p>In an enterprise setting, one of the most popular ways to create an LLM-powered chatbot is through retrieval-augmented generation (RAG). When you design a RAG system, you use a retrieval model to retrieve relevant information, usually from a database or corpus, and provide this retrieved information to an LLM to generate contextually relevant responses.</p>
<p>In this tutorial, you’ll step into the shoes of an AI engineer working for a large hospital system. You’ll build a RAG chatbot in LangChain that uses <a href="https://neo4j.com/">Neo4j</a> to retrieve data about the patients, patient experiences, hospital locations, visits, insurance payers, and physicians in your hospital system.</p>
<p><strong>In this tutorial, you’ll learn how to</strong>:</p>
<ul>
<li>Use <strong>LangChain</strong> to build custom <strong>chatbots</strong></li>
<li><strong>Design</strong> a chatbot using your understanding of the business requirements and hospital system data</li>
<li>Work with <strong>graph databases</strong></li>
<li>Set up a <strong>Neo4j</strong> AuraDB instance</li>
<li>Build a <strong>RAG</strong> chatbot that retrieves both <strong>structured</strong> and <strong>unstructured</strong> data from Neo4j</li>
<li><strong>Deploy</strong> your chatbot with <strong>FastAPI</strong> and <strong>Streamlit</strong></li>
</ul>
<p>Click the link below to download the complete source code and data for this project:</p>
<div class="alert alert-warning" role="alert">
<p><strong markdown="1">Get Your Code:</strong> <a href="https://realpython.com/bonus/build-llm-rag-chatbot-with-langchain-code/" class="alert-link" data-toggle="modal" data-target="#modal-build-llm-rag-chatbot-with-langchain-code" data-focus="false" markdown="1">Click here to download the free source code</a> for your LangChain chatbot.</p>
</div>
<section class="section2"><h2 id="demo-an-llm-rag-chatbot-with-langchain-and-neo4j">Demo: An LLM RAG Chatbot With LangChain and Neo4j<a class="headerlink" href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#demo-an-llm-rag-chatbot-with-langchain-and-neo4j" title="Permanent link"></a></h2>
<p>By the end of this tutorial, you’ll have a <a href="https://realpython.com/api-integration-in-python/">REST API</a> that serves your LangChain chatbot. You’ll also have a <a href="https://streamlit.io/">Streamlit</a> app that provides a nice chat interface to interact with your API:</p>
<figure>
  <div class="embed-responsive embed-responsive-16by9 rounded mb-3 border">
    <iframe loading="lazy" class="embed-responsive-item" src="./Build an LLM RAG Chatbot With LangChain – Real Python_files/918999422.html" frameborder="0" allow="fullscreen" allowfullscreen=""></iframe>
  </div>

</figure>

<p>Under the hood, the Streamlit app sends your messages to the chatbot API, and the chatbot generates and sends a response back to the Streamlit app, which displays it to the user. </p>
<p>You’ll get an in-depth overview of the data that your chatbot has access to later, but if you’re anxious to test it out, you can ask questions similar to the examples given in the sidebar:</p>
<figure class="js-lightbox"><a href="./Build an LLM RAG Chatbot With LangChain – Real Python_files/Screenshot_2024-01-01_at_2.34.47_PM.fa9ed6c58d87.png" target="_blank"><img loading="lazy" class="img-fluid mx-auto d-block " src="./Build an LLM RAG Chatbot With LangChain – Real Python_files/Screenshot_2024-01-01_at_2.34.47_PM.fa9ed6c58d87.png" width="2686" height="1710" srcset="https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/Screenshot_2024-01-01_at_2.34.47_PM.fa9ed6c58d87.png&amp;w=671&amp;sig=8dca32f0154574458d7f1f06fa043e70cc5c9b6f 671w, https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/Screenshot_2024-01-01_at_2.34.47_PM.fa9ed6c58d87.png&amp;w=895&amp;sig=419dc6ad2cda94fac29893c6ebffa9bc879f9150 895w, https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/Screenshot_2024-01-01_at_2.34.47_PM.fa9ed6c58d87.png&amp;w=1343&amp;sig=91d92233da6b80475093666845efb6a5e32e8885 1343w, https://files.realpython.com/media/Screenshot_2024-01-01_at_2.34.47_PM.fa9ed6c58d87.png 2686w" sizes="(min-width: 1200px) 690px, (min-width: 780px) calc(-5vw + 669px), (min-width: 580px) 510px, calc(100vw - 30px)" alt="Example questions that the chatbot can answer" data-asset="5619"></a><figcaption class="figure-caption text-center">Example questions can be found in the sidebar.</figcaption></figure>

<p>You’ll learn how to tackle each step, from understanding the business requirements and data to building the Streamlit app. There’s a lot to unpack in this tutorial, but don’t feel overwhelmed. You’ll get some background on each concept introduced, along with links to external sources that will deepen your understanding. Now, it’s time to dive in!</p>
<div><div class="rounded border border-light" style="display:block;position:relative;"> <div style="display:block;width:100%;padding-top:12.5%;"></div> <div class="rpad rounded border" data-unit="8x1" style="position:absolute;left:0;top:0;right:0;bottom:0;overflow:hidden;"> </div></div><a class="small text-muted" href="https://realpython.com/account/join/" rel="nofollow"> <span class="icon baseline mr-1"><svg><use href="/static/icons.67f62bbffdec.svg#solid--circle-info"></use></svg></span>Remove ads</a></div></section><section class="section2"><h2 id="prerequisites">Prerequisites<a class="headerlink" href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#prerequisites" title="Permanent link"></a></h2>
<p>This tutorial is best suited for intermediate Python developers who want to get hands-on experience creating custom chatbots. Aside from intermediate Python knowledge, you’ll benefit from having a high-level understanding of the following concepts and technologies:</p>
<ul>
<li>Large language models (LLMs) and <a href="https://realpython.com/practical-prompt-engineering/">prompt engineering</a></li>
<li><a href="https://realpython.com/chromadb-vector-database/#represent-data-as-vectors">Text embeddings and vector databases</a></li>
<li><a href="https://neo4j.com/developer/graph-database/">Graph databases</a> and <a href="https://neo4j.com/docs/getting-started/languages-guides/neo4j-python/">Neo4j</a></li>
<li><a href="https://openai.com/product">The OpenAI developer ecosystem</a></li>
<li><a href="https://realpython.com/api-integration-in-python/">REST APIs</a> and <a href="https://realpython.com/fastapi-python-web-apis/">FastAPI</a></li>
<li><a href="https://realpython.com/async-io-python/">Asynchronous programming</a></li>
<li><a href="https://realpython.com/tutorials/docker/">Docker</a> and <a href="https://docs.docker.com/compose/">Docker Compose</a></li>
</ul>
<p>Nothing listed above is a hard prerequisite, so don’t worry if you don’t feel knowledgeable in any of them. You’ll be introduced to each concept and technology along the way. Besides, there’s no better way to learn these prerequisites than to implement them yourself in this tutorial. </p>
<p>Next up, you’ll get a brief project overview and begin learning about LangChain.</p>
</section><section class="section2"><h2 id="project-overview">Project Overview<a class="headerlink" href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#project-overview" title="Permanent link"></a></h2>
<p>Throughout this tutorial, you’ll create a few directories that make up your final chatbot. Here’s a breakdown of each directory:</p>
<ul>
<li>
<p><code>langchain_intro/</code> will help you get familiar with LangChain and equip you with the tools that you need to build the chatbot you saw in the demo, and it won’t be included in your final chatbot. You’ll cover this in <a href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#step-1-get-familiar-with-langchain">Step 1</a>.</p>
</li>
<li>
<p><code>data/</code> has the raw hospital system data stored as CSV files. You’ll explore this data in <a href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#step-2-understand-the-business-requirements-and-data">Step 2</a>. In <a href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#step-3-set-up-a-neo4j-graph-database">Step 3</a>, you’ll move this data into a Neo4j database that your chatbot will query to answer questions. </p>
</li>
<li>
<p><code>hospital_neo4j_etl/</code> contains a script that loads the raw data from <code>data/</code> into your Neo4j database. You have to run this before building your chatbot, and you’ll learn everything you need to know about setting up a Neo4j instance in <a href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#step-3-set-up-a-neo4j-graph-database">Step 3</a>.</p>
</li>
<li>
<p><code>chatbot_api/</code> is your <a href="https://realpython.com/fastapi-python-web-apis/">FastAPI</a> app that serves your chatbot as a REST endpoint, and it’s the core deliverable of this project. The <code>chatbot_api/src/agents/</code> and <code>chatbot_api/src/chains/</code> subdirectories contain the LangChain objects that comprise your chatbot. You’ll learn what agents and chains are later, but for now, just know that your chatbot is actually a LangChain agent composed of chains and functions. </p>
</li>
<li>
<p><code>tests/</code> includes two scripts that test how fast your chatbot can answer a series of questions. This will give you a feel for how much time you save by making asynchronous requests to LLM providers like OpenAI.</p>
</li>
<li>
<p><code>chatbot_frontend/</code> is your Streamlit app that interacts with the chatbot endpoint in <code>chatbot_api/</code>. This is the UI that you saw in the demo, and you’ll build this in <a href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#step-5-deploy-the-langchain-agent">Step 5</a>.</p>
</li>
</ul>
<p>All the environment variables needed to build and run your chatbot will be stored in a <code>.env</code> file. You’ll deploy the code in <code>hospital_neo4j_etl/</code>, <code>chatbot_api</code>, and <code>chatbot_frontend</code> as Docker containers that’ll be orchestrated with Docker Compose. If you want to experiment with the chatbot before going through the rest of this tutorial, then you can download the materials and follow the instructions in the README file to get things running:</p>
<div class="alert alert-warning" role="alert">
<p><strong markdown="1">Get Your Code:</strong> <a href="https://realpython.com/bonus/build-llm-rag-chatbot-with-langchain-code/" class="alert-link" data-toggle="modal" data-target="#modal-build-llm-rag-chatbot-with-langchain-code" data-focus="false" markdown="1">Click here to download the free source code</a> for your LangChain chatbot.</p>
</div>
<p>With the project overview and prerequisites behind you, you’re ready to get started with the first step—getting familiar with LangChain.</p>
</section><section class="section2"><h2 id="step-1-get-familiar-with-langchain">Step 1: Get Familiar With LangChain<a class="headerlink" href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#step-1-get-familiar-with-langchain" title="Permanent link"></a></h2>
<p>Before you design and develop your chatbot, you need to know how to use LangChain. In this section, you’ll get to know LangChain’s main components and features by building a preliminary version of your hospital system chatbot. This will give you all the necessary tools to build your full chatbot.</p>
<p>Use your favorite code editor to create a new Python project, and be sure to create a <a href="https://realpython.com/python-virtual-environments-a-primer/">virtual environment</a> for its dependencies. Make sure you have Python 3.10 or later installed. Activate your virtual environment and install the following libraries:</p>
<div class="codeblock mb-3 w-100" aria-label="Code block" data-syntax-language="console" data-is-repl="true">
  <div class="codeblock__header d-flex justify-content-between codeblock--yellow">
    <span class="mr-2 noselect" aria-label="Language">Shell</span>
    
    <div class="noselect">
      
        <span class="codeblock__output-toggle" title="Toggle prompts and output"><span class="icon baseline js-codeblock-output-on codeblock__header--icon-lower"><svg><use href="/static/icons.67f62bbffdec.svg#regular--rectangle-terminal"></use></svg></span></span>
      
    </div>
  </div>
  <div style="position: relative;">
    <div class="highlight highlight--with-header"><pre><span></span><code><span class="gp gp-VirtualEnv">(venv)</span> <span class="gp">$ </span>python<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span><span class="nv">langchain</span><span class="o">==</span><span class="m">0</span>.1.0<span class="w"> </span><span class="nv">openai</span><span class="o">==</span><span class="m">1</span>.7.2<span class="w"> </span>langchain-openai<span class="o">==</span><span class="m">0</span>.0.2<span class="w"> </span>langchain-community<span class="o">==</span><span class="m">0</span>.0.12<span class="w"> </span><span class="nv">langchainhub</span><span class="o">==</span><span class="m">0</span>.1.14
</code></pre></div>
    
    <button class="codeblock__copy btn btn-outline-secondary border m-1 px-1 d-hover-only" title="Copy to clipboard"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#@copy"></use></svg></span></button>
    <template class="codeblock__copied-template"></template>
    
  </div>
</div>
<p>You’ll also want to install <a href="https://pypi.org/project/python-dotenv/"><code>python-dotenv</code></a> to help you manage environment variables:</p>
<div class="codeblock mb-3 w-100" aria-label="Code block" data-syntax-language="console" data-is-repl="true">
  <div class="codeblock__header d-flex justify-content-between codeblock--yellow">
    <span class="mr-2 noselect" aria-label="Language">Shell</span>
    
    <div class="noselect">
      
        <span class="codeblock__output-toggle" title="Toggle prompts and output"><span class="icon baseline js-codeblock-output-on codeblock__header--icon-lower"><svg><use href="/static/icons.67f62bbffdec.svg#regular--rectangle-terminal"></use></svg></span></span>
      
    </div>
  </div>
  <div style="position: relative;">
    <div class="highlight highlight--with-header"><pre><span></span><code><span class="gp gp-VirtualEnv">(venv)</span> <span class="gp">$ </span>python<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>python-dotenv
</code></pre></div>
    
    <button class="codeblock__copy btn btn-outline-secondary border m-1 px-1 d-hover-only" title="Copy to clipboard"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#@copy"></use></svg></span></button>
    <template class="codeblock__copied-template"></template>
    
  </div>
</div>
<p>Python-dotenv loads environment variables from <code>.env</code> files into your Python environment, and you’ll find this handy as you develop your chatbot. However, you’ll eventually deploy your chatbot with Docker, which can handle environment variables for you, and you won’t need Python-dotenv anymore.</p>
<p>If you haven’t already, you’ll need to download <code>reviews.csv</code> from the materials or <a href="https://github.com/hfhoffman1144/langchain_neo4j_rag_app/blob/main/data/reviews.csv">GitHub repo</a> for this tutorial:</p>
<div class="alert alert-warning" role="alert">
<p><strong markdown="1">Get Your Code:</strong> <a href="https://realpython.com/bonus/build-llm-rag-chatbot-with-langchain-code/" class="alert-link" data-toggle="modal" data-target="#modal-build-llm-rag-chatbot-with-langchain-code" data-focus="false" markdown="1">Click here to download the free source code</a> for your LangChain chatbot.</p>
</div>
<p>Next, open the project directory and add the following folders and files:</p>
<div class="highlight"><pre><span></span><code>./
│
├── data/
│   └── reviews.csv
│
├── langchain_intro/
│   ├── chatbot.py
│   ├── create_retriever.py
│   └── tools.py
│
└── .env
</code></pre></div>
<p>The <code>reviews.csv</code> file in <code>data/</code> is the one you just downloaded, and the remaining files you see should be empty.</p>
<p>You’re now ready to get started building your first chatbot with LangChain!</p>
<div><div class="rounded border border-light" style="display:block;position:relative;"> <div style="display:block;width:100%;padding-top:12.5%;"></div> <div class="rpad rounded border" data-unit="8x1" style="position:absolute;left:0;top:0;right:0;bottom:0;overflow:hidden;"> </div></div><a class="small text-muted" href="https://realpython.com/account/join/" rel="nofollow"> <span class="icon baseline mr-1"><svg><use href="/static/icons.67f62bbffdec.svg#solid--circle-info"></use></svg></span>Remove ads</a></div><section class="section3"><h3 id="chat-models">Chat Models<a class="headerlink" href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#chat-models" title="Permanent link"></a></h3>
<p>You might’ve guessed that the core component of LangChain is the <a href="https://python.langchain.com/docs/modules/model_io/llms/">LLM</a>. LangChain provides a modular interface for working with LLM providers such as OpenAI, Cohere, HuggingFace, Anthropic, Together AI, and others. In most cases, all you need is an API key from the LLM provider to get started using the LLM with LangChain. LangChain also supports LLMs or other language models hosted on your own machine.</p>
<p>You’ll use OpenAI for this tutorial, but keep in mind there are many great open- and closed-source providers out there. You can always test out different providers and optimize depending on your application’s needs and cost constraints. Before moving forward, make sure you’re signed up for an OpenAI account and you have a valid <a href="https://openai.com/product">API key</a>.</p>
<p>Once you have your OpenAI API key, add it to your <code>.env</code> file:</p>
<div class="codeblock mb-3 w-100" aria-label="Code block" data-syntax-language="dotenv">
  <div class="codeblock__header d-flex justify-content-between codeblock--grey">
    <span class="mr-2 noselect" aria-label="Language">.env</span>
    
    <div class="noselect">
      
    </div>
  </div>
  <div style="position: relative;">
    <div class="highlight highlight--with-header"><pre><span></span><code><span class="na">OPENAI_API_KEY</span><span class="o">=</span><span class="s">&lt;YOUR-OPENAI-API-KEY&gt;</span>
</code></pre></div>
    
    <button class="codeblock__copy btn btn-outline-secondary border m-1 px-1 d-hover-only" title="Copy to clipboard"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#@copy"></use></svg></span></button>
    <template class="codeblock__copied-template"></template>
    
  </div>
</div>
<p>While you can interact directly with LLM objects in LangChain, a more common abstraction is the <a href="https://python.langchain.com/docs/modules/model_io/chat/">chat model</a>. Chat models use LLMs under the hood, but they’re designed for conversations, and they interface with <a href="https://python.langchain.com/docs/modules/model_io/chat/quick_start#messages">chat messages</a> rather than raw text. </p>
<p>Using chat messages, you provide an LLM with additional detail about the kind of message you’re sending. All messages have <code>role</code> and <code>content</code> properties. The <code>role</code> tells the LLM who is sending the message, and the <code>content</code> is the message itself. Here are the most commonly used messages:</p>
<ul>
<li><code>HumanMessage</code>: A message from the user interacting with the language model.</li>
<li><code>AIMessage</code>: A message from the language model.</li>
<li><code>SystemMessage</code>: A message that tells the language model how to behave. Not all providers support the <code>SystemMessage</code>.</li>
</ul>
<p>There are other messages types, like <a href="https://python.langchain.com/docs/modules/model_io/concepts#functionmessage"><code>FunctionMessage</code></a> and <a href="https://python.langchain.com/docs/modules/model_io/concepts#toolmessage"><code>ToolMessage</code></a>, but you’ll learn more about those when you build an <a href="https://python.langchain.com/docs/modules/agents/">agent</a>.</p>
<p>Getting started with chat models in LangChain is straightforward. To instantiate an OpenAI chat model, navigate to <code>langchain_intro</code> and add the following code to <code>chatbot.py</code>:</p>
<div class="codeblock mb-3 w-100" aria-label="Code block" data-syntax-language="python">
  <div class="codeblock__header d-flex justify-content-between codeblock--blue">
    <span class="mr-2 noselect" aria-label="Language">Python</span>
    <span class="mr-2" aria-label="Filename"><code style="color: inherit;">langchain_intro/chatbot.py</code></span>
    <div class="noselect">
      
    </div>
  </div>
  <div style="position: relative;">
    <div class="highlight highlight--with-header"><pre><span></span><code><span class="kn">import</span> <span class="nn">dotenv</span>
<span class="kn">from</span> <span class="nn">langchain_openai</span> <span class="kn">import</span> <span class="n">ChatOpenAI</span>

<span class="n">dotenv</span><span class="o">.</span><span class="n">load_dotenv</span><span class="p">()</span>

<span class="hll"><span class="n">chat_model</span> <span class="o">=</span> <span class="n">ChatOpenAI</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s2">"gpt-3.5-turbo-0125"</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span></code></pre></div>
    
    <button class="codeblock__copy btn btn-outline-secondary border m-1 px-1 d-hover-only" title="Copy to clipboard"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#@copy"></use></svg></span></button>
    <template class="codeblock__copied-template"></template>
    
  </div>
</div>
<p>You first import <code>dotenv</code> and <code>ChatOpenAI</code>. Then you call <code>dotenv.load_dotenv()</code> which reads and stores environment variables from <code>.env</code>. By default, <code>dotenv.load_dotenv()</code> assumes <code>.env</code> is located in the current working directory, but you can pass the path to other directories if <code>.env</code> is located elsewhere.</p>
<p>You then instantiate a <code>ChatOpenAI</code> model using <a href="https://platform.openai.com/docs/models/gpt-3-5">GPT 3.5 Turbo</a> as the base LLM, and you set <code>temperature</code> to 0. OpenAI offers a diversity of <a href="https://platform.openai.com/docs/models">models</a> with varying price points, capabilities, and performances. GPT 3.5 turbo is a great model to start with because it performs well in many use cases and is cheaper than more recent models like GPT 4 and beyond.</p>
<div class="alert alert-primary" role="alert">
<p><strong>Note</strong>: It’s a common misconception that setting <code>temperature=0</code> guarantees deterministic responses from GPT models. While responses are closer to deterministic when <code>temperature=0</code>, <a href="https://arxiv.org/abs/2308.02828">there’s no guarantee</a> that you’ll get the same response for identical requests. Because of this, GPT models might output slightly different results than what you see in the examples throughout this tutorial.</p>
</div>
<p>To use <code>chat_model</code>, open the project directory, start a Python interpreter, and run the following code:</p>
<div class="codeblock mb-3 w-100" aria-label="Code block" data-syntax-language="pycon" data-is-repl="true">
  <div class="codeblock__header d-flex justify-content-between codeblock--blue">
    <span class="mr-2 noselect" aria-label="Language">Python</span>
    
    <div class="noselect">
      
        <span class="codeblock__output-toggle" title="Toggle prompts and output"><span class="icon baseline js-codeblock-output-on codeblock__header--icon-lower"><svg><use href="/static/icons.67f62bbffdec.svg#regular--rectangle-terminal"></use></svg></span></span>
      
    </div>
  </div>
  <div style="position: relative;">
    <div class="highlight highlight--with-header"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">langchain.schema.messages</span> <span class="kn">import</span> <span class="n">HumanMessage</span><span class="p">,</span> <span class="n">SystemMessage</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">langchain_intro.chatbot</span> <span class="kn">import</span> <span class="n">chat_model</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">messages</span> <span class="o">=</span> <span class="p">[</span>
<span class="gp">... </span>    <span class="n">SystemMessage</span><span class="p">(</span>
<span class="gp">... </span>        <span class="n">content</span><span class="o">=</span><span class="s2">"""You're an assistant knowledgeable about</span>
<span class="gp">... </span><span class="s2">        healthcare. Only answer healthcare-related questions."""</span>
<span class="gp">... </span>    <span class="p">),</span>
<span class="gp">... </span>    <span class="n">HumanMessage</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="s2">"What is Medicaid managed care?"</span><span class="p">),</span>
<span class="gp">... </span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">chat_model</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span>
<span class="go">AIMessage(content='Medicaid managed care is a healthcare delivery system</span>
<span class="go">in which states contract with managed care organizations (MCOs) to provide</span>
<span class="go">healthcare services to Medicaid beneficiaries. Under this system, MCOs are</span>
<span class="go">responsible for coordinating and delivering healthcare services to enrollees,</span>
<span class="go">including primary care, specialty care, hospital services, and prescription</span>
<span class="go">drugs. Medicaid managed care aims to improve care coordination, control costs,</span>
<span class="go">and enhance the quality of care for Medicaid beneficiaries.')</span>
</code></pre></div>
    
    <button class="codeblock__copy btn btn-outline-secondary border m-1 px-1 d-hover-only" title="Copy to clipboard"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#@copy"></use></svg></span></button>
    <template class="codeblock__copied-template"></template>
    
  </div>
</div>
<p>In this block, you import <code>HumanMessage</code> and <code>SystemMessage</code>, as well as your chat model. You then define a list with a <code>SystemMessage</code> and a <code>HumanMessage</code> and run them through <code>chat_model</code> with <code>chat_model.invoke()</code>. Under the hood, <code>chat_model</code> makes a request to an OpenAI endpoint serving <code>gpt-3.5-turbo-0125</code>, and the results are returned as an <code>AIMessage</code>. </p>
<div class="alert alert-primary" role="alert">
<p><strong>Note:</strong> You may find copying and pasting multiline code from this tutorial into your <a href="https://realpython.com/python-repl/">standard Python REPL</a> a bit cumbersome. For a better experience, you could install an alternative Python REPL, such as <a href="https://realpython.com/ipython-interactive-python-shell/">IPython</a>, <a href="https://realpython.com/bpython-alternative-python-repl/">bpython</a> or <a href="https://realpython.com/ptpython-shell/">ptpython</a>, into your virtual environment and run the REPL interactions with those.</p>
</div>
<p>As you can see, the chat model answered <em>What is Medicaid managed care?</em> provided in the <code>HumanMessage</code>. You might be wondering what the chat model did with the <code>SystemMessage</code> in this context. Notice what happens when you ask the following question:</p>
<div class="codeblock mb-3 w-100" aria-label="Code block" data-syntax-language="pycon" data-is-repl="true">
  <div class="codeblock__header d-flex justify-content-between codeblock--blue">
    <span class="mr-2 noselect" aria-label="Language">Python</span>
    
    <div class="noselect">
      
        <span class="codeblock__output-toggle" title="Toggle prompts and output"><span class="icon baseline js-codeblock-output-on codeblock__header--icon-lower"><svg><use href="/static/icons.67f62bbffdec.svg#regular--rectangle-terminal"></use></svg></span></span>
      
    </div>
  </div>
  <div style="position: relative;">
    <div class="highlight highlight--with-header"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">messages</span> <span class="o">=</span> <span class="p">[</span>
<span class="gp">... </span>    <span class="n">SystemMessage</span><span class="p">(</span>
<span class="gp">... </span>        <span class="n">content</span><span class="o">=</span><span class="s2">"""You're an assistant knowledgeable about</span>
<span class="gp">... </span><span class="s2">        healthcare. Only answer healthcare-related questions."""</span>
<span class="gp">... </span>    <span class="p">),</span>
<span class="gp">... </span>    <span class="n">HumanMessage</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="s2">"How do I change a tire?"</span><span class="p">),</span>
<span class="gp">... </span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">chat_model</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span>
<span class="go">AIMessage(content='I apologize, but I can only provide assistance</span>
<span class="go">and answer questions related to healthcare.')</span>
</code></pre></div>
    
    <button class="codeblock__copy btn btn-outline-secondary border m-1 px-1 d-hover-only" title="Copy to clipboard"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#@copy"></use></svg></span></button>
    <template class="codeblock__copied-template"></template>
    
  </div>
</div>
<p>As described earlier, the <code>SystemMessage</code> tells the model how to behave. In this case, you told the model to <em>only answer healthcare-related questions</em>. This is why it refuses to tell you how to change your tire. The ability to control how an LLM relates to the user through text instructions is powerful, and this is the foundation for creating customized chatbots through <a href="https://realpython.com/practical-prompt-engineering/">prompt engineering</a>.</p>
<p>While chat messages are a nice abstraction and are good for ensuring that you’re giving the LLM the right kind of message, you can also pass raw strings into chat models:</p>
<div class="codeblock mb-3 w-100" aria-label="Code block" data-syntax-language="pycon" data-is-repl="true">
  <div class="codeblock__header d-flex justify-content-between codeblock--blue">
    <span class="mr-2 noselect" aria-label="Language">Python</span>
    
    <div class="noselect">
      
        <span class="codeblock__output-toggle" title="Toggle prompts and output"><span class="icon baseline js-codeblock-output-on codeblock__header--icon-lower"><svg><use href="/static/icons.67f62bbffdec.svg#regular--rectangle-terminal"></use></svg></span></span>
      
    </div>
  </div>
  <div style="position: relative;">
    <div class="highlight highlight--with-header"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">chat_model</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="s2">"What is blood pressure?"</span><span class="p">)</span>
<span class="go">AIMessage(content='Blood pressure is the force exerted by</span>
<span class="go">the blood against the walls of the blood vessels, particularly</span>
<span class="go">the arteries, as it is pumped by the heart. It is measured in</span>
<span class="go">millimeters of mercury (mmHg) and is typically expressed as two</span>
<span class="go">numbers: systolic pressure over diastolic pressure. The systolic</span>
<span class="go">pressure represents the force when the heart contracts and pumps</span>
<span class="go">blood into the arteries, while the diastolic pressure represents</span>
<span class="go">the force when the heart is at rest between beats. Blood pressure</span>
<span class="go">is an important indicator of cardiovascular health and can be influenced</span>
<span class="go">by various factors such as age, genetics, lifestyle, and underlying medical</span>
<span class="go">conditions.')</span>
</code></pre></div>
    
    <button class="codeblock__copy btn btn-outline-secondary border m-1 px-1 d-hover-only" title="Copy to clipboard"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#@copy"></use></svg></span></button>
    <template class="codeblock__copied-template"></template>
    
  </div>
</div>
<p>In this code block, you pass the string <em>What is blood pressure?</em> directly to <code>chat_model.invoke()</code>. If you want to control the LLM’s behavior without a <code>SystemMessage</code> here, you can include instructions in the string input. </p>
<div class="alert alert-primary" role="alert">
<p><strong>Note</strong>: In these examples, you used <code>.invoke()</code>, but LangChain has <a href="https://python.langchain.com/docs/expression_language/interface">other methods</a> that interact with LLMs. For instance, <code>.stream()</code> returns the response one token at time, and <code>.batch()</code> accepts a list of messages that the LLM responds to in one call. </p>
<p>Each method also has an analogous asynchronous method. For instance, you can run <code>.invoke()</code> asynchronously with <code>ainvoke()</code>. </p>
</div>
<p>Next up, you’ll learn a modular way to guide your model’s response, as you did with the <code>SystemMessage</code>, making it easier to customize your chatbot.</p>
<div><div class="rounded border border-light" style="display:block;position:relative;"> <div style="display:block;width:100%;padding-top:12.5%;"></div> <div class="rpad rounded border" data-unit="8x1" style="position:absolute;left:0;top:0;right:0;bottom:0;overflow:hidden;"> </div></div><a class="small text-muted" href="https://realpython.com/account/join/" rel="nofollow"> <span class="icon baseline mr-1"><svg><use href="/static/icons.67f62bbffdec.svg#solid--circle-info"></use></svg></span>Remove ads</a></div></section><section class="section3"><h3 id="prompt-templates">Prompt Templates<a class="headerlink" href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#prompt-templates" title="Permanent link"></a></h3>
<p>LangChain allows you to design modular prompts for your chatbot with <a href="https://python.langchain.com/docs/modules/model_io/prompts/quick_start">prompt templates</a>. Quoting LangChain’s documentation, you can think of prompt templates as <em>predefined recipes for generating prompts for language models</em>. </p>
<p>Suppose you want to build a chatbot that answers questions about patient experiences from their reviews. Here’s what a prompt template might look like for this:</p>
<div class="codeblock mb-3 w-100" aria-label="Code block" data-syntax-language="pycon" data-is-repl="true">
  <div class="codeblock__header d-flex justify-content-between codeblock--blue">
    <span class="mr-2 noselect" aria-label="Language">Python</span>
    
    <div class="noselect">
      
        <span class="codeblock__output-toggle" title="Toggle prompts and output"><span class="icon baseline js-codeblock-output-on codeblock__header--icon-lower"><svg><use href="/static/icons.67f62bbffdec.svg#regular--rectangle-terminal"></use></svg></span></span>
      
    </div>
  </div>
  <div style="position: relative;">
    <div class="highlight highlight--with-header"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">langchain.prompts</span> <span class="kn">import</span> <span class="n">ChatPromptTemplate</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">review_template_str</span> <span class="o">=</span> <span class="s2">"""Your job is to use patient</span>
<span class="gp">... </span><span class="s2">reviews to answer questions about their experience at a hospital.</span>
<span class="gp">... </span><span class="s2">Use the following context to answer questions. Be as detailed</span>
<span class="gp">... </span><span class="s2">as possible, but don't make up any information that's not</span>
<span class="gp">... </span><span class="s2">from the context. If you don't know an answer, say you don't know.</span>
<span class="gp">...</span>
<span class="gp">... </span><span class="si">{context}</span>
<span class="gp">...</span>
<span class="gp">... </span><span class="si">{question}</span>
<span class="gp">... </span><span class="s2">"""</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">review_template</span> <span class="o">=</span> <span class="n">ChatPromptTemplate</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span><span class="n">review_template_str</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">context</span> <span class="o">=</span> <span class="s2">"I had a great stay!"</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">question</span> <span class="o">=</span> <span class="s2">"Did anyone have a positive experience?"</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">review_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">,</span> <span class="n">question</span><span class="o">=</span><span class="n">question</span><span class="p">)</span>
<span class="go">"Human: Your job is to use patient\nreviews to answer questions about</span>
<span class="go"> their experience at a hospital.\nUse the following context to</span>
<span class="go"> answer questions. Be as detailed\nas possible, but don't make</span>
<span class="go"> up any information that's not\nfrom the context. If you don't</span>
<span class="go"> know an answer, say you don't know.\n\nI had a great</span>
<span class="go"> stay!\n\nDid anyone have a positive experience?\n"</span>
</code></pre></div>
    
    <button class="codeblock__copy btn btn-outline-secondary border m-1 px-1 d-hover-only" title="Copy to clipboard"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#@copy"></use></svg></span></button>
    <template class="codeblock__copied-template"></template>
    
  </div>
</div>
<p>You first import <code>ChatPromptTemplate</code> and define <code>review_template_str</code>, which contains the instructions that you’ll pass to the model, along with the variables <code>context</code> and <code>question</code> in <a href="https://realpython.com/python-f-strings/#the-strformat-method">replacement fields</a> that LangChain delimits with curly braces (<code>{}</code>). You then create a <code>ChatPromptTemplate</code> object from <code>review_template_str</code> using the <a href="https://realpython.com/instance-class-and-static-methods-demystified/">class method</a> <code>.from_template()</code>.</p>
<p>With <code>review_template</code> instantiated, you can pass <code>context</code> and <code>question</code> into the string template with <code>review_template.format()</code>. The results may look like you’ve done nothing more than <a href="https://realpython.com/python-f-strings/">standard Python string interpolation</a>, but prompt templates have a lot of useful features that allow them to integrate with chat models.</p>
<p>Notice how your previous call to <code>review_template.format()</code> generated a string with <em>Human</em> at the beginning. This is because <code>ChatPromptTemplate.from_template()</code> assumes the string template is a human message by default. To change this, you can create more detailed prompt templates for each chat message that you want the model to process:</p>
<div class="codeblock mb-3 w-100" aria-label="Code block" data-syntax-language="pycon" data-is-repl="true">
  <div class="codeblock__header d-flex justify-content-between codeblock--blue">
    <span class="mr-2 noselect" aria-label="Language">Python</span>
    
    <div class="noselect">
      
        <span class="codeblock__output-toggle" title="Toggle prompts and output"><span class="icon baseline js-codeblock-output-on codeblock__header--icon-lower"><svg><use href="/static/icons.67f62bbffdec.svg#regular--rectangle-terminal"></use></svg></span></span>
      
    </div>
  </div>
  <div style="position: relative;">
    <div class="highlight highlight--with-header"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">langchain.prompts</span> <span class="kn">import</span> <span class="p">(</span>
<span class="gp">... </span>    <span class="n">PromptTemplate</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">SystemMessagePromptTemplate</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">HumanMessagePromptTemplate</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">ChatPromptTemplate</span><span class="p">,</span>
<span class="gp">... </span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">review_system_template_str</span> <span class="o">=</span> <span class="s2">"""Your job is to use patient</span>
<span class="gp">... </span><span class="s2">reviews to answer questions about their experience at a</span>
<span class="gp">... </span><span class="s2">hospital. Use the following context to answer questions.</span>
<span class="gp">... </span><span class="s2">Be as detailed as possible, but don't make up any information</span>
<span class="gp">... </span><span class="s2">that's not from the context. If you don't know an answer, say</span>
<span class="gp">... </span><span class="s2">you don't know.</span>
<span class="gp">...</span>
<span class="gp">... </span><span class="si">{context}</span>
<span class="gp">... </span><span class="s2">"""</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">review_system_prompt</span> <span class="o">=</span> <span class="n">SystemMessagePromptTemplate</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">prompt</span><span class="o">=</span><span class="n">PromptTemplate</span><span class="p">(</span>
<span class="gp">... </span>        <span class="n">input_variables</span><span class="o">=</span><span class="p">[</span><span class="s2">"context"</span><span class="p">],</span> <span class="n">template</span><span class="o">=</span><span class="n">review_system_template_str</span>
<span class="gp">... </span>    <span class="p">)</span>
<span class="gp">... </span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">review_human_prompt</span> <span class="o">=</span> <span class="n">HumanMessagePromptTemplate</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">prompt</span><span class="o">=</span><span class="n">PromptTemplate</span><span class="p">(</span>
<span class="gp">... </span>        <span class="n">input_variables</span><span class="o">=</span><span class="p">[</span><span class="s2">"question"</span><span class="p">],</span> <span class="n">template</span><span class="o">=</span><span class="s2">"</span><span class="si">{question}</span><span class="s2">"</span>
<span class="gp">... </span>    <span class="p">)</span>
<span class="gp">... </span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">messages</span> <span class="o">=</span> <span class="p">[</span><span class="n">review_system_prompt</span><span class="p">,</span> <span class="n">review_human_prompt</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">review_prompt_template</span> <span class="o">=</span> <span class="n">ChatPromptTemplate</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">input_variables</span><span class="o">=</span><span class="p">[</span><span class="s2">"context"</span><span class="p">,</span> <span class="s2">"question"</span><span class="p">],</span>
<span class="gp">... </span>    <span class="n">messages</span><span class="o">=</span><span class="n">messages</span><span class="p">,</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">context</span> <span class="o">=</span> <span class="s2">"I had a great stay!"</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">question</span> <span class="o">=</span> <span class="s2">"Did anyone have a positive experience?"</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">review_prompt_template</span><span class="o">.</span><span class="n">format_messages</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">,</span> <span class="n">question</span><span class="o">=</span><span class="n">question</span><span class="p">)</span>
<span class="go">[SystemMessage(content="Your job is to use patient\nreviews to answer</span>
<span class="go"> questions about their experience at a\nhospital. Use the following context</span>
<span class="go"> to answer questions.\nBe as detailed as possible, but don't make up any</span>
<span class="go"> information\nthat's not from the context. If you don't know an answer, say</span>
<span class="go"> \nyou don't know.\n\nI had a great stay!\n"), HumanMessage(content='Did anyone</span>
<span class="go"> have a positive experience?')]</span>
</code></pre></div>
    
    <button class="codeblock__copy btn btn-outline-secondary border m-1 px-1 d-hover-only" title="Copy to clipboard"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#@copy"></use></svg></span></button>
    <template class="codeblock__copied-template"></template>
    
  </div>
</div>
<p>In this block, you import separate prompt templates for <code>HumanMessage</code> and <code>SystemMessage</code>. You then define a string, <code>review_system_template_str</code>, which serves as the template for a <code>SystemMessage</code>. Notice how you only declare a <code>context</code> variable in <code>review_system_template_str</code>.</p>
<p>From this, you create <code>review_system_prompt</code> which is a prompt template specifically for <code>SystemMessage</code>. Next you create a <code>review_human_prompt</code> for the <code>HumanMessage</code>. Notice how the <code>template</code> parameter is just a string with the <code>question</code> variable.</p>
<p>You then add <code>review_system_prompt</code> and <code>review_human_prompt</code> to a list called <code>messages</code> and create <code>review_prompt_template</code>, which is the final object that encompasses the prompt templates for both the <code>SystemMessage</code> and <code>HumanMessage</code>. Calling <code>review_prompt_template.format_messages(context=context, question=question)</code> generates a list with a <code>SystemMessage</code> and <code>HumanMessage</code>, which can be passed to a chat model. </p>
<p>To see how to combine chat models and prompt templates, you’ll build a chain with the LangChain Expression Language (LCEL). This helps you unlock LangChain’s core functionality of building modular customized interfaces over chat models.</p>
</section><section class="section3"><h3 id="chains-and-langchain-expression-language-lcel">Chains and LangChain Expression Language (LCEL)<a class="headerlink" href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#chains-and-langchain-expression-language-lcel" title="Permanent link"></a></h3>
<p>The glue that connects chat models, prompts, and other objects in LangChain is the <a href="https://python.langchain.com/docs/modules/chains">chain</a>. A chain is nothing more than a sequence of calls between objects in LangChain. The recommended way to build chains is to use the <a href="https://python.langchain.com/docs/expression_language/">LangChain Expression Language (LCEL)</a>.</p>
<p>To see how this works, take a look at how you’d create a chain with a chat model and prompt template:</p>
<div class="codeblock mb-3 w-100" aria-label="Code block" data-syntax-language="python">
  <div class="codeblock__header d-flex justify-content-between codeblock--blue">
    <span class="mr-2 noselect" aria-label="Language">Python</span>
    <span class="mr-2" aria-label="Filename"><code style="color: inherit;">langchain_intro/chatbot.py</code></span>
    <div class="noselect">
      
    </div>
  </div>
  <div style="position: relative;">
    <div class="highlight highlight--with-header"><pre><span></span><code><span class="linenos"> 1</span><span class="kn">import</span> <span class="nn">dotenv</span>
<span class="linenos"> 2</span><span class="kn">from</span> <span class="nn">langchain_openai</span> <span class="kn">import</span> <span class="n">ChatOpenAI</span>
<span class="linenos"> 3</span><span class="kn">from</span> <span class="nn">langchain.prompts</span> <span class="kn">import</span> <span class="p">(</span>
<span class="linenos"> 4</span>    <span class="n">PromptTemplate</span><span class="p">,</span>
<span class="linenos"> 5</span>    <span class="n">SystemMessagePromptTemplate</span><span class="p">,</span>
<span class="linenos"> 6</span>    <span class="n">HumanMessagePromptTemplate</span><span class="p">,</span>
<span class="linenos"> 7</span>    <span class="n">ChatPromptTemplate</span><span class="p">,</span>
<span class="linenos"> 8</span><span class="p">)</span>
<span class="linenos"> 9</span>
<span class="linenos">10</span><span class="n">dotenv</span><span class="o">.</span><span class="n">load_dotenv</span><span class="p">()</span>
<span class="linenos">11</span>
<span class="linenos">12</span><span class="n">review_template_str</span> <span class="o">=</span> <span class="s2">"""Your job is to use patient</span>
<span class="linenos">13</span><span class="s2">reviews to answer questions about their experience at</span>
<span class="linenos">14</span><span class="s2">a hospital. Use the following context to answer questions.</span>
<span class="linenos">15</span><span class="s2">Be as detailed as possible, but don't make up any information</span>
<span class="linenos">16</span><span class="s2">that's not from the context. If you don't know an answer, say</span>
<span class="linenos">17</span><span class="s2">you don't know.</span>
<span class="linenos">18</span>
<span class="linenos">19</span><span class="si">{context}</span>
<span class="linenos">20</span><span class="s2">"""</span>
<span class="linenos">21</span>
<span class="linenos">22</span><span class="n">review_system_prompt</span> <span class="o">=</span> <span class="n">SystemMessagePromptTemplate</span><span class="p">(</span>
<span class="linenos">23</span>    <span class="n">prompt</span><span class="o">=</span><span class="n">PromptTemplate</span><span class="p">(</span>
<span class="linenos">24</span>        <span class="n">input_variables</span><span class="o">=</span><span class="p">[</span><span class="s2">"context"</span><span class="p">],</span>
<span class="linenos">25</span>        <span class="n">template</span><span class="o">=</span><span class="n">review_template_str</span><span class="p">,</span>
<span class="linenos">26</span>    <span class="p">)</span>
<span class="linenos">27</span><span class="p">)</span>
<span class="linenos">28</span>
<span class="linenos">29</span><span class="n">review_human_prompt</span> <span class="o">=</span> <span class="n">HumanMessagePromptTemplate</span><span class="p">(</span>
<span class="linenos">30</span>    <span class="n">prompt</span><span class="o">=</span><span class="n">PromptTemplate</span><span class="p">(</span>
<span class="linenos">31</span>        <span class="n">input_variables</span><span class="o">=</span><span class="p">[</span><span class="s2">"question"</span><span class="p">],</span>
<span class="linenos">32</span>        <span class="n">template</span><span class="o">=</span><span class="s2">"</span><span class="si">{question}</span><span class="s2">"</span><span class="p">,</span>
<span class="linenos">33</span>    <span class="p">)</span>
<span class="linenos">34</span><span class="p">)</span>
<span class="linenos">35</span><span class="n">messages</span> <span class="o">=</span> <span class="p">[</span><span class="n">review_system_prompt</span><span class="p">,</span> <span class="n">review_human_prompt</span><span class="p">]</span>
<span class="linenos">36</span>
<span class="linenos">37</span><span class="n">review_prompt_template</span> <span class="o">=</span> <span class="n">ChatPromptTemplate</span><span class="p">(</span>
<span class="linenos">38</span>    <span class="n">input_variables</span><span class="o">=</span><span class="p">[</span><span class="s2">"context"</span><span class="p">,</span> <span class="s2">"question"</span><span class="p">],</span>
<span class="linenos">39</span>    <span class="n">messages</span><span class="o">=</span><span class="n">messages</span><span class="p">,</span>
<span class="linenos">40</span><span class="p">)</span>
<span class="linenos">41</span>
<span class="linenos">42</span><span class="n">chat_model</span> <span class="o">=</span> <span class="n">ChatOpenAI</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s2">"gpt-3.5-turbo-0125"</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="linenos">43</span>
<span class="hll"><span class="linenos">44</span><span class="n">review_chain</span> <span class="o">=</span> <span class="n">review_prompt_template</span> <span class="o">|</span> <span class="n">chat_model</span>
</span></code></pre></div>
    
    <button class="codeblock__copy btn btn-outline-secondary border m-1 px-1 d-hover-only" title="Copy to clipboard"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#@copy"></use></svg></span></button>
    <template class="codeblock__copied-template"></template>
    
  </div>
</div>
<p>Lines 1 to 42 are what you’ve already done. Namely, you define <code>review_prompt_template</code> which is a prompt template for answering questions about patient reviews, and you instantiate a <code>gpt-3.5-turbo-0125</code> chat model. In line 44, you define <code>review_chain</code> with the <code>|</code> symbol, which is used to chain <code>review_prompt_template</code> and <code>chat_model</code> together. </p>
<p>This creates an object, <code>review_chain</code>, that can pass questions through <code>review_prompt_template</code> and <code>chat_model</code> in a single function call. In essence, this abstracts away all of the internal details of <code>review_chain</code>, allowing you to interact with the chain as if it were a chat model.</p>
<p>After saving the updated <code>chatbot.py</code>, start a new REPL session in your base project folder. Here’s how you can use <code>review_chain</code>:</p>
<div class="codeblock mb-3 w-100" aria-label="Code block" data-syntax-language="pycon" data-is-repl="true">
  <div class="codeblock__header d-flex justify-content-between codeblock--blue">
    <span class="mr-2 noselect" aria-label="Language">Python</span>
    
    <div class="noselect">
      
        <span class="codeblock__output-toggle" title="Toggle prompts and output"><span class="icon baseline js-codeblock-output-on codeblock__header--icon-lower"><svg><use href="/static/icons.67f62bbffdec.svg#regular--rectangle-terminal"></use></svg></span></span>
      
    </div>
  </div>
  <div style="position: relative;">
    <div class="highlight highlight--with-header"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">langchain_intro.chatbot</span> <span class="kn">import</span> <span class="n">review_chain</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">context</span> <span class="o">=</span> <span class="s2">"I had a great stay!"</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">question</span> <span class="o">=</span> <span class="s2">"Did anyone have a positive experience?"</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">review_chain</span><span class="o">.</span><span class="n">invoke</span><span class="p">({</span><span class="s2">"context"</span><span class="p">:</span> <span class="n">context</span><span class="p">,</span> <span class="s2">"question"</span><span class="p">:</span> <span class="n">question</span><span class="p">})</span>
<span class="go">AIMessage(content='Yes, the patient had a great stay and had a</span>
<span class="go">positive experience at the hospital.')</span>
</code></pre></div>
    
    <button class="codeblock__copy btn btn-outline-secondary border m-1 px-1 d-hover-only" title="Copy to clipboard"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#@copy"></use></svg></span></button>
    <template class="codeblock__copied-template"></template>
    
  </div>
</div>
<p>In this block, you import <code>review_chain</code> and define <code>context</code> and <code>question</code> as before. You then pass a dictionary with the keys <code>context</code> and <code>question</code> into <code>review_chan.invoke()</code>. This passes <code>context</code> and <code>question</code> through the prompt template and chat model to generate an answer. </p>
<div class="alert alert-primary" role="alert">
<p><strong>Note</strong>: When calling chains, you can use all of the same <a href="https://python.langchain.com/docs/expression_language/interface">methods</a> that a chat model supports.</p>
</div>
<p>In general, the LCEL allows you to create arbitrary-length chains with <a href="https://en.wikipedia.org/wiki/Vertical_bar#Pipe">the pipe symbol</a> (<code>|</code>). For instance, if you wanted to format the model’s response, then you could add an <a href="https://python.langchain.com/docs/modules/model_io/output_parsers/">output parser</a> to the chain:</p>
<div class="codeblock mb-3 w-100" aria-label="Code block" data-syntax-language="python">
  <div class="codeblock__header d-flex justify-content-between codeblock--blue">
    <span class="mr-2 noselect" aria-label="Language">Python</span>
    <span class="mr-2" aria-label="Filename"><code style="color: inherit;">langchain_intro/chatbot.py</code></span>
    <div class="noselect">
      
    </div>
  </div>
  <div style="position: relative;">
    <div class="highlight highlight--with-header"><pre><span></span><code><span class="kn">import</span> <span class="nn">dotenv</span>
<span class="kn">from</span> <span class="nn">langchain_openai</span> <span class="kn">import</span> <span class="n">ChatOpenAI</span>
<span class="kn">from</span> <span class="nn">langchain.prompts</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">PromptTemplate</span><span class="p">,</span>
    <span class="n">SystemMessagePromptTemplate</span><span class="p">,</span>
    <span class="n">HumanMessagePromptTemplate</span><span class="p">,</span>
    <span class="n">ChatPromptTemplate</span><span class="p">,</span>
<span class="p">)</span>
<span class="hll"><span class="kn">from</span> <span class="nn">langchain_core.output_parsers</span> <span class="kn">import</span> <span class="n">StrOutputParser</span>
</span>
<span class="c1"># ...</span>

<span class="hll"><span class="n">output_parser</span> <span class="o">=</span> <span class="n">StrOutputParser</span><span class="p">()</span>
</span>
<span class="hll"><span class="n">review_chain</span> <span class="o">=</span> <span class="n">review_prompt_template</span> <span class="o">|</span> <span class="n">chat_model</span> <span class="o">|</span> <span class="n">output_parser</span>
</span></code></pre></div>
    
    <button class="codeblock__copy btn btn-outline-secondary border m-1 px-1 d-hover-only" title="Copy to clipboard"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#@copy"></use></svg></span></button>
    <template class="codeblock__copied-template"></template>
    
  </div>
</div>
<p>Here, you add a <code>StrOutputParser()</code> instance to <code>review_chain</code>, which will make the model’s response more readable. Start a new REPL session and give it a try:</p>
<div class="codeblock mb-3 w-100" aria-label="Code block" data-syntax-language="pycon" data-is-repl="true">
  <div class="codeblock__header d-flex justify-content-between codeblock--blue">
    <span class="mr-2 noselect" aria-label="Language">Python</span>
    
    <div class="noselect">
      
        <span class="codeblock__output-toggle" title="Toggle prompts and output"><span class="icon baseline js-codeblock-output-on codeblock__header--icon-lower"><svg><use href="/static/icons.67f62bbffdec.svg#regular--rectangle-terminal"></use></svg></span></span>
      
    </div>
  </div>
  <div style="position: relative;">
    <div class="highlight highlight--with-header"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">langchain_intro.chatbot</span> <span class="kn">import</span> <span class="n">review_chain</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">context</span> <span class="o">=</span> <span class="s2">"I had a great stay!"</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">question</span> <span class="o">=</span> <span class="s2">"Did anyone have a positive experience?"</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">review_chain</span><span class="o">.</span><span class="n">invoke</span><span class="p">({</span><span class="s2">"context"</span><span class="p">:</span> <span class="n">context</span><span class="p">,</span> <span class="s2">"question"</span><span class="p">:</span> <span class="n">question</span><span class="p">})</span>
<span class="go">'Yes, the patient had a great stay and had a</span>
<span class="go">positive experience at the hospital.'</span>
</code></pre></div>
    
    <button class="codeblock__copy btn btn-outline-secondary border m-1 px-1 d-hover-only" title="Copy to clipboard"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#@copy"></use></svg></span></button>
    <template class="codeblock__copied-template"></template>
    
  </div>
</div>
<p>This block is the same as before, except now you can see that <code>review_chain</code> returns a nicely-formatted string rather than an <code>AIMessage</code>. </p>
<p>The power of chains is in the creativity and flexibility they afford you. You can chain together complex pipelines to create your chatbot, and you end up with an object that executes your pipeline in a single method call. Next up, you’ll layer another object into <code>review_chain</code> to retrieve documents from a vector database. </p>
<div><div class="rounded border border-light" style="display:block;position:relative;"> <div style="display:block;width:100%;padding-top:12.5%;"></div> <div class="rpad rounded border" data-unit="8x1" style="position:absolute;left:0;top:0;right:0;bottom:0;overflow:hidden;"> </div></div><a class="small text-muted" href="https://realpython.com/account/join/" rel="nofollow"> <span class="icon baseline mr-1"><svg><use href="/static/icons.67f62bbffdec.svg#solid--circle-info"></use></svg></span>Remove ads</a></div></section><section class="section3"><h3 id="retrieval-objects">Retrieval Objects<a class="headerlink" href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#retrieval-objects" title="Permanent link"></a></h3>
<p>The goal of <code>review_chain</code> is to answer questions about patient experiences in the hospital from their reviews. So far, you’ve manually passed reviews in as context for the question. While this can work for a small number of reviews, it doesn’t scale well. Moreover, even if you can fit all reviews into the model’s context window, there’s no guarantee it will use the correct reviews when answering a question.</p>
<p>To overcome this, you need a <a href="https://python.langchain.com/docs/modules/data_connection/">retriever</a>. The process of retrieving relevant documents and passing them to a language model to answer questions is known as <a href="https://en.wikipedia.org/wiki/Prompt_engineering#Retrieval-augmented_generation">retrieval-augmented generation (RAG)</a>.</p>
<p>For this example, you’ll store all the reviews in a <a href="https://en.wikipedia.org/wiki/Vector_database">vector database</a> called <a href="https://www.trychroma.com/">ChromaDB</a>. If you’re unfamiliar with this database tool and topics, then check out <a href="https://realpython.com/chromadb-vector-database/">Embeddings and Vector Databases with ChromaDB</a> before continuing.</p>
<p>You can install ChromaDB with the following command:</p>
<div class="codeblock mb-3 w-100" aria-label="Code block" data-syntax-language="console" data-is-repl="true">
  <div class="codeblock__header d-flex justify-content-between codeblock--yellow">
    <span class="mr-2 noselect" aria-label="Language">Shell</span>
    
    <div class="noselect">
      
        <span class="codeblock__output-toggle" title="Toggle prompts and output"><span class="icon baseline js-codeblock-output-on codeblock__header--icon-lower"><svg><use href="/static/icons.67f62bbffdec.svg#regular--rectangle-terminal"></use></svg></span></span>
      
    </div>
  </div>
  <div style="position: relative;">
    <div class="highlight highlight--with-header"><pre><span></span><code><span class="gp gp-VirtualEnv">(venv)</span> <span class="gp">$ </span>python<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span><span class="nv">chromadb</span><span class="o">==</span><span class="m">0</span>.4.22
</code></pre></div>
    
    <button class="codeblock__copy btn btn-outline-secondary border m-1 px-1 d-hover-only" title="Copy to clipboard"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#@copy"></use></svg></span></button>
    <template class="codeblock__copied-template"></template>
    
  </div>
</div>
<p>With this installed, you can use the following code to create a ChromaDB vector database with patient reviews:</p>
<div class="codeblock mb-3 w-100" aria-label="Code block" data-syntax-language="python">
  <div class="codeblock__header d-flex justify-content-between codeblock--blue">
    <span class="mr-2 noselect" aria-label="Language">Python</span>
    <span class="mr-2" aria-label="Filename"><code style="color: inherit;">langchain_intro/create_retriever.py</code></span>
    <div class="noselect">
      
    </div>
  </div>
  <div style="position: relative;">
    <div class="highlight highlight--with-header"><pre><span></span><code><span class="linenos"> 1</span><span class="kn">import</span> <span class="nn">dotenv</span>
<span class="linenos"> 2</span><span class="kn">from</span> <span class="nn">langchain.document_loaders.csv_loader</span> <span class="kn">import</span> <span class="n">CSVLoader</span>
<span class="linenos"> 3</span><span class="kn">from</span> <span class="nn">langchain_community.vectorstores</span> <span class="kn">import</span> <span class="n">Chroma</span>
<span class="linenos"> 4</span><span class="kn">from</span> <span class="nn">langchain_openai</span> <span class="kn">import</span> <span class="n">OpenAIEmbeddings</span>
<span class="linenos"> 5</span>
<span class="linenos"> 6</span><span class="n">REVIEWS_CSV_PATH</span> <span class="o">=</span> <span class="s2">"data/reviews.csv"</span>
<span class="linenos"> 7</span><span class="n">REVIEWS_CHROMA_PATH</span> <span class="o">=</span> <span class="s2">"chroma_data"</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span><span class="n">dotenv</span><span class="o">.</span><span class="n">load_dotenv</span><span class="p">()</span>
<span class="linenos">10</span>
<span class="linenos">11</span><span class="n">loader</span> <span class="o">=</span> <span class="n">CSVLoader</span><span class="p">(</span><span class="n">file_path</span><span class="o">=</span><span class="n">REVIEWS_CSV_PATH</span><span class="p">,</span> <span class="n">source_column</span><span class="o">=</span><span class="s2">"review"</span><span class="p">)</span>
<span class="linenos">12</span><span class="n">reviews</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
<span class="linenos">13</span>
<span class="linenos">14</span><span class="n">reviews_vector_db</span> <span class="o">=</span> <span class="n">Chroma</span><span class="o">.</span><span class="n">from_documents</span><span class="p">(</span>
<span class="linenos">15</span>    <span class="n">reviews</span><span class="p">,</span> <span class="n">OpenAIEmbeddings</span><span class="p">(),</span> <span class="n">persist_directory</span><span class="o">=</span><span class="n">REVIEWS_CHROMA_PATH</span>
<span class="linenos">16</span><span class="p">)</span>
</code></pre></div>
    
    <button class="codeblock__copy btn btn-outline-secondary border m-1 px-1 d-hover-only" title="Copy to clipboard"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#@copy"></use></svg></span></button>
    <template class="codeblock__copied-template"></template>
    
  </div>
</div>
<p>In lines 2 to 4, you import the dependencies needed to create the vector database. You then define <code>REVIEWS_CSV_PATH</code> and <code>REVIEWS_CHROMA_PATH</code>, which are paths where the raw reviews data is stored and where the vector database will store data, respectively.</p>
<p>You’ll get an overview of the hospital system data later, but all you need to know for now is that <code>reviews.csv</code> stores patient reviews. The <code>review</code> column in <code>reviews.csv</code> is a string with the patient’s review.</p>
<p>In lines 11 and 12, you load the reviews using LangChain’s <a href="https://python.langchain.com/docs/integrations/document_loaders/csv"><code>CSVLoader</code></a>. In lines 14 to 16, you create a ChromaDB instance from <code>reviews</code> using the default OpenAI embedding model, and you store the review embeddings at <code>REVIEWS_CHROMA_PATH</code>. </p>
<div class="alert alert-primary" role="alert">
<p><strong>Note</strong>: In practice, if you’re embedding a large document, you should use a <a href="https://python.langchain.com/docs/modules/data_connection/document_transformers/">text splitter</a>. Text splitters break the document into smaller chunks before running them through an embedding model. This is important because embedding models have a fixed-size context window, and as the size of the text grows, an embedding’s ability to accurately represent the text decreases.</p>
<p>For this example, you can embed each review individually because they’re relatively small. </p>
</div>
<p>Next, open a terminal and run the following command from the project directory:</p>
<div class="codeblock mb-3 w-100" aria-label="Code block" data-syntax-language="console" data-is-repl="true">
  <div class="codeblock__header d-flex justify-content-between codeblock--yellow">
    <span class="mr-2 noselect" aria-label="Language">Shell</span>
    
    <div class="noselect">
      
        <span class="codeblock__output-toggle" title="Toggle prompts and output"><span class="icon baseline js-codeblock-output-on codeblock__header--icon-lower"><svg><use href="/static/icons.67f62bbffdec.svg#regular--rectangle-terminal"></use></svg></span></span>
      
    </div>
  </div>
  <div style="position: relative;">
    <div class="highlight highlight--with-header"><pre><span></span><code><span class="gp gp-VirtualEnv">(venv)</span> <span class="gp">$ </span>python<span class="w"> </span>langchain_intro/create_retriever.py
</code></pre></div>
    
    <button class="codeblock__copy btn btn-outline-secondary border m-1 px-1 d-hover-only" title="Copy to clipboard"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#@copy"></use></svg></span></button>
    <template class="codeblock__copied-template"></template>
    
  </div>
</div>
<p>It should only take a minute or so to run, and afterwards you can start performing semantic search over the review embeddings:</p>
<div class="codeblock mb-3 w-100" aria-label="Code block" data-syntax-language="pycon" data-is-repl="true">
  <div class="codeblock__header d-flex justify-content-between codeblock--blue">
    <span class="mr-2 noselect" aria-label="Language">Python</span>
    
    <div class="noselect">
      
        <span class="codeblock__output-toggle" title="Toggle prompts and output"><span class="icon baseline js-codeblock-output-on codeblock__header--icon-lower"><svg><use href="/static/icons.67f62bbffdec.svg#regular--rectangle-terminal"></use></svg></span></span>
      
    </div>
  </div>
  <div style="position: relative;">
    <div class="highlight highlight--with-header"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">dotenv</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">langchain_community.vectorstores</span> <span class="kn">import</span> <span class="n">Chroma</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">langchain_openai</span> <span class="kn">import</span> <span class="n">OpenAIEmbeddings</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">REVIEWS_CHROMA_PATH</span> <span class="o">=</span> <span class="s2">"chroma_data/"</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">dotenv</span><span class="o">.</span><span class="n">load_dotenv</span><span class="p">()</span>
<span class="go">True</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">reviews_vector_db</span> <span class="o">=</span> <span class="n">Chroma</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">persist_directory</span><span class="o">=</span><span class="n">REVIEWS_CHROMA_PATH</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">embedding_function</span><span class="o">=</span><span class="n">OpenAIEmbeddings</span><span class="p">(),</span>
<span class="gp">... </span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">question</span> <span class="o">=</span> <span class="s2">"""Has anyone complained about</span>
<span class="gp">... </span><span class="s2">           communication with the hospital staff?"""</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">relevant_docs</span> <span class="o">=</span> <span class="n">reviews_vector_db</span><span class="o">.</span><span class="n">similarity_search</span><span class="p">(</span><span class="n">question</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">relevant_docs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">page_content</span>
<span class="go">'review_id: 73\nvisit_id: 7696\nreview: I had a frustrating experience</span>
<span class="go">at the hospital. The communication between the medical staff and me was</span>
<span class="go">unclear, leading to misunderstandings about my treatment plan. Improvement</span>
<span class="go">is needed in this area.\nphysician_name: Maria Thompson\nhospital_name:</span>
<span class="go">Little-Spencer\npatient_name: Terri Smith'</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">relevant_docs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">page_content</span>
<span class="go">'review_id: 521\nvisit_id: 631\nreview: I had a challenging time at the</span>
<span class="go">hospital. The medical care was adequate, but the lack of communication</span>
<span class="go">between the staff and me left me feeling frustrated and confused about my</span>
<span class="go">treatment plan.\nphysician_name: Samantha Mendez\nhospital_name:</span>
<span class="go">Richardson-Powell\npatient_name: Kurt Gordon'</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">relevant_docs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">page_content</span>
<span class="go">'review_id: 785\nvisit_id: 2593\nreview: My stay at the hospital was challenging.</span>
<span class="go">The medical care was adequate, but the lack of communication from the staff</span>
<span class="go">created some frustration.\nphysician_name: Brittany Harris\nhospital_name:</span>
<span class="go">Jones, Taylor and Garcia\npatient_name: Ryan Jacobs'</span>
</code></pre></div>
    
    <button class="codeblock__copy btn btn-outline-secondary border m-1 px-1 d-hover-only" title="Copy to clipboard"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#@copy"></use></svg></span></button>
    <template class="codeblock__copied-template"></template>
    
  </div>
</div>
<p>You import the dependencies needed to call ChromaDB and specify the path to the stored ChromaDB data in <code>REVIEWS_CHROMA_PATH</code>. You then load environment variables using <code>dotenv.load_dotenv()</code> and create a new <code>Chroma</code> instance pointing to your vector database. Notice how you have to specify an embedding function again when connecting to your vector database. Be sure this is the same embedding function that you used to create the embeddings. </p>
<p>Next, you define a question and call <code>.similarity_search()</code> on <code>reviews_vector_db</code>, passing in <code>question</code> and <code>k=3</code>. This creates an embedding for the question and searches the vector database for the three most similar review embeddings to question embedding. In this case, you see three reviews where patients complained about communication, which is exactly what you asked for!</p>
<p>The last thing to do is add your reviews retriever  to <code>review_chain</code> so that relevant reviews are passed to the prompt as context. Here’s how you do that:</p>
<div class="codeblock mb-3 w-100" aria-label="Code block" data-syntax-language="python">
  <div class="codeblock__header d-flex justify-content-between codeblock--blue">
    <span class="mr-2 noselect" aria-label="Language">Python</span>
    <span class="mr-2" aria-label="Filename"><code style="color: inherit;">langchain_intro/chatbot.py</code></span>
    <div class="noselect">
      
    </div>
  </div>
  <div style="position: relative;">
    <div class="highlight highlight--with-header"><pre><span></span><code><span class="kn">import</span> <span class="nn">dotenv</span>
<span class="kn">from</span> <span class="nn">langchain_openai</span> <span class="kn">import</span> <span class="n">ChatOpenAI</span>
<span class="kn">from</span> <span class="nn">langchain.prompts</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">PromptTemplate</span><span class="p">,</span>
    <span class="n">SystemMessagePromptTemplate</span><span class="p">,</span>
    <span class="n">HumanMessagePromptTemplate</span><span class="p">,</span>
    <span class="n">ChatPromptTemplate</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">langchain_core.output_parsers</span> <span class="kn">import</span> <span class="n">StrOutputParser</span>
<span class="hll"><span class="kn">from</span> <span class="nn">langchain_community.vectorstores</span> <span class="kn">import</span> <span class="n">Chroma</span>
</span><span class="hll"><span class="kn">from</span> <span class="nn">langchain_openai</span> <span class="kn">import</span> <span class="n">OpenAIEmbeddings</span>
</span><span class="hll"><span class="kn">from</span> <span class="nn">langchain.schema.runnable</span> <span class="kn">import</span> <span class="n">RunnablePassthrough</span>
</span>
<span class="n">REVIEWS_CHROMA_PATH</span> <span class="o">=</span> <span class="s2">"chroma_data/"</span>

<span class="c1"># ...</span>

<span class="n">reviews_vector_db</span> <span class="o">=</span> <span class="n">Chroma</span><span class="p">(</span>
    <span class="n">persist_directory</span><span class="o">=</span><span class="n">REVIEWS_CHROMA_PATH</span><span class="p">,</span>
    <span class="n">embedding_function</span><span class="o">=</span><span class="n">OpenAIEmbeddings</span><span class="p">()</span>
<span class="p">)</span>

<span class="n">reviews_retriever</span>  <span class="o">=</span> <span class="n">reviews_vector_db</span><span class="o">.</span><span class="n">as_retriever</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">review_chain</span> <span class="o">=</span> <span class="p">(</span>
<span class="hll">    <span class="p">{</span><span class="s2">"context"</span><span class="p">:</span> <span class="n">reviews_retriever</span><span class="p">,</span> <span class="s2">"question"</span><span class="p">:</span> <span class="n">RunnablePassthrough</span><span class="p">()}</span>
</span>    <span class="o">|</span> <span class="n">review_prompt_template</span>
    <span class="o">|</span> <span class="n">chat_model</span>
    <span class="o">|</span> <span class="n">StrOutputParser</span><span class="p">()</span>
<span class="p">)</span>
</code></pre></div>
    
    <button class="codeblock__copy btn btn-outline-secondary border m-1 px-1 d-hover-only" title="Copy to clipboard"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#@copy"></use></svg></span></button>
    <template class="codeblock__copied-template"></template>
    
  </div>
</div>
<p>As before, you import ChromaDB’s dependencies, specify the path to your ChromaDB data, and instantiate a new <code>Chroma</code> object. You then create <code>reviews_retriever</code> by calling <code>.as_retriever()</code> on <code>reviews_vector_db</code> to create a retriever object that you’ll add to <code>review_chain</code>. Because you specified <code>k=10</code>, the retriever will fetch the ten reviews most similar to the user’s question.</p>
<p>You then add a dictionary with <code>context</code> and <code>question</code> keys to the front of <code>review_chain</code>. Instead of passing <code>context</code> in manually, <code>review_chain</code> will pass your question to the retriever to pull relevant reviews. Assigning <code>question</code> to a <a href="https://python.langchain.com/docs/expression_language/how_to/passthrough"><code>RunnablePassthrough</code></a> object ensures the question gets passed unchanged to the next step in the chain.</p>
<p>You now have a fully functioning chain that can answer questions about patient experiences from their reviews. Start a new REPL session and try it out:</p>
<div class="codeblock mb-3 w-100" aria-label="Code block" data-syntax-language="pycon" data-is-repl="true">
  <div class="codeblock__header d-flex justify-content-between codeblock--blue">
    <span class="mr-2 noselect" aria-label="Language">Python</span>
    
    <div class="noselect">
      
        <span class="codeblock__output-toggle" title="Toggle prompts and output"><span class="icon baseline js-codeblock-output-on codeblock__header--icon-lower"><svg><use href="/static/icons.67f62bbffdec.svg#regular--rectangle-terminal"></use></svg></span></span>
      
    </div>
  </div>
  <div style="position: relative;">
    <div class="highlight highlight--with-header"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">langchain_intro.chatbot</span> <span class="kn">import</span> <span class="n">review_chain</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">question</span> <span class="o">=</span> <span class="s2">"""Has anyone complained about</span>
<span class="gp">... </span><span class="s2">           communication with the hospital staff?"""</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">review_chain</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">question</span><span class="p">)</span>
<span class="go">'Yes, several patients have complained about communication</span>
<span class="go">with the hospital staff. Terri Smith mentioned that the</span>
<span class="go">communication between the medical staff and her was unclear,</span>
<span class="go">leading to misunderstandings about her treatment plan.</span>
<span class="go">Kurt Gordon also mentioned that the lack of communication</span>
<span class="go">between the staff and him left him feeling frustrated and</span>
<span class="go">confused about his treatment plan. Ryan Jacobs also experienced</span>
<span class="go">frustration due to the lack of communication from the staff.</span>
<span class="go">Shannon Williams also mentioned that the lack of communication</span>
<span class="go">between the staff and her made her stay at the hospital less enjoyable.'</span>
</code></pre></div>
    
    <button class="codeblock__copy btn btn-outline-secondary border m-1 px-1 d-hover-only" title="Copy to clipboard"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#@copy"></use></svg></span></button>
    <template class="codeblock__copied-template"></template>
    
  </div>
</div>
<p>As you can see, you only call <code>review_chain.invoke(question)</code> to get retrieval-augmented answers about patient experiences from their reviews. You’ll improve upon this chain later by storing review embeddings, along with other metadata, in Neo4j.</p>
<p>Now that you understand chat models, prompts, chains, and retrieval, you’re ready to dive into the last LangChain concept—agents.</p>
<div><div class="rounded border border-light" style="display:block;position:relative;"> <div style="display:block;width:100%;padding-top:12.5%;"></div> <div class="rpad rounded border" data-unit="8x1" style="position:absolute;left:0;top:0;right:0;bottom:0;overflow:hidden;"> </div></div><a class="small text-muted" href="https://realpython.com/account/join/" rel="nofollow"> <span class="icon baseline mr-1"><svg><use href="/static/icons.67f62bbffdec.svg#solid--circle-info"></use></svg></span>Remove ads</a></div></section><section class="section3"><h3 id="agents">Agents<a class="headerlink" href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#agents" title="Permanent link"></a></h3>
<p>So far, you’ve created a chain to answer questions using patient reviews. What if you want your chatbot to also answer questions about other hospital data, such as hospital wait times? Ideally, your chatbot can seamlessly switch between answering patient review and wait time questions depending on the user’s query. To accomplish this, you’ll need the following components:</p>
<ol>
<li>The patient review chain you already created</li>
<li>A function that can look up wait times at a hospital</li>
<li>A way for an LLM to know when it should answer questions about patient experiences or look up wait times</li>
</ol>
<p>To accomplish the third capability, you need an <a href="https://python.langchain.com/docs/modules/agents/">agent</a>.</p>
<p>An agent is a language model that decides on a sequence of actions to execute. Unlike chains where the sequence of actions is hard-coded, agents use a language model to determine which actions to take and in which order.</p>
<p>Before building the agent, create the following function to generate fake wait times for a hospital:</p>
<div class="codeblock mb-3 w-100" aria-label="Code block" data-syntax-language="python">
  <div class="codeblock__header d-flex justify-content-between codeblock--blue">
    <span class="mr-2 noselect" aria-label="Language">Python</span>
    <span class="mr-2" aria-label="Filename"><code style="color: inherit;">langchain_intro/tools.py</code></span>
    <div class="noselect">
      
    </div>
  </div>
  <div style="position: relative;">
    <div class="highlight highlight--with-header"><pre><span></span><code><span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="k">def</span> <span class="nf">get_current_wait_time</span><span class="p">(</span><span class="n">hospital</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Dummy function to generate fake wait times"""</span>

    <span class="k">if</span> <span class="n">hospital</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">"A"</span><span class="p">,</span> <span class="s2">"B"</span><span class="p">,</span> <span class="s2">"C"</span><span class="p">,</span> <span class="s2">"D"</span><span class="p">]:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">"Hospital </span><span class="si">{</span><span class="n">hospital</span><span class="si">}</span><span class="s2"> does not exist"</span>

    <span class="c1"># Simulate API call delay</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10000</span><span class="p">)</span>
</code></pre></div>
    
    <button class="codeblock__copy btn btn-outline-secondary border m-1 px-1 d-hover-only" title="Copy to clipboard"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#@copy"></use></svg></span></button>
    <template class="codeblock__copied-template"></template>
    
  </div>
</div>
<p>In <code>get_current_wait_time()</code>, you pass in a hospital name, check if it’s valid, and then generate a random number to simulate a wait time. In reality, this would be some sort of database query or API call, but this will serve the same purpose for this demonstration. </p>
<p>You can now create an agent that decides between <code>get_current_wait_time()</code> and <code>review_chain.invoke()</code> depending on the question:</p>
<div class="codeblock mb-3 w-100" aria-label="Code block" data-syntax-language="python">
  <div class="codeblock__header d-flex justify-content-between codeblock--blue">
    <span class="mr-2 noselect" aria-label="Language">Python</span>
    <span class="mr-2" aria-label="Filename"><code style="color: inherit;">langchain_intro/chatbot.py</code></span>
    <div class="noselect">
      
    </div>
  </div>
  <div style="position: relative;">
    <div class="highlight highlight--with-header"><pre><span></span><code><span class="kn">import</span> <span class="nn">dotenv</span>
<span class="kn">from</span> <span class="nn">langchain_openai</span> <span class="kn">import</span> <span class="n">ChatOpenAI</span>
<span class="kn">from</span> <span class="nn">langchain.prompts</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">PromptTemplate</span><span class="p">,</span>
    <span class="n">SystemMessagePromptTemplate</span><span class="p">,</span>
    <span class="n">HumanMessagePromptTemplate</span><span class="p">,</span>
    <span class="n">ChatPromptTemplate</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">langchain_core.output_parsers</span> <span class="kn">import</span> <span class="n">StrOutputParser</span>
<span class="kn">from</span> <span class="nn">langchain_community.vectorstores</span> <span class="kn">import</span> <span class="n">Chroma</span>
<span class="kn">from</span> <span class="nn">langchain_openai</span> <span class="kn">import</span> <span class="n">OpenAIEmbeddings</span>
<span class="kn">from</span> <span class="nn">langchain.schema.runnable</span> <span class="kn">import</span> <span class="n">RunnablePassthrough</span>
<span class="hll"><span class="kn">from</span> <span class="nn">langchain.agents</span> <span class="kn">import</span> <span class="p">(</span>
</span><span class="hll">    <span class="n">create_openai_functions_agent</span><span class="p">,</span>
</span><span class="hll">    <span class="n">Tool</span><span class="p">,</span>
</span><span class="hll">    <span class="n">AgentExecutor</span><span class="p">,</span>
</span><span class="hll"><span class="p">)</span>
</span><span class="hll"><span class="kn">from</span> <span class="nn">langchain</span> <span class="kn">import</span> <span class="n">hub</span>
</span><span class="hll"><span class="kn">from</span> <span class="nn">langchain_intro.tools</span> <span class="kn">import</span> <span class="n">get_current_wait_time</span>
</span>
<span class="c1"># ...</span>

<span class="n">tools</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">Tool</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">"Reviews"</span><span class="p">,</span>
        <span class="n">func</span><span class="o">=</span><span class="n">review_chain</span><span class="o">.</span><span class="n">invoke</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">"""Useful when you need to answer questions</span>
<span class="s2">        about patient reviews or experiences at the hospital.</span>
<span class="s2">        Not useful for answering questions about specific visit</span>
<span class="s2">        details such as payer, billing, treatment, diagnosis,</span>
<span class="s2">        chief complaint, hospital, or physician information.</span>
<span class="s2">        Pass the entire question as input to the tool. For instance,</span>
<span class="s2">        if the question is "What do patients think about the triage system?",</span>
<span class="s2">        the input should be "What do patients think about the triage system?"</span>
<span class="s2">        """</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">Tool</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">"Waits"</span><span class="p">,</span>
        <span class="n">func</span><span class="o">=</span><span class="n">get_current_wait_time</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">"""Use when asked about current wait times</span>
<span class="s2">        at a specific hospital. This tool can only get the current</span>
<span class="s2">        wait time at a hospital and does not have any information about</span>
<span class="s2">        aggregate or historical wait times. This tool returns wait times in</span>
<span class="s2">        minutes. Do not pass the word "hospital" as input,</span>
<span class="s2">        only the hospital name itself. For instance, if the question is</span>
<span class="s2">        "What is the wait time at hospital A?", the input should be "A".</span>
<span class="s2">        """</span><span class="p">,</span>
    <span class="p">),</span>
<span class="p">]</span>

<span class="n">hospital_agent_prompt</span> <span class="o">=</span> <span class="n">hub</span><span class="o">.</span><span class="n">pull</span><span class="p">(</span><span class="s2">"hwchase17/openai-functions-agent"</span><span class="p">)</span>

<span class="n">agent_chat_model</span> <span class="o">=</span> <span class="n">ChatOpenAI</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="s2">"gpt-3.5-turbo-1106"</span><span class="p">,</span>
    <span class="n">temperature</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">hospital_agent</span> <span class="o">=</span> <span class="n">create_openai_functions_agent</span><span class="p">(</span>
    <span class="n">llm</span><span class="o">=</span><span class="n">agent_chat_model</span><span class="p">,</span>
    <span class="n">prompt</span><span class="o">=</span><span class="n">hospital_agent_prompt</span><span class="p">,</span>
    <span class="n">tools</span><span class="o">=</span><span class="n">tools</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">hospital_agent_executor</span> <span class="o">=</span> <span class="n">AgentExecutor</span><span class="p">(</span>
    <span class="n">agent</span><span class="o">=</span><span class="n">hospital_agent</span><span class="p">,</span>
    <span class="n">tools</span><span class="o">=</span><span class="n">tools</span><span class="p">,</span>
    <span class="n">return_intermediate_steps</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>
    
    <button class="codeblock__copy btn btn-outline-secondary border m-1 px-1 d-hover-only" title="Copy to clipboard"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#@copy"></use></svg></span></button>
    <template class="codeblock__copied-template"></template>
    
  </div>
</div>
<p>In this block, you import a few additional dependencies that you’ll need to create the agent. You then define a list of <a href="https://python.langchain.com/docs/modules/agents/tools/"><code>Tool</code></a> objects. A <code>Tool</code> is an interface that an agent uses to interact with a function. For instance, the first tool is named <code>Reviews</code> and it calls <code>review_chain.invoke()</code> if the question meets the criteria of <code>description</code>.</p>
<p>Notice how <code>description</code> gives the agent instructions as to when it should call the tool. This is where good prompt engineering skills are paramount to ensuring the LLM calls the correct tool with the correct inputs.</p>
<p>The second <code>Tool</code> in <code>tools</code> is named <code>Waits</code>, and it calls <code>get_current_wait_time()</code>. Again, the agent has to know when to use the <code>Waits</code> tool and what inputs to pass into it depending on the <code>description</code>.</p>
<p>Next, you initialize a <code>ChatOpenAI</code> object using <strong>gpt-3.5-turbo-1106</strong> as your language model. You then create an OpenAI functions agent with <code>create_openai_functions_agent()</code>. This creates an agent designed to pass inputs to functions. It does this by returning valid JSON objects that store function inputs and their corresponding value.</p>
<p>To create the agent run time, you pass the agent and tools into <a href="https://python.langchain.com/docs/modules/agents/concepts#agentexecutor"><code>AgentExecutor</code></a>. Setting <code>return_intermediate_steps</code> and <code>verbose</code> to <code>True</code> will allow you to see the agent’s thought process and the tools it calls.</p>
<p>Start a new REPL session to give your new agent a spin:</p>
<div class="codeblock mb-3 w-100" aria-label="Code block" data-syntax-language="pycon" data-is-repl="true">
  <div class="codeblock__header d-flex justify-content-between codeblock--blue">
    <span class="mr-2 noselect" aria-label="Language">Python</span>
    
    <div class="noselect">
      
        <span class="codeblock__output-toggle" title="Toggle prompts and output"><span class="icon baseline js-codeblock-output-on codeblock__header--icon-lower"><svg><use href="/static/icons.67f62bbffdec.svg#regular--rectangle-terminal"></use></svg></span></span>
      
    </div>
  </div>
  <div style="position: relative;">
    <div class="highlight highlight--with-header"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">langchain_intro.chatbot</span> <span class="kn">import</span> <span class="n">hospital_agent_executor</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">hospital_agent_executor</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span>
<span class="gp">... </span>    <span class="p">{</span><span class="s2">"input"</span><span class="p">:</span> <span class="s2">"What is the current wait time at hospital C?"</span><span class="p">}</span>
<span class="gp">... </span><span class="p">)</span>

<span class="go">&gt; Entering new AgentExecutor chain...</span>

<span class="go">Invoking: `Waits` with `C`</span>

<span class="go">1374The current wait time at Hospital C is 1374 minutes.</span>

<span class="go">&gt; Finished chain.</span>
<span class="go">{'input': 'What is the current wait time at hospital C?',</span>
<span class="go">'output': 'The current wait time at Hospital C is 1374 minutes.',</span>
<span class="go">'intermediate_steps': [(AgentActionMessageLog(tool='Waits',</span>
<span class="go">tool_input='C', log='\nInvoking: `Waits` with `C`\n\n\n',</span>
<span class="go">message_log=[AIMessage(content='', additional_kwargs={'function_call':</span>
<span class="go">{'arguments': '{"__arg1":"C"}', 'name': 'Waits'}})]), 1374)]}</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">hospital_agent_executor</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span>
<span class="gp">... </span>    <span class="p">{</span><span class="s2">"input"</span><span class="p">:</span> <span class="s2">"What have patients said about their comfort at the hospital?"</span><span class="p">}</span>
<span class="gp">... </span><span class="p">)</span>

<span class="go">&gt; Entering new AgentExecutor chain...</span>

<span class="go">Invoking: `Reviews` with `What have patients said about their comfort at the</span>
<span class="go">hospital?`</span>

<span class="go">Patients have mentioned both positive and negative aspects of their comfort at</span>
<span class="go">the hospital. One patient mentioned that the hospital's dedication to patient</span>
<span class="go">comfort was evident in the well-designed private rooms and comfortable furnishings,</span>
<span class="go">which made their recovery more bearable and contributed to an overall positive</span>
<span class="go">experience. However, other patients mentioned that the uncomfortable beds made</span>
<span class="go">it difficult for them to get a good night's sleep during their stay, affecting</span>
<span class="go">their overall comfort. Another patient mentioned that the outdated and</span>
<span class="go">uncomfortable beds affected their overall comfort, despite the doctors being</span>
<span class="go">knowledgeable and the hospital having a clean environment. Patients have shared</span>
<span class="go">mixed feedback about their comfort at the hospital. Some have praised the well-designed</span>
<span class="go">private rooms and comfortable furnishings, which contributed to a positive experience.</span>
<span class="go">However, others have mentioned discomfort due to the outdated and uncomfortable beds,</span>
<span class="go">affecting their overall comfort despite the hospital's clean environment and knowledgeable</span>
<span class="go">doctors.</span>

<span class="go">&gt; Finished chain.</span>
<span class="go">{'input': 'What have patients said about their comfort at the hospital?', 'output':</span>
<span class="go">"Patients have shared mixed feedback about their comfort at the hospital. Some have</span>
<span class="go">praised the well-designed private rooms and comfortable furnishings, which contributed</span>
<span class="go">to a positive experience. However, others have mentioned discomfort due to the outdated</span>
<span class="go">and uncomfortable beds, affecting their overall comfort despite the hospital's clean</span>
<span class="go">environment and knowledgeable doctors.", 'intermediate_steps':</span>
<span class="go">[(AgentActionMessageLog(tool='Reviews', tool_input='What have patients said about their</span>
<span class="go">comfort at the hospital?', log='\nInvoking: `Reviews` with `What have patients said about</span>
<span class="go">their comfort at the hospital?`\n\n\n', message_log=[AIMessage(content='',</span>
<span class="go">additional_kwargs={'function_call': {'arguments': '{"__arg1":"What have patients said about</span>
<span class="go">their comfort at the hospital?"}', 'name': 'Reviews'}})]), "Patients have mentioned both</span>
<span class="go">positive and negative aspects of their comfort at the hospital. One patient mentioned that</span>
<span class="go">the hospital's dedication to patient comfort was evident in the well-designed private rooms</span>
<span class="go">and comfortable furnishings, which made their recovery more bearable and contributed to an</span>
<span class="go">overall positive experience. However, other patients mentioned that the uncomfortable beds</span>
<span class="go">made it difficult for them to get a good night's sleep during their stay, affecting their</span>
<span class="go">overall comfort. Another patient mentioned that the outdated and uncomfortable beds affected</span>
<span class="go">their overall comfort, despite the doctors being knowledgeable and the hospital having a clean</span>
<span class="go">environment.")]}</span>
</code></pre></div>
    
    <button class="codeblock__copy btn btn-outline-secondary border m-1 px-1 d-hover-only" title="Copy to clipboard"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#@copy"></use></svg></span></button>
    <template class="codeblock__copied-template"></template>
    
  </div>
</div>
<p>You first import the agent and then call <code>hospital_agent_executor.invoke()</code> with a question about a wait time. As indicated in the output, the agent knows that you’re asking about a wait time, and it passes <code>C</code> as input to the <code>Waits</code> tool. The <code>Waits</code> tool then calls <code>get_current_wait_time(hospital="C")</code> and returns the corresponding wait time to the agent. The agent then uses this wait time to generate its final output. </p>
<p>A similar process happens when you ask the agent about patient experience reviews, except this time the agent knows to call the <code>Reviews</code> tool with <em>What have patients said about their comfort at the
hospital?</em> as input. The <code>Reviews</code> tool runs <code>review_chain.invoke()</code> using your full question as input, and the agent uses the response to generate its output. </p>
<p>This is a profound capability. Agents give language models the ability to perform just about any task that you can write code for. Imagine all of the amazing, and potentially dangerous, chatbots you could build with agents.</p>
<p>You now have all of the prerequisite LangChain knowledge needed to build a custom chatbot. Next up, you’ll put on your AI engineer hat and learn about the business requirements and data needed to build your hospital system chatbot.</p>
<p>All of the code you’ve written so far was intended to teach you the fundamentals of LangChain, and it won’t be included in your final chatbot. Feel free to start with an empty directory in Step 2, where you’ll begin building your chatbot. </p>
<div><div class="rounded border border-light" style="display:block;position:relative;"> <div style="display:block;width:100%;padding-top:12.5%;"></div> <div class="rpad rounded border" data-unit="8x1" style="position:absolute;left:0;top:0;right:0;bottom:0;overflow:hidden;"> </div></div><a class="small text-muted" href="https://realpython.com/account/join/" rel="nofollow"> <span class="icon baseline mr-1"><svg><use href="/static/icons.67f62bbffdec.svg#solid--circle-info"></use></svg></span>Remove ads</a></div></section></section><section class="section2"><h2 id="step-2-understand-the-business-requirements-and-data">Step 2: Understand the Business Requirements and Data<a class="headerlink" href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#step-2-understand-the-business-requirements-and-data" title="Permanent link"></a></h2>
<p>Before you start working on any AI project, you need to understand the problem that you want to solve and make a plan for how you’re going to solve it. This involves clearly defining the problem, gathering requirements, understanding the data and technology available to you, and setting clear expectations with stakeholders. For this project, you’ll start by defining the problem and gathering business requirements for your chatbot.</p>
<section class="section3"><h3 id="understand-the-problem-and-requirements">Understand the Problem and Requirements<a class="headerlink" href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#understand-the-problem-and-requirements" title="Permanent link"></a></h3>
<p>Imagine you’re an AI engineer working for a large hospital system in the US. Your stakeholders would like more visibility into the ever-changing data they collect. <em>They want answers to ad-hoc questions about patients, visits, physicians, hospitals, and insurance payers</em> without having to understand a query language like SQL, request a report from an analyst, or wait for someone to build a dashboard. </p>
<p>To accomplish this, your stakeholders want an internal chatbot tool, similar to ChatGPT, that can answer questions about your company’s data. After meeting to gather requirements, you’re provided with a list of the kinds of questions your chatbot should answer:</p>
<ul>
<li>What is the current wait time at XYZ hospital?</li>
<li>Which hospital currently has the shortest wait time?</li>
<li>At which hospitals are patients complaining about billing and insurance issues?</li>
<li>Have any patients complained about the hospital being unclean?</li>
<li>What have patients said about how doctors and nurses communicate with them?</li>
<li>What are patients saying about the nursing staff at XYZ hospital?</li>
<li>What was the total billing amount charged to <a href="https://en.wikipedia.org/wiki/Cigna">Cigna</a> payers in 2023?</li>
<li>How many patients has Dr. John Doe treated?</li>
<li>How many visits are open and what is their average duration in days?</li>
<li>Which physician has the lowest average visit duration in days?</li>
<li>How much was billed for patient 789’s stay?</li>
<li>Which hospital worked with the most Cigna patients in 2023?</li>
<li>What’s the average billing amount for emergency visits by hospital?</li>
<li>Which state had the largest percent increase inedicaid visits from 2022 to 2023?</li>
</ul>
<p>You can answer questions like <em>What was the total billing amount charged to Cigna payers in 2023?</em> with aggregate statistics using a query language like SQL. Crucially, these questions have a single objective answer. You could run pre-defined queries to answer these, but any time a stakeholder has a new or slightly nuanced question, you have to write a new query. To avoid this, your chatbot should dynamically generate accurate queries.</p>
<p>Questions like <em>Have any patients complained about the hospital being unclean?</em> or <em>What have patients said about how doctors and nurses communicate with them?</em> are more subjective and might have many acceptable answers. Your chatbot will need to read through documents, such as patient reviews, to answer these kinds of questions.</p>
<p>Ultimately, your stakeholders want a single chat interface that can seamlessly answer both subjective and objective questions. This means, when presented with a question, your chatbot needs to know what type of question is being asked and which data source to pull from.</p>
<p>For instance, if asked <em>How much was billed for patient 789’s stay?</em>, your chatbot should know it needs to query a database to find the answer. If asked <em>What have patients said about how doctors and nurses communicate with them?</em>, your chatbot should know it needs to read and summarize patient reviews.</p>
<p>Next up, you’ll explore the data your hospital system records, which is arguably the most important prerequisite to building your chatbot. </p>
</section><section class="section3"><h3 id="explore-the-available-data">Explore the Available Data<a class="headerlink" href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#explore-the-available-data" title="Permanent link"></a></h3>
<p>Before building your chatbot, you need a thorough understanding of the data it will use to respond to user queries. This will help you determine what’s feasible and how you want to structure the data so that your chatbot can easily access it. All of the data you’ll use in this article was synthetically generated, and much of it was derived from a popular <a href="https://www.kaggle.com/datasets/prasad22/healthcare-dataset">health care dataset</a> on Kaggle.</p>
<p>In practice, the following datasets would likely be stored as tables in a SQL database, but you’ll work with CSV files to keep the focus on building the chatbot. This section will give you a detailed description of each CSV file.</p>
<p>You’ll need to place all CSV files that are part of this project in your <code>data/</code> folder before continuing with the tutorial. Make sure that you downloaded them from the materials and placed them in your <code>data/</code> folder:</p>
<div class="alert alert-warning" role="alert">
<p><strong markdown="1">Get Your Code:</strong> <a href="https://realpython.com/bonus/build-llm-rag-chatbot-with-langchain-code/" class="alert-link" data-toggle="modal" data-target="#modal-build-llm-rag-chatbot-with-langchain-code" data-focus="false" markdown="1">Click here to download the free source code</a> for your LangChain chatbot.</p>
</div>
<section class="section4"><h4 id="hospitalscsv">hospitals.csv<a class="headerlink" href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#hospitalscsv" title="Permanent link"></a></h4>
<p>The <code>hospitals.csv</code> file records information on each hospital that your company manages. There 30 hospitals and three <a href="https://en.wikipedia.org/wiki/Field_(computer_science)">fields</a> in this file:</p>
<ul>
<li><code>hospital_id</code>: An integer that uniquely identifies a hospital.</li>
<li><code>hospital_name</code>: The hospital’s name.</li>
<li><code>hospital_state</code>: The state the hospital is located in. </li>
</ul>
<p>If you’re familiar with traditional SQL databases and the <a href="https://en.wikipedia.org/wiki/Star_schema">star schema</a>, you can think of <code>hospitals.csv</code> as a <a href="https://en.wikipedia.org/wiki/Star_schema#Dimension_tables">dimension table</a>. Dimension tables are relatively short and contain descriptive information or attributes that provide context to the data in <a href="https://en.wikipedia.org/wiki/Star_schema#Fact_tables">fact tables</a>. Fact tables record events about the entities stored in dimension tables, and they tend to be longer tables.</p>
<p>In this case, <code>hospitals.csv</code> records information specific to hospitals, but you can join it to fact tables to answer questions about which patients, physicians, and payers are related to the hospital. This will be more clear when you explore <code>visits.csv</code>.</p>
<p>If you’re curious, you can inspect the first few rows of <code>hospitals.csv</code> using a dataframe library like <a href="https://realpython.com/polars-python/#the-python-polars-library">Polars</a>. Make sure Polars is <a href="https://realpython.com/polars-python/#installing-python-polars">installed</a> in your <a href="https://realpython.com/python-virtual-environments-a-primer/">virtual environment</a>, and run the following code:</p>
<div class="codeblock mb-3 w-100" aria-label="Code block" data-syntax-language="pycon" data-is-repl="true">
  <div class="codeblock__header d-flex justify-content-between codeblock--blue">
    <span class="mr-2 noselect" aria-label="Language">Python</span>
    
    <div class="noselect">
      
        <span class="codeblock__output-toggle" title="Toggle prompts and output"><span class="icon baseline js-codeblock-output-on codeblock__header--icon-lower"><svg><use href="/static/icons.67f62bbffdec.svg#regular--rectangle-terminal"></use></svg></span></span>
      
    </div>
  </div>
  <div style="position: relative;">
    <div class="highlight highlight--with-header"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">polars</span> <span class="k">as</span> <span class="nn">pl</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">HOSPITAL_DATA_PATH</span> <span class="o">=</span> <span class="s2">"data/hospitals.csv"</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data_hospitals</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">HOSPITAL_DATA_PATH</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">data_hospitals</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(30, 3)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">data_hospitals</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="go">shape: (5, 3)</span>
<span class="go">┌─────────────┬───────────────────────────┬────────────────┐</span>
<span class="go">│ hospital_id ┆ hospital_name             ┆ hospital_state │</span>
<span class="go">│ ---         ┆ ---                       ┆ ---            │</span>
<span class="go">│ i64         ┆ str                       ┆ str            │</span>
<span class="go">╞═════════════╪═══════════════════════════╪════════════════╡</span>
<span class="go">│ 0           ┆ Wallace-Hamilton          ┆ CO             │</span>
<span class="go">│ 1           ┆ Burke, Griffin and Cooper ┆ NC             │</span>
<span class="go">│ 2           ┆ Walton LLC                ┆ FL             │</span>
<span class="go">│ 3           ┆ Garcia Ltd                ┆ NC             │</span>
<span class="go">│ 4           ┆ Jones, Brown and Murray   ┆ NC             │</span>
<span class="go">└─────────────┴───────────────────────────┴────────────────┘</span>
</code></pre></div>
    
    <button class="codeblock__copy btn btn-outline-secondary border m-1 px-1 d-hover-only" title="Copy to clipboard"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#@copy"></use></svg></span></button>
    <template class="codeblock__copied-template"></template>
    
  </div>
</div>
<p>In this code block, you import Polars, define the path to <code>hospitals.csv</code>, read the data into a Polars DataFrame, display the shape of the data, and display the first 5 rows. This shows you, for example, that <strong>Walton, LLC</strong> hospital has an ID of <strong>2</strong> and is located in the state of Florida, <strong>FL</strong>. </p>
</section><section class="section4"><h4 id="physicianscsv">physicians.csv<a class="headerlink" href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#physicianscsv" title="Permanent link"></a></h4>
<p>The <code>physicians.csv</code> file contains data about the physicians that work for your hospital system. This dataset has the following fields:</p>
<ul>
<li><code>physician_id</code>: An integer that uniquely identifies each physician.</li>
<li><code>physician_name</code>: The physician’s name.</li>
<li><code>physician_dob</code>: The physician’s date of birth. </li>
<li><code>physician_grad_year</code>: The year the physician graduated medical school.</li>
<li><code>medical_school</code>: Where the physician attended medical school.</li>
<li><code>salary</code>: The physician’s salary.</li>
</ul>
<p>This data can again be thought of as a dimension table, and you can inspect the first few rows using Polars:</p>
<div class="codeblock mb-3 w-100" aria-label="Code block" data-syntax-language="pycon" data-is-repl="true">
  <div class="codeblock__header d-flex justify-content-between codeblock--blue">
    <span class="mr-2 noselect" aria-label="Language">Python</span>
    
    <div class="noselect">
      
        <span class="codeblock__output-toggle" title="Toggle prompts and output"><span class="icon baseline js-codeblock-output-on codeblock__header--icon-lower"><svg><use href="/static/icons.67f62bbffdec.svg#regular--rectangle-terminal"></use></svg></span></span>
      
    </div>
  </div>
  <div style="position: relative;">
    <div class="highlight highlight--with-header"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">PHYSICIAN_DATA_PATH</span> <span class="o">=</span> <span class="s2">"data/physicians.csv"</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data_physician</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">PHYSICIAN_DATA_PATH</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">data_physician</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(500, 6)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">data_physician</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="go">shape: (5, 6)</span>
<span class="go">┌──────────────────┬──────────────┬───────────────┬─────────────────────┬───────────────────────────────────┬───────────────┐</span>
<span class="go">│ physician_name   ┆ physician_id ┆ physician_dob ┆ physician_grad_year ┆ medical_school                    ┆ salary        │</span>
<span class="go">│ ---              ┆ ---          ┆ ---           ┆ ---                 ┆ ---                               ┆ ---           │</span>
<span class="go">│ str              ┆ i64          ┆ str           ┆ str                 ┆ str                               ┆ f64           │</span>
<span class="go">╞══════════════════╪══════════════╪═══════════════╪═════════════════════╪═══════════════════════════════════╪═══════════════╡</span>
<span class="go">│ Joseph Johnson   ┆ 0            ┆ 1970-02-22    ┆ 2000-02-22          ┆ Johns Hopkins University School … ┆ 309534.155076 │</span>
<span class="go">│ Jason Williams   ┆ 1            ┆ 1982-12-22    ┆ 2012-12-22          ┆ Mayo Clinic Alix School of Medic… ┆ 281114.503559 │</span>
<span class="go">│ Jesse Gordon     ┆ 2            ┆ 1959-06-03    ┆ 1989-06-03          ┆ David Geffen School of Medicine … ┆ 305845.584636 │</span>
<span class="go">│ Heather Smith    ┆ 3            ┆ 1965-06-15    ┆ 1995-06-15          ┆ NYU Grossman Medical School       ┆ 295239.766689 │</span>
<span class="go">│ Kayla Hunter DDS ┆ 4            ┆ 1978-10-19    ┆ 2008-10-19          ┆ David Geffen School of Medicine … ┆ 298751.355201 │</span>
<span class="go">└──────────────────┴──────────────┴───────────────┴─────────────────────┴───────────────────────────────────┴───────────────┘</span>
</code></pre></div>
    
    <button class="codeblock__copy btn btn-outline-secondary border m-1 px-1 d-hover-only" title="Copy to clipboard"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#@copy"></use></svg></span></button>
    <template class="codeblock__copied-template"></template>
    
  </div>
</div>
<p>As you can see from the code block, there are 500 physicians in <code>physicians.csv</code>. The first few rows from <code>physicians.csv</code> give you a feel for what the data looks like. For instance, Heather Smith has a physician ID of 3, was born on June 15, 1965, graduated medical school on June 15, 1995, attended NYU Grossman Medical School, and her salary is about $295,239.</p>
</section><section class="section4"><h4 id="payerscsv">payers.csv<a class="headerlink" href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#payerscsv" title="Permanent link"></a></h4>
<p>The next file, <code>payers.csv</code>, records information about the insurance companies that your hospitals bills for patient visits. Similar to <code>hospitals.csv</code>, it’s a small file with a couple fields:</p>
<ul>
<li><code>payer_id</code>: An integer that uniquely identifies each payer.</li>
<li><code>payer_name</code>: The payer’s company name.</li>
</ul>
<p>The only five payers in the data are <strong>Medicaid</strong>, <strong>UnitedHealthcare</strong>, <strong>Aetna</strong>, <strong>Cigna</strong>, and <strong>Blue Cross</strong>. Your stakeholders are very interested in payer activity, so <code>payers.csv</code> will be helpful once it’s connected to patients, hospitals, and physicians. </p>
</section><section class="section4"><h4 id="reviewscsv">reviews.csv<a class="headerlink" href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#reviewscsv" title="Permanent link"></a></h4>
<p>The <code>reviews.csv</code> file contains patient reviews about their experience at the hospital. It has these fields:</p>
<ul>
<li><code>review_id</code>: An integer that uniquely identifies a review.</li>
<li><code>visit_id</code>: An integer that identifies the patient’s visit that the review was about.</li>
<li><code>review</code>: This is the free form text review left by the patient.</li>
<li><code>physician_name</code>: The name of the physician who treated the patient.</li>
<li><code>hospital_name</code>: The hospital where the patient stayed.</li>
<li><code>patient_name</code>: The patient’s name.</li>
</ul>
<p>This dataset is the first one you’ve seen that contains the free text <strong>review</strong> field, and your chatbot should use this to answer questions about review details and patient experiences. </p>
<p>Here’s what <code>reviews.csv</code> looks like:</p>
<div class="codeblock mb-3 w-100" aria-label="Code block" data-syntax-language="pycon" data-is-repl="true">
  <div class="codeblock__header d-flex justify-content-between codeblock--blue">
    <span class="mr-2 noselect" aria-label="Language">Python</span>
    
    <div class="noselect">
      
        <span class="codeblock__output-toggle" title="Toggle prompts and output"><span class="icon baseline js-codeblock-output-on codeblock__header--icon-lower"><svg><use href="/static/icons.67f62bbffdec.svg#regular--rectangle-terminal"></use></svg></span></span>
      
    </div>
  </div>
  <div style="position: relative;">
    <div class="highlight highlight--with-header"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">REVIEWS_DATA_PATH</span> <span class="o">=</span> <span class="s2">"data/reviews.csv"</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data_reviews</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">REVIEWS_DATA_PATH</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">data_reviews</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(1005, 6)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">data_reviews</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="go">shape: (5, 6)</span>
<span class="go">┌───────────┬──────────┬───────────────────────────────────┬─────────────────────┬──────────────────┬──────────────────┐</span>
<span class="go">│ review_id ┆ visit_id ┆ review                            ┆ physician_name      ┆ hospital_name    ┆ patient_name     │</span>
<span class="go">│ ---       ┆ ---      ┆ ---                               ┆ ---                 ┆ ---              ┆ ---              │</span>
<span class="go">│ i64       ┆ i64      ┆ str                               ┆ str                 ┆ str              ┆ str              │</span>
<span class="go">╞═══════════╪══════════╪═══════════════════════════════════╪═════════════════════╪══════════════════╪══════════════════╡</span>
<span class="go">│ 0         ┆ 6997     ┆ The medical staff at the hospita… ┆ Laura Brown         ┆ Wallace-Hamilton ┆ Christy Johnson  │</span>
<span class="go">│ 9         ┆ 8138     ┆ The hospital's commitment to pat… ┆ Steven Watson       ┆ Wallace-Hamilton ┆ Anna Frazier     │</span>
<span class="go">│ 11        ┆ 680      ┆ The hospital's commitment to pat… ┆ Chase Mcpherson Jr. ┆ Wallace-Hamilton ┆ Abigail Mitchell │</span>
<span class="go">│ 892       ┆ 9846     ┆ I had a positive experience over… ┆ Jason Martinez      ┆ Wallace-Hamilton ┆ Kimberly Rivas   │</span>
<span class="go">│ 822       ┆ 7397     ┆ The medical team at the hospital… ┆ Chelsey Davis       ┆ Wallace-Hamilton ┆ Catherine Yang   │</span>
<span class="go">└───────────┴──────────┴───────────────────────────────────┴─────────────────────┴──────────────────┴──────────────────┘</span>
</code></pre></div>
    
    <button class="codeblock__copy btn btn-outline-secondary border m-1 px-1 d-hover-only" title="Copy to clipboard"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#@copy"></use></svg></span></button>
    <template class="codeblock__copied-template"></template>
    
  </div>
</div>
<p>There are 1005 reviews in this dataset, and you can see how each review relates to a visit. For instance, the review with ID 9 corresponds to visit ID 8138, and the first few words are “The hospital’s commitment to pat…”. You might be wondering how you can connect a review to a patient, or more generally, how you can connect all of the datasets described so far to each other. This is where <code>visits.csv</code> comes in.</p>
</section><section class="section4"><h4 id="visitscsv">visits.csv<a class="headerlink" href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#visitscsv" title="Permanent link"></a></h4>
<p>The last file, <code>visits.csv</code>, records details about every hospital visit your company has serviced. Continuing with the star schema analogy, you can think of <code>visits.csv</code> as a <a href="https://en.wikipedia.org/wiki/Star_schema#Fact_tables">fact table</a> that connects hospitals, physicians, patients, and payers. Here are the fields:</p>
<ul>
<li><code>visit_id</code>: The unique identifier of a hospital visit.</li>
<li><code>patient_id</code>: The ID of the patient associated with the visit.</li>
<li><code>date_of_admission</code>: The date the patient was admitted to the hospital.</li>
<li><code>room_number</code>: The patient’s room number.</li>
<li><code>admission_type</code>: One of ‘Elective’, ‘Emergency’, or ‘Urgent’.</li>
<li><code>chief_complaint</code>: A string describing the patient’s primary reason for being at the hospital.</li>
<li><code>primary_diagnosis</code>: A string describing the primary diagnosis made by the physician.</li>
<li><code>treatment_description</code>: A text summary of the treatment given by the physician.</li>
<li><code>test_results</code>: One of ‘Inconclusive’, ‘Normal’, or ‘Abnormal’.</li>
<li><code>discharge_date</code>: The date the patient was discharged from the hospital</li>
<li><code>physician_id</code>: The ID of the physician that treated the patient.</li>
<li><code>hospital_id</code>: The ID of the hospital the patient stayed at.</li>
<li><code>payer_id</code>: The ID of the insurance payer used by the patient.</li>
<li><code>billing_amount</code>: The amount of money billed to the payer for the visit.</li>
<li><code>visit_status</code>: One of ‘OPEN’ or ‘DISCHARGED’.</li>
</ul>
<p>This dataset gives you everything you need to answer questions about the relationship between each hospital entity. For example, if you know a physician ID, you can use <code>visits.csv</code> to figure out which patients, payers, and hospitals the physician is associated with. Take a look at what <code>visits.csv</code> looks like in Polars:</p>
<div class="codeblock mb-3 w-100" aria-label="Code block" data-syntax-language="pycon" data-is-repl="true">
  <div class="codeblock__header d-flex justify-content-between codeblock--blue">
    <span class="mr-2 noselect" aria-label="Language">Python</span>
    
    <div class="noselect">
      
        <span class="codeblock__output-toggle" title="Toggle prompts and output"><span class="icon baseline js-codeblock-output-on codeblock__header--icon-lower"><svg><use href="/static/icons.67f62bbffdec.svg#regular--rectangle-terminal"></use></svg></span></span>
      
    </div>
  </div>
  <div style="position: relative;">
    <div class="highlight highlight--with-header"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">VISITS_DATA_PATH</span> <span class="o">=</span> <span class="s2">"data/visits.csv"</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data_visits</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">VISITS_DATA_PATH</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">data_visits</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(9998, 15)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">data_visits</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="go">shape: (5, 15)</span>
<span class="go">┌─────────┬─────────┬─────────┬─────────┬─────────┬─────────┬────────┬────────┬────────┬────────┬────────┬────────┬────────┬────────┬────────┐</span>
<span class="go">│ patient ┆ date_of ┆ billing ┆ room_nu ┆ admissi ┆ dischar ┆ test_r ┆ visit_ ┆ physic ┆ payer_ ┆ hospit ┆ chief_ ┆ treatm ┆ primar ┆ visit_ │</span>
<span class="go">│ _id     ┆ _admiss ┆ _amount ┆ mber    ┆ on_type ┆ ge_date ┆ esults ┆ id     ┆ ian_id ┆ id     ┆ al_id  ┆ compla ┆ ent_de ┆ y_diag ┆ status │</span>
<span class="go">│ ---     ┆ ion     ┆ ---     ┆ ---     ┆ ---     ┆ ---     ┆ ---    ┆ ---    ┆ ---    ┆ ---    ┆ ---    ┆ int    ┆ script ┆ nosis  ┆ ---    │</span>
<span class="go">│ i64     ┆ ---     ┆ f64     ┆ i64     ┆ str     ┆ str     ┆ str    ┆ i64    ┆ i64    ┆ i64    ┆ i64    ┆ ---    ┆ ion    ┆ ---    ┆ str    │</span>
<span class="go">│         ┆ str     ┆         ┆         ┆         ┆         ┆        ┆        ┆        ┆        ┆        ┆ str    ┆ ---    ┆ str    ┆        │</span>
<span class="go">│         ┆         ┆         ┆         ┆         ┆         ┆        ┆        ┆        ┆        ┆        ┆        ┆ str    ┆        ┆        │</span>
<span class="go">╞═════════╪═════════╪═════════╪═════════╪═════════╪═════════╪════════╪════════╪════════╪════════╪════════╪════════╪════════╪════════╪════════╡</span>
<span class="go">│ 0       ┆ 2022-11 ┆ 37490.9 ┆ 146     ┆ Electiv ┆ 2022-12 ┆ Inconc ┆ 0      ┆ 102    ┆ 1      ┆ 0      ┆ null   ┆ null   ┆ null   ┆ DISCHA │</span>
<span class="go">│         ┆ -17     ┆ 83364   ┆         ┆ e       ┆ -01     ┆ lusive ┆        ┆        ┆        ┆        ┆        ┆        ┆        ┆ RGED   │</span>
<span class="go">│ 1       ┆ 2023-06 ┆ 47304.0 ┆ 404     ┆ Emergen ┆ null    ┆ Normal ┆ 1      ┆ 435    ┆ 4      ┆ 5      ┆ null   ┆ null   ┆ null   ┆ OPEN   │</span>
<span class="go">│         ┆ -01     ┆ 64845   ┆         ┆ cy      ┆         ┆        ┆        ┆        ┆        ┆        ┆        ┆        ┆        ┆        │</span>
<span class="go">│ 2       ┆ 2019-01 ┆ 36874.8 ┆ 292     ┆ Emergen ┆ 2019-02 ┆ Normal ┆ 2      ┆ 348    ┆ 2      ┆ 6      ┆ null   ┆ null   ┆ null   ┆ DISCHA │</span>
<span class="go">│         ┆ -09     ┆ 96997   ┆         ┆ cy      ┆ -08     ┆        ┆        ┆        ┆        ┆        ┆        ┆        ┆        ┆ RGED   │</span>
<span class="go">│ 3       ┆ 2020-05 ┆ 23303.3 ┆ 480     ┆ Urgent  ┆ 2020-05 ┆ Abnorm ┆ 3      ┆ 270    ┆ 4      ┆ 15     ┆ null   ┆ null   ┆ null   ┆ DISCHA │</span>
<span class="go">│         ┆ -02     ┆ 22092   ┆         ┆         ┆ -03     ┆ al     ┆        ┆        ┆        ┆        ┆        ┆        ┆        ┆ RGED   │</span>
<span class="go">│ 4       ┆ 2021-07 ┆ 18086.3 ┆ 477     ┆ Urgent  ┆ 2021-08 ┆ Normal ┆ 4      ┆ 106    ┆ 2      ┆ 29     ┆ Persis ┆ Prescr ┆ J45.90 ┆ DISCHA │</span>
<span class="go">│         ┆ -09     ┆ 44184   ┆         ┆         ┆ -02     ┆        ┆        ┆        ┆        ┆        ┆ tent   ┆ ibed a ┆ 9 -    ┆ RGED   │</span>
<span class="go">│         ┆         ┆         ┆         ┆         ┆         ┆        ┆        ┆        ┆        ┆        ┆ cough  ┆ combin ┆ Unspec ┆        │</span>
<span class="go">│         ┆         ┆         ┆         ┆         ┆         ┆        ┆        ┆        ┆        ┆        ┆ and    ┆ ation  ┆ ified  ┆        │</span>
<span class="go">│         ┆         ┆         ┆         ┆         ┆         ┆        ┆        ┆        ┆        ┆        ┆ shortn ┆ of     ┆ asthma ┆        │</span>
<span class="go">│         ┆         ┆         ┆         ┆         ┆         ┆        ┆        ┆        ┆        ┆        ┆ ess o… ┆ inha…  ┆ , un…  ┆        │</span>
<span class="go">└─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴────────┴────────┴────────┴────────┴────────┴────────┴────────┴────────┴────────┘</span>
</code></pre></div>
    
    <button class="codeblock__copy btn btn-outline-secondary border m-1 px-1 d-hover-only" title="Copy to clipboard"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#@copy"></use></svg></span></button>
    <template class="codeblock__copied-template"></template>
    
  </div>
</div>
<p>You can see there are <strong>9998</strong> visits recorded along with the 15 fields described above. Notice that <code>chief_complaint</code>, <code>treatment_description</code>, and <code>primary_diagnosis</code> might be missing for a visit. You’ll have to keep this in mind as your stakeholders might not be aware that many visits are missing critical data—this may be a valuable insight in itself! Lastly, notice that when a visit is still open, the <code>discharged_date</code> will be missing.  </p>
<p>You now have an understanding of the data you’ll use to build the chatbot your stakeholders want. To recap, the files are broken out to simulate what a traditional SQL database might look like. Every hospital, patient, physician, review, and payer are connected through <code>visits.csv</code>.</p>
</section><section class="section4"><h4 id="wait-times">Wait Times<a class="headerlink" href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#wait-times" title="Permanent link"></a></h4>
<p>You might have noticed there’s no data to answer questions like <em>What is the current wait time at XYZ hospital?</em> or
<em>Which hospital currently has the shortest wait time?</em>. Unfortunately, the hospital system doesn’t record historical wait times. Your chatbot will have to call an API to get current wait time information. You’ll see how this works later. </p>
<p>With an understanding of the business requirements, available data, and LangChain functionalities, you can create a design for your chatbot.</p>
<div><div class="rounded border border-light" style="display:block;position:relative;"> <div style="display:block;width:100%;padding-top:12.5%;"></div> <div class="rpad rounded border" data-unit="8x1" style="position:absolute;left:0;top:0;right:0;bottom:0;overflow:hidden;"> </div></div><a class="small text-muted" href="https://realpython.com/account/join/" rel="nofollow"> <span class="icon baseline mr-1"><svg><use href="/static/icons.67f62bbffdec.svg#solid--circle-info"></use></svg></span>Remove ads</a></div></section></section><section class="section3"><h3 id="design-the-chatbot">Design the Chatbot<a class="headerlink" href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#design-the-chatbot" title="Permanent link"></a></h3>
<p>Now that you know the business requirements, data, and LangChain prerequisites, you’re ready to design your chatbot. A good design gives you and others a conceptual understanding of the components needed to build your chatbot. Your design should clearly illustrate how data flows through your chatbot, and it should serve as a helpful reference during development.  </p>
<p>Your chatbot will use multiple tools to answer diverse questions about your hospital system. Here’s a flowchart illustrating how you’ll accomplish this:</p>
<figure class="js-lightbox"><a href="./Build an LLM RAG Chatbot With LangChain – Real Python_files/Screenshot_2024-01-15_at_8.08.18_PM.fe16f8a318cc.png" target="_blank"><img loading="lazy" class="img-fluid mx-auto d-block " src="./Build an LLM RAG Chatbot With LangChain – Real Python_files/Screenshot_2024-01-15_at_8.08.18_PM.fe16f8a318cc.png" width="2000" height="1110" srcset="https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/Screenshot_2024-01-15_at_8.08.18_PM.fe16f8a318cc.png&amp;w=500&amp;sig=d77c183f321e4da3263b162f70e4031200bb5faf 500w, https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/Screenshot_2024-01-15_at_8.08.18_PM.fe16f8a318cc.png&amp;w=666&amp;sig=a75006783e4ef536ba27ee85e9bb29d036b1f4a0 666w, https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/Screenshot_2024-01-15_at_8.08.18_PM.fe16f8a318cc.png&amp;w=1000&amp;sig=0e192df9465b0b56c284e1947edf6258e13d61e8 1000w, https://files.realpython.com/media/Screenshot_2024-01-15_at_8.08.18_PM.fe16f8a318cc.png 2000w" sizes="(min-width: 1200px) 690px, (min-width: 780px) calc(-5vw + 669px), (min-width: 580px) 510px, calc(100vw - 30px)" alt="Chatbot flowchart" data-asset="5648"></a><figcaption class="figure-caption text-center">Architecture and data flow for the hospital system chatbot</figcaption></figure>

<p>This flowchart illustrates how data moves through your chatbot, starting from the user’s input query all the way to the final response. Here’s a summary of each component:</p>
<ul>
<li><strong>LangChain Agent</strong>: The LangChain agent is the brain of your chatbot. Given a user query, the agent decides which tool to call and what to give the tool as input. The agent then observes the tool’s output and decides what to return to the user—this is the agent’s response.</li>
<li><strong>Neo4j AuraDB</strong>: You’ll store both structured hospital system data and patient reviews in a Neo4j AuraDB graph database. You’ll learn all about this in the next section.</li>
<li><strong>LangChain Neo4j Cypher Chain</strong>: This chain tries to convert the user query into Cypher, Neo4j’s query language, and execute the Cypher query in Neo4j. The chain then answers the user query using the Cypher query results. The chain’s response is fed back to the LangChain agent and sent to the user.</li>
<li><strong>LangChain Neo4j Reviews Vector Chain</strong>: This is very similar to the chain you built in <a href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#retrieval-objects">Step 1</a>, except now patient review embeddings are stored in Neo4j. The chain searches for relevant reviews based on those semantically similar to the user query, and the reviews are used to answer the user query.</li>
<li><strong>Wait Times Function</strong>: Similar to the logic in <a href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#agents">Step 1</a>, the LangChain agent tries to extract a hospital name from the user query. The hospital name is passed as input to a Python function that gets wait times, and the wait time is returned to the agent. </li>
</ul>
<p>To walk through an example, suppose a user asks <em>How many emergency visits were there in 2023?</em> The LangChain agent will receive this question and decide which tool, if any, to pass the question to. In this case, the agent should pass the question to the <em>LangChain Neo4j Cypher Chain</em>. The chain will try to convert the question to a Cypher query, run the Cypher query in Neo4j, and use the query results to answer the question. </p>
<p>Once the LangChain Neo4j Cypher Chain answers the question, it will return the answer to the agent, and the agent will relay the answer to the user. </p>
<p>With this design in mind, you can start building your chatbot. Your first task is to set up a Neo4j AuraDB instance for your chatbot to access.</p>
</section></section><section class="section2"><h2 id="step-3-set-up-a-neo4j-graph-database">Step 3: Set Up a Neo4j Graph Database<a class="headerlink" href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#step-3-set-up-a-neo4j-graph-database" title="Permanent link"></a></h2>
<p>As you saw in <a href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#explore-the-available-data">step 2</a>, your hospital system data is currently stored in CSV files. Before building your chatbot, you need to store this data in a database that your chatbot can query. You’ll use <a href="https://neo4j.com/cloud/aura-free/">Neo4j AuraDB</a> for this.</p>
<p>Before learning how to set up a Neo4j AuraDB instance, you’ll get an overview of graph databases, and you’ll see why using a graph database may be a better choice than a relational database for this project.</p>
<section class="section3"><h3 id="a-brief-overview-of-graph-databases">A Brief Overview of Graph Databases<a class="headerlink" href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#a-brief-overview-of-graph-databases" title="Permanent link"></a></h3>
<p>Graph databases, such as Neo4j, are databases designed to represent and process data stored as a graph. Graph data consists of <strong>nodes</strong>, <strong>edges</strong> or <strong>relationships</strong>, and <strong>properties</strong>. Nodes represent entities, relationships connect entities, and properties provide additional metadata about nodes and relationships.</p>
<p>For example, here’s how you might represent hospital system nodes and relationships in a graph:</p>
<figure class="js-lightbox"><a href="./Build an LLM RAG Chatbot With LangChain – Real Python_files/Screenshot_2024-01-16_at_4.webp" target="_blank"><img loading="lazy" class="img-fluid mx-auto d-block " src="./Build an LLM RAG Chatbot With LangChain – Real Python_files/Screenshot_2024-01-16_at_4.webp" width="1000" height="562" srcset="https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/Screenshot_2024-01-16_at_4.33.31_PM.043fc98132e3.png&amp;w=250&amp;sig=9aa2cc649895bc642bf6e5e00c55b40c479f85e2 250w, https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/Screenshot_2024-01-16_at_4.33.31_PM.043fc98132e3.png&amp;w=333&amp;sig=6be4536dfa71175018b6f53934c2bcaf6525b26a 333w, https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/Screenshot_2024-01-16_at_4.33.31_PM.043fc98132e3.png&amp;w=500&amp;sig=0d568b3cfebb6e0f4fd00ea81e4ef689cce039a8 500w, https://files.realpython.com/media/Screenshot_2024-01-16_at_4.33.31_PM.043fc98132e3.png 1000w" sizes="(min-width: 1200px) 690px, (min-width: 780px) calc(-5vw + 669px), (min-width: 580px) 510px, calc(100vw - 30px)" alt="Graph Data Example" data-asset="5650"></a><figcaption class="figure-caption text-center">Hospital system graph</figcaption></figure>

<p>This graph has three nodes - <strong>Patient</strong>, <strong>Visit</strong>, and <strong>Payer</strong>. <strong>Patient</strong> and <strong>Visit</strong> are connected by the <strong>HAS</strong> relationship, indicating that a hospital patient has a visit. Similarly, <strong>Visit</strong> and <strong>Payer</strong> are connected by the <strong>COVERED_BY</strong> relationship, indicating that an insurance payer covers a hospital visit.</p>
<p>Notice how the relationships are represented by an arrow indicating their direction. For example, the direction of the <strong>HAS</strong> relationship tells you that a patient can have a visit, but a visit cannot have a patient. </p>
<p>Both nodes and relationships can have properties. In this example, <strong>Patient</strong> nodes have id, name, and date of birth properties, and the <strong>COVERED_BY</strong> relationship has service date and billing amount properties. Storing data in a graph like this has several advantages:</p>
<ol>
<li>
<p><strong>Simplicity</strong>: Modeling real-world relationships between entities is natural in graph databases, reducing the need for complex schemas that require multiple join operations to answer queries.</p>
</li>
<li>
<p><strong>Relationships</strong>: Graph databases excel at handling complex relationships. Traversing relationships is efficient, making it easy to query and analyze connected data.</p>
</li>
<li>
<p><strong>Flexibility</strong>: Graph databases are schema-less, allowing for easy adaptation to changing data structures. This flexibility is beneficial for evolving data models. </p>
</li>
<li>
<p><strong>Performance</strong>: Retrieving connected data is faster in graph databases than in relational databases, especially for scenarios involving complex queries with multiple relationships.</p>
</li>
<li>
<p><strong>Pattern Matching</strong>: Graph databases support powerful pattern-matching queries, making it easier to express and find specific structures within the data.</p>
</li>
</ol>
<p>When you have data with many complex relationships, the simplicity and flexibility of graph databases makes them easier to design and query compared to relational databases. As you’ll see later, specifying relationships in graph database queries is concise and doesn’t involve complicated joins. If you’re interested, Neo4j illustrates this well with a realistic example database in their <a href="https://neo4j.com/developer/cypher/guide-sql-to-cypher/">documentation</a>.</p>
<p>Because of this concise data representation, there’s less room for error when an LLM generates graph database queries. This is because you only need to tell the LLM about the nodes, relationships, and properties in your graph database. Contrast this with relational databases where the LLM must navigate and retain knowledge of the table schemas and foreign key relationships throughout your database, leaving  more room for error in SQL generation. </p>
<p>Next, you’ll begin working with graph databases by setting up a <a href="https://neo4j.com/cloud/aura-free/">Neo4j AuraDB</a> instance. After that, you’ll move the hospital system into your Neo4j instance and learn how to query it.</p>
<div><div class="rounded border border-light" style="display:block;position:relative;"> <div style="display:block;width:100%;padding-top:12.5%;"></div> <div class="rpad rounded border" data-unit="8x1" style="position:absolute;left:0;top:0;right:0;bottom:0;overflow:hidden;"> </div></div><a class="small text-muted" href="https://realpython.com/account/join/" rel="nofollow"> <span class="icon baseline mr-1"><svg><use href="/static/icons.67f62bbffdec.svg#solid--circle-info"></use></svg></span>Remove ads</a></div></section><section class="section3"><h3 id="create-a-neo4j-account-and-auradb-instance">Create a Neo4j Account and AuraDB Instance<a class="headerlink" href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#create-a-neo4j-account-and-auradb-instance" title="Permanent link"></a></h3>
<p>To get started using Neo4j, you can create a free <a href="https://neo4j.com/cloud/aura-free/">Neo4j AuraDB</a> account. The landing page should look something like this:</p>
<figure class="js-lightbox"><a href="./Build an LLM RAG Chatbot With LangChain – Real Python_files/Screenshot_2024-01-10_at_9.52.26_AM.13dfb78c613b.png" target="_blank"><img loading="lazy" class="img-fluid mx-auto d-block " src="./Build an LLM RAG Chatbot With LangChain – Real Python_files/Screenshot_2024-01-10_at_9.52.26_AM.13dfb78c613b.png" width="3202" height="1390" srcset="https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/Screenshot_2024-01-10_at_9.52.26_AM.13dfb78c613b.png&amp;w=800&amp;sig=97f9de7388d2cd4232fe5f9e8e34ac774b5d08dc 800w, https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/Screenshot_2024-01-10_at_9.52.26_AM.13dfb78c613b.png&amp;w=1067&amp;sig=c46efa6e9b73cb5e3cd12c3f8b6f70c56764daa3 1067w, https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/Screenshot_2024-01-10_at_9.52.26_AM.13dfb78c613b.png&amp;w=1601&amp;sig=2cd6fa67bbc6b7a4fd8f362e246fbaf6658e16ac 1601w, https://files.realpython.com/media/Screenshot_2024-01-10_at_9.52.26_AM.13dfb78c613b.png 3202w" sizes="(min-width: 1200px) 690px, (min-width: 780px) calc(-5vw + 669px), (min-width: 580px) 510px, calc(100vw - 30px)" alt="Neo4j Aura Getting Started Screen" data-asset="5633"></a><figcaption class="figure-caption text-center">Neo4j Aura getting started screen</figcaption></figure>

<p>Click the <strong>Start Free</strong> button and create an account. Once you’re signed in, you should see the Neo4j Aura console:</p>
<figure class="js-lightbox"><a href="./Build an LLM RAG Chatbot With LangChain – Real Python_files/Screenshot_2024-01-10_at_9.53.58_AM.c9d5252982fc.png" target="_blank"><img loading="lazy" class="img-fluid mx-auto d-block " src="./Build an LLM RAG Chatbot With LangChain – Real Python_files/Screenshot_2024-01-10_at_9.53.58_AM.c9d5252982fc.png" width="2570" height="1408" srcset="https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/Screenshot_2024-01-10_at_9.53.58_AM.c9d5252982fc.png&amp;w=642&amp;sig=31f5b06e0c96a3eb41dfcdc08d067e0f846be162 642w, https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/Screenshot_2024-01-10_at_9.53.58_AM.c9d5252982fc.png&amp;w=856&amp;sig=2c31fc12f48d49fd8519bb42781c88e71986609f 856w, https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/Screenshot_2024-01-10_at_9.53.58_AM.c9d5252982fc.png&amp;w=1285&amp;sig=1326948bb5b871c66d807909c5cea84cfc42270a 1285w, https://files.realpython.com/media/Screenshot_2024-01-10_at_9.53.58_AM.c9d5252982fc.png 2570w" sizes="(min-width: 1200px) 690px, (min-width: 780px) calc(-5vw + 669px), (min-width: 580px) 510px, calc(100vw - 30px)" alt="Neo4j Aura Console" data-asset="5634"></a><figcaption class="figure-caption text-center">Create a new Aura instance</figcaption></figure>

<p>Click <strong>New Instance</strong> and create a free instance. A modal should pop up similar to this:</p>
<figure class="js-lightbox"><a href="./Build an LLM RAG Chatbot With LangChain – Real Python_files/Screenshot_2024-01-10_at_9.56.24_AM.6d833ddf5733.png" target="_blank"><img loading="lazy" class="img-fluid mx-auto d-block " src="./Build an LLM RAG Chatbot With LangChain – Real Python_files/Screenshot_2024-01-10_at_9.56.24_AM.6d833ddf5733.png" width="2000" height="1404" srcset="https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/Screenshot_2024-01-10_at_9.56.24_AM.6d833ddf5733.png&amp;w=500&amp;sig=8b606b8b14191cd8423d53849c10b416d90a5762 500w, https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/Screenshot_2024-01-10_at_9.56.24_AM.6d833ddf5733.png&amp;w=666&amp;sig=e40966c9f18e0ba8d5e1a5fe28265a6c6a1c01bd 666w, https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/Screenshot_2024-01-10_at_9.56.24_AM.6d833ddf5733.png&amp;w=1000&amp;sig=aa3c151c9c0cef79634a3ec9fc935feed52644bb 1000w, https://files.realpython.com/media/Screenshot_2024-01-10_at_9.56.24_AM.6d833ddf5733.png 2000w" sizes="(min-width: 1200px) 690px, (min-width: 780px) calc(-5vw + 669px), (min-width: 580px) 510px, calc(100vw - 30px)" alt="Neo4j Aura Create New Instance" data-asset="5635"></a><figcaption class="figure-caption text-center">New Aura instance modal</figcaption></figure>

<p>After you click <strong>Download and Continue</strong>, your instance should be created and a text file containing the Neo4j database credentials should download. Once the instance is created, you’ll see its status is <strong>Running</strong>. There should be no nodes or relationships yet:</p>
<figure class="js-lightbox"><a href="./Build an LLM RAG Chatbot With LangChain – Real Python_files/Screenshot_2024-01-10_at_10.00.34_AM.0ca76879f1fc.png" target="_blank"><img loading="lazy" class="img-fluid mx-auto d-block " src="./Build an LLM RAG Chatbot With LangChain – Real Python_files/Screenshot_2024-01-10_at_10.00.34_AM.0ca76879f1fc.png" width="2558" height="1234" srcset="https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/Screenshot_2024-01-10_at_10.00.34_AM.0ca76879f1fc.png&amp;w=639&amp;sig=9af013b61a2e40377bfa3ad33a924fdcf47b6dd8 639w, https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/Screenshot_2024-01-10_at_10.00.34_AM.0ca76879f1fc.png&amp;w=852&amp;sig=0f13af9cb4a2cd5611d290a770640b00016741be 852w, https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/Screenshot_2024-01-10_at_10.00.34_AM.0ca76879f1fc.png&amp;w=1279&amp;sig=92cae958c0778b03ac8b64a0205c747cc0313069 1279w, https://files.realpython.com/media/Screenshot_2024-01-10_at_10.00.34_AM.0ca76879f1fc.png 2558w" sizes="(min-width: 1200px) 690px, (min-width: 780px) calc(-5vw + 669px), (min-width: 580px) 510px, calc(100vw - 30px)" alt="Neo4j Aura Running Instance" data-asset="5636"></a><figcaption class="figure-caption text-center">Aura running instance</figcaption></figure>

<p>Next, open the text file you downloaded with your Neo4j credentials and copy the <code>NEO4J_URI</code>, <code>NEO4J_USERNAME</code>, and <code>NEO4J_PASSWORD</code> into your <code>.env</code> file:</p>
<div class="codeblock mb-3 w-100" aria-label="Code block" data-syntax-language="dotenv">
  <div class="codeblock__header d-flex justify-content-between codeblock--grey">
    <span class="mr-2 noselect" aria-label="Language">.env</span>
    
    <div class="noselect">
      
    </div>
  </div>
  <div style="position: relative;">
    <div class="highlight highlight--with-header"><pre><span></span><code><span class="na">OPENAI_API_KEY</span><span class="o">=</span><span class="s">&lt;YOUR_OPENAI_API_KEY&gt;</span>

<span class="na">NEO4J_URI</span><span class="o">=</span><span class="s">&lt;YOUR_NEO4J_URI&gt;</span>
<span class="na">NEO4J_USERNAME</span><span class="o">=</span><span class="s">&lt;YOUR_NEO4J_URI&gt;</span>
<span class="na">NEO4J_PASSWORD</span><span class="o">=</span><span class="s">&lt;YOUR_NEO4J_PASSWORD&gt;</span>
</code></pre></div>
    
    <button class="codeblock__copy btn btn-outline-secondary border m-1 px-1 d-hover-only" title="Copy to clipboard"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#@copy"></use></svg></span></button>
    <template class="codeblock__copied-template"></template>
    
  </div>
</div>
<p>You’ll use these environment variables to connect to your Neo4j instance in Python so that your chatbot can execute queries. </p>
<div class="alert alert-primary" role="alert">
<p><strong>Note</strong>: By default, your <strong>NEO4J_URI</strong> should be similar to <strong>neo4j+s://<your_instance>.databases.neo4j.io</your_instance></strong>. The URL scheme <strong>neo4j+s</strong> uses <a href="https://en.wikipedia.org/wiki/Certificate_authority">CA-signed certificates</a> only, which might not work for you. If this is the case, change your URI to use the <strong>neo4j+ssc</strong> URL scheme - <strong>neo4j+ssc://<your_instance>.databases.neo4j.io</your_instance></strong>. You can read more about what this means in the Neo4j documentation on <a href="https://neo4j.com/docs/python-manual/current/connect-advanced/#_connection_protocols_and_security">connection protocols and security</a>.</p>
</div>
<p>You now have everything in place to interact with your Neo4j instance. Next up, you’ll design the hospital system graph database. This will tell you how the hospital entities are related, and it will inform the kinds of queries you can run. </p>
</section><section class="section3"><h3 id="design-the-hospital-system-graph-database">Design the Hospital System Graph Database<a class="headerlink" href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#design-the-hospital-system-graph-database" title="Permanent link"></a></h3>
<p>Now that you have a running Neo4j AuraDB instance, you need to decide which nodes, relationships, and properties you want to store. One of the most popular ways to represent this is with a flowchart. Based on your understanding of the hospital system data, you come up with the following design:</p>
<figure class="js-lightbox"><a href="./Build an LLM RAG Chatbot With LangChain – Real Python_files/Screenshot_2024-01-11_at_9.25.30_AM.16896d00ee08.png" target="_blank"><img loading="lazy" class="img-fluid mx-auto d-block " src="./Build an LLM RAG Chatbot With LangChain – Real Python_files/Screenshot_2024-01-11_at_9.25.30_AM.16896d00ee08.png" width="2084" height="1338" srcset="https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/Screenshot_2024-01-11_at_9.25.30_AM.16896d00ee08.png&amp;w=521&amp;sig=de17d96abb698a2532efd5d8bf9836371db98dba 521w, https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/Screenshot_2024-01-11_at_9.25.30_AM.16896d00ee08.png&amp;w=694&amp;sig=b226fa4478bfb8eb3f99433ad93c60c982848508 694w, https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/Screenshot_2024-01-11_at_9.25.30_AM.16896d00ee08.png&amp;w=1042&amp;sig=9fef9fd9f450fbb3772fc8748a8c23ec4f653711 1042w, https://files.realpython.com/media/Screenshot_2024-01-11_at_9.25.30_AM.16896d00ee08.png 2084w" sizes="(min-width: 1200px) 690px, (min-width: 780px) calc(-5vw + 669px), (min-width: 580px) 510px, calc(100vw - 30px)" alt="Hospital System Ontology" data-asset="5639"></a><figcaption class="figure-caption text-center">Hospital system graph database design</figcaption></figure>

<p>This diagram shows you all of the nodes and relationships in the hospital system data. One useful way to think about this flowchart is to start with the <strong>Patient</strong> node and follow the relationships. A <strong>Patient</strong> <strong>has</strong> a <strong>visit</strong> <strong>at</strong> a <strong>hospital</strong>, and the <strong>hospital</strong> <strong>employs</strong> a <strong>physician</strong> to <strong>treat</strong> the <strong>visit</strong> which is <strong>covered by</strong> an insurance <strong>payer</strong>.  </p>
<p>Here are the properties stored in each node:</p>
<figure class="js-lightbox"><a href="./Build an LLM RAG Chatbot With LangChain – Real Python_files/Screenshot_2024-01-17_at_8.28.33_AM.e784ec79aa41.png" target="_blank"><img loading="lazy" class="img-fluid mx-auto d-block " src="./Build an LLM RAG Chatbot With LangChain – Real Python_files/Screenshot_2024-01-17_at_8.28.33_AM.e784ec79aa41.png" width="2066" height="1002" srcset="https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/Screenshot_2024-01-17_at_8.28.33_AM.e784ec79aa41.png&amp;w=516&amp;sig=ac8604d91c032fa4c6185e0ae1e339af50848fcb 516w, https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/Screenshot_2024-01-17_at_8.28.33_AM.e784ec79aa41.png&amp;w=688&amp;sig=69d13f44c7640c0a249064d7f5f69b24d08c8f3e 688w, https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/Screenshot_2024-01-17_at_8.28.33_AM.e784ec79aa41.png&amp;w=1033&amp;sig=0888493be357846a0240d8aa69fc7c25d9ac0088 1033w, https://files.realpython.com/media/Screenshot_2024-01-17_at_8.28.33_AM.e784ec79aa41.png 2066w" sizes="(min-width: 1200px) 690px, (min-width: 780px) calc(-5vw + 669px), (min-width: 580px) 510px, calc(100vw - 30px)" alt="Hospital Graph Node Properties" data-asset="5651"></a><figcaption class="figure-caption text-center">Hospital system node properties</figcaption></figure>

<p>The majority of these properties come directly from the fields you explored in <a href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#explore-the-available-data">step 2</a>. One notable difference is that <strong>Review</strong> nodes have an <strong>embedding</strong> property, which is a vector representation of the <strong>patient_name</strong>, <strong>physician_name</strong>, and <strong>text</strong> properties. This allows you to do <a href="https://neo4j.com/docs/cypher-manual/current/indexes-for-vector-search/">vector searches</a> over review nodes like you did with ChromaDB.</p>
<p>Here are the relationship properties:</p>
<figure class="js-lightbox"><a href="./Build an LLM RAG Chatbot With LangChain – Real Python_files/Screenshot_2024-01-17_at_9.07.16_AM.de07d986e379.png" target="_blank"><img loading="lazy" class="img-fluid mx-auto d-block w-66" src="./Build an LLM RAG Chatbot With LangChain – Real Python_files/Screenshot_2024-01-17_at_9.07.16_AM.de07d986e379.png" width="2000" height="1118" srcset="https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/Screenshot_2024-01-17_at_9.07.16_AM.de07d986e379.png&amp;w=500&amp;sig=a49c372959834dc3f77ecbb300be836b2cac0ed2 500w, https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/Screenshot_2024-01-17_at_9.07.16_AM.de07d986e379.png&amp;w=666&amp;sig=b8993dfc43d8bdb5cf37d7ff64ec4cd6e5d1253a 666w, https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/Screenshot_2024-01-17_at_9.07.16_AM.de07d986e379.png&amp;w=1000&amp;sig=751faf5c6e044293e84da6cc7c35ec0db386e0f0 1000w, https://files.realpython.com/media/Screenshot_2024-01-17_at_9.07.16_AM.de07d986e379.png 2000w" sizes="(min-width: 1200px) 690px, (min-width: 780px) calc(-5vw + 669px), (min-width: 580px) 510px, calc(100vw - 30px)" alt="Hospital Graph Relationship Properties" data-asset="5652"></a><figcaption class="figure-caption text-center">Hospital system relationship properties</figcaption></figure>

<p>As you can see, <strong>COVERED_BY</strong> is the only relationship with more than an <strong>id</strong> property. The <strong>service_date</strong> is the date the patient was discharged from a visit, and <strong>billing_amount</strong> is the amount charged to the payer for the visit.</p>
<div class="alert alert-primary" role="alert">
<p><strong>Note</strong>: This fake hospital system data has a relatively small number of nodes and relationships than what you’d typically see in an enterprise setting. However, you can easily imagine how many more nodes and relationships you could add for a real hospital system. For instance, nurses, pharmacists, pharmacies, prescription drugs, surgeries, patient relatives, and many more hospital entities could be represented as nodes.</p>
<p>You could also redesign this so that diagnoses and symptoms are represented as nodes instead of properties, or you could add more relationship properties. You could do all of this without changing the design you already have. This is the beauty of graphs—you simply add more nodes and relationships as your data evolves.</p>
</div>
<p>Now that you have an overview of the hospital system design you’ll use, it’s time to move your data into Neo4j! </p>
<div><div class="rounded border border-light" style="display:block;position:relative;"> <div style="display:block;width:100%;padding-top:12.5%;"></div> <div class="rpad rounded border" data-unit="8x1" style="position:absolute;left:0;top:0;right:0;bottom:0;overflow:hidden;"> </div></div><a class="small text-muted" href="https://realpython.com/account/join/" rel="nofollow"> <span class="icon baseline mr-1"><svg><use href="/static/icons.67f62bbffdec.svg#solid--circle-info"></use></svg></span>Remove ads</a></div></section><section class="section3"><h3 id="upload-data-to-neo4j">Upload Data to Neo4j<a class="headerlink" href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#upload-data-to-neo4j" title="Permanent link"></a></h3>
<p>With a running Neo4j instance and an understanding of the nodes, properties, and relationships you want to store, you can move the hospital system data into Neo4j. For this, you’ll create a folder called <code>hospital_neo4j_etl</code> with a few empty files. You’ll also want to create a <code>docker-compose.yml</code> file in your project’s root directory:</p>
<div class="highlight"><pre><span></span><code>./
│
├── hospital_neo4j_etl/
│   │
│   ├── src/
│   │   ├── entrypoint.sh
│   │   └── hospital_bulk_csv_write.py
│   │
│   ├── Dockerfile
│   └── pyproject.toml
│
├── .env
└── docker-compose.yml
</code></pre></div>
<p>Your <code>.env</code> file should have the following environment variables:</p>
<div class="codeblock mb-3 w-100" aria-label="Code block" data-syntax-language="dotenv">
  <div class="codeblock__header d-flex justify-content-between codeblock--grey">
    <span class="mr-2 noselect" aria-label="Language">.env</span>
    
    <div class="noselect">
      
    </div>
  </div>
  <div style="position: relative;">
    <div class="highlight highlight--with-header"><pre><span></span><code><span class="na">OPENAI_API_KEY</span><span class="o">=</span><span class="s">&lt;YOUR_OPENAI_API_KEY&gt;</span>

<span class="na">NEO4J_URI</span><span class="o">=</span><span class="s">&lt;YOUR_NEO4J_URI&gt;</span>
<span class="na">NEO4J_USERNAME</span><span class="o">=</span><span class="s">&lt;YOUR_NEO4J_URI&gt;</span>
<span class="na">NEO4J_PASSWORD</span><span class="o">=</span><span class="s">&lt;YOUR_NEO4J_PASSWORD&gt;</span>

<span class="na">HOSPITALS_CSV_PATH</span><span class="o">=</span><span class="s">https://raw.githubusercontent.com/hfhoffman1144/langchain_neo4j_rag_app/main/data/hospitals.csv</span>
<span class="na">PAYERS_CSV_PATH</span><span class="o">=</span><span class="s">https://raw.githubusercontent.com/hfhoffman1144/langchain_neo4j_rag_app/main/data/payers.csv</span>
<span class="na">PHYSICIANS_CSV_PATH</span><span class="o">=</span><span class="s">https://raw.githubusercontent.com/hfhoffman1144/langchain_neo4j_rag_app/main/data/physicians.csv</span>
<span class="na">PATIENTS_CSV_PATH</span><span class="o">=</span><span class="s">https://raw.githubusercontent.com/hfhoffman1144/langchain_neo4j_rag_app/main/data/patients.csv</span>
<span class="na">VISITS_CSV_PATH</span><span class="o">=</span><span class="s">https://raw.githubusercontent.com/hfhoffman1144/langchain_neo4j_rag_app/main/data/visits.csv</span>
<span class="na">REVIEWS_CSV_PATH</span><span class="o">=</span><span class="s">https://raw.githubusercontent.com/hfhoffman1144/langchain_neo4j_rag_app/main/data/reviews.csv</span>
</code></pre></div>
    
    <button class="codeblock__copy btn btn-outline-secondary border m-1 px-1 d-hover-only" title="Copy to clipboard"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#@copy"></use></svg></span></button>
    <template class="codeblock__copied-template"></template>
    
  </div>
</div>
<p>Notice that you’ve stored all of the CSV files in a public location on <a href="https://github.com/hfhoffman1144/langchain_neo4j_rag_app/tree/main/data">GitHub</a>. Because your Neo4j AuraDB instance is running in the cloud, it can’t access files on your local machine, and you have to use HTTP or upload the files directly to your instance. For this example, you can either use the link above, or upload the data to another location. </p>
<div class="alert alert-primary" role="alert">
<p><strong>Note:</strong> If you’re uploading proprietary data to Neo4j, always ensure that it’s stored in a secure location and transferred appropriately. The data used for this project is all synthetic and not proprietary, so there’s no problem with uploading it over a public HTTP connection. However, this would not be a good idea in practice. You can read more about <a href="https://neo4j.com/docs/aura/aurads/importing-data/">secure ways to import data into Neo4j</a> in their documentation.</p>
</div>
<p>Once you have your <code>.env</code> file populated, open <code>pyproject.toml</code>, which provides configuration, metadata, and dependencies defined in the <a href="https://realpython.com/python-toml/">TOML</a> format:</p>
<div class="codeblock mb-3 w-100" aria-label="Code block" data-syntax-language="toml">
  <div class="codeblock__header d-flex justify-content-between codeblock--grey">
    <span class="mr-2 noselect" aria-label="Language">TOML</span>
    <span class="mr-2" aria-label="Filename"><code style="color: inherit;">hospital_neo4j_etl/pyproject.toml</code></span>
    <div class="noselect">
      
    </div>
  </div>
  <div style="position: relative;">
    <div class="highlight highlight--with-header"><pre><span></span><code><span class="k">[project]</span>
<span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"hospital_neo4j_etl"</span>
<span class="n">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"0.1"</span>
<span class="n">dependencies</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">   </span><span class="s2">"neo4j==5.14.1"</span><span class="p">,</span>
<span class="w">   </span><span class="s2">"retry==0.9.2"</span>
<span class="p">]</span>

<span class="k">[project.optional-dependencies]</span>
<span class="n">dev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">"black"</span><span class="p">,</span><span class="w"> </span><span class="s2">"flake8"</span><span class="p">]</span>
</code></pre></div>
    
    <button class="codeblock__copy btn btn-outline-secondary border m-1 px-1 d-hover-only" title="Copy to clipboard"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#@copy"></use></svg></span></button>
    <template class="codeblock__copied-template"></template>
    
  </div>
</div>
<p>This project is a bare bones <a href="https://en.wikipedia.org/wiki/Extract,_transform,_load">extract, transform, load (ETL) process</a> that moves data into Neo4j, so it’s only dependencies are <a href="https://pypi.org/project/neo4j/">neo4j</a> and <a href="https://pypi.org/project/retry/">retry</a>. The main script for the ETL is <code>hospital_neo4j_etl/src/hospital_bulk_csv_write.py</code>. It’s too long to include the full script here, but you’ll get a feel for the main steps <code>hospital_neo4j_etl/src/hospital_bulk_csv_write.py</code> executes. You can copy the full script from the materials:</p>
<div class="alert alert-warning" role="alert">
<p><strong markdown="1">Get Your Code:</strong> <a href="https://realpython.com/bonus/build-llm-rag-chatbot-with-langchain-code/" class="alert-link" data-toggle="modal" data-target="#modal-build-llm-rag-chatbot-with-langchain-code" data-focus="false" markdown="1">Click here to download the free source code</a> for your LangChain chatbot.</p>
</div>
<p>First, you import dependencies, load environment variables, and configure <a href="https://realpython.com/python-logging/">logging</a>:</p>
<div class="codeblock mb-3 w-100" aria-label="Code block" data-syntax-language="python">
  <div class="codeblock__header d-flex justify-content-between codeblock--blue">
    <span class="mr-2 noselect" aria-label="Language">Python</span>
    <span class="mr-2" aria-label="Filename"><code style="color: inherit;">hospital_neo4j_etl/src/hospital_bulk_csv_write.py</code></span>
    <div class="noselect">
      
    </div>
  </div>
  <div style="position: relative;">
    <div class="highlight highlight--with-header"><pre><span></span><code><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">retry</span> <span class="kn">import</span> <span class="n">retry</span>
<span class="kn">from</span> <span class="nn">neo4j</span> <span class="kn">import</span> <span class="n">GraphDatabase</span>

<span class="n">HOSPITALS_CSV_PATH</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">"HOSPITALS_CSV_PATH"</span><span class="p">)</span>
<span class="n">PAYERS_CSV_PATH</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">"PAYERS_CSV_PATH"</span><span class="p">)</span>
<span class="n">PHYSICIANS_CSV_PATH</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">"PHYSICIANS_CSV_PATH"</span><span class="p">)</span>
<span class="n">PATIENTS_CSV_PATH</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">"PATIENTS_CSV_PATH"</span><span class="p">)</span>
<span class="n">VISITS_CSV_PATH</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">"VISITS_CSV_PATH"</span><span class="p">)</span>
<span class="n">REVIEWS_CSV_PATH</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">"REVIEWS_CSV_PATH"</span><span class="p">)</span>

<span class="n">NEO4J_URI</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">"NEO4J_URI"</span><span class="p">)</span>
<span class="n">NEO4J_USERNAME</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">"NEO4J_USERNAME"</span><span class="p">)</span>
<span class="n">NEO4J_PASSWORD</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">"NEO4J_PASSWORD"</span><span class="p">)</span>

<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
    <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span>
    <span class="nb">format</span><span class="o">=</span><span class="s2">"</span><span class="si">%(asctime)s</span><span class="s2"> [</span><span class="si">%(levelname)s</span><span class="s2">]: </span><span class="si">%(message)s</span><span class="s2">"</span><span class="p">,</span>
    <span class="n">datefmt</span><span class="o">=</span><span class="s2">"%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S"</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">LOGGER</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="c1"># ...</span>
</code></pre></div>
    
    <button class="codeblock__copy btn btn-outline-secondary border m-1 px-1 d-hover-only" title="Copy to clipboard"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#@copy"></use></svg></span></button>
    <template class="codeblock__copied-template"></template>
    
  </div>
</div>
<p>You import the <code>GraphDatabase</code> class from <code>neo4j</code> to connect to your running instance. Notice here that you’re no longer using Python-dotenv to load environment variables. Instead, you’ll pass environment variables into the Docker container that runs your script. Next, you’ll define functions to move hospital data into Neo4j following your design:</p>
<div class="codeblock mb-3 w-100" aria-label="Code block" data-syntax-language="python">
  <div class="codeblock__header d-flex justify-content-between codeblock--blue">
    <span class="mr-2 noselect" aria-label="Language">Python</span>
    <span class="mr-2" aria-label="Filename"><code style="color: inherit;">hospital_neo4j_etl/src/hospital_bulk_csv_write.py</code></span>
    <div class="noselect">
      
    </div>
  </div>
  <div style="position: relative;">
    <div class="highlight highlight--with-header"><pre><span></span><code><span class="c1"># ...</span>

<span class="n">NODES</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"Hospital"</span><span class="p">,</span> <span class="s2">"Payer"</span><span class="p">,</span> <span class="s2">"Physician"</span><span class="p">,</span> <span class="s2">"Patient"</span><span class="p">,</span> <span class="s2">"Visit"</span><span class="p">,</span> <span class="s2">"Review"</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">_set_uniqueness_constraints</span><span class="p">(</span><span class="n">tx</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
    <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"""CREATE CONSTRAINT IF NOT EXISTS FOR (n:</span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">)</span>
<span class="s2">        REQUIRE n.id IS UNIQUE;"""</span>
    <span class="n">_</span> <span class="o">=</span> <span class="n">tx</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">{})</span>


<span class="nd">@retry</span><span class="p">(</span><span class="n">tries</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">delay</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">load_hospital_graph_from_csv</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Load structured hospital CSV data following</span>
<span class="sd">    a specific ontology into Neo4j"""</span>

    <span class="n">driver</span> <span class="o">=</span> <span class="n">GraphDatabase</span><span class="o">.</span><span class="n">driver</span><span class="p">(</span>
        <span class="n">NEO4J_URI</span><span class="p">,</span> <span class="n">auth</span><span class="o">=</span><span class="p">(</span><span class="n">NEO4J_USERNAME</span><span class="p">,</span> <span class="n">NEO4J_PASSWORD</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Setting uniqueness constraints on nodes"</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">driver</span><span class="o">.</span><span class="n">session</span><span class="p">(</span><span class="n">database</span><span class="o">=</span><span class="s2">"neo4j"</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">NODES</span><span class="p">:</span>
            <span class="n">session</span><span class="o">.</span><span class="n">execute_write</span><span class="p">(</span><span class="n">_set_uniqueness_constraints</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span>
    <span class="c1"># ...</span>

<span class="c1"># ...</span>
</code></pre></div>
    
    <button class="codeblock__copy btn btn-outline-secondary border m-1 px-1 d-hover-only" title="Copy to clipboard"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#@copy"></use></svg></span></button>
    <template class="codeblock__copied-template"></template>
    
  </div>
</div>
<p>First, you define a helper function, <code>_set_uniqueness_constraints()</code>, that creates and runs queries enforcing each node to have a unique ID. 
In <code>load_hospital_graph_from_csv()</code>, you instantiate a driver that connects to your Neo4j instance and set uniqueness constraints for each hospital system node.</p>
<p>Notice the <code>@retry</code> <a href="https://realpython.com/primer-on-python-decorators/">decorator</a> attached to <code>load_hospital_graph_from_csv()</code>. If <code>load_hospital_graph_from_csv()</code> fails for any reason, this decorator will rerun it one hundred times with a ten second delay in between tries. This comes in handy when there are intermittent connection issues to Neo4j that are usually resolved by recreating a connection. However, be sure to check the script logs to see if an error reoccurs more than a few times.</p>
<p>Next, <code>load_hospital_graph_from_csv()</code> loads data for each node and relationship:</p>
<div class="codeblock mb-3 w-100" aria-label="Code block" data-syntax-language="python">
  <div class="codeblock__header d-flex justify-content-between codeblock--blue">
    <span class="mr-2 noselect" aria-label="Language">Python</span>
    <span class="mr-2" aria-label="Filename"><code style="color: inherit;">hospital_neo4j_etl/src/hospital_bulk_csv_write.py</code></span>
    <div class="noselect">
      
    </div>
  </div>
  <div style="position: relative;">
    <div class="highlight highlight--with-header"><pre><span></span><code><span class="c1"># ...</span>

<span class="nd">@retry</span><span class="p">(</span><span class="n">tries</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">delay</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">load_hospital_graph_from_csv</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Load structured hospital CSV data following</span>
<span class="sd">    a specific ontology into Neo4j"""</span>

    <span class="c1"># ...</span>

    <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Loading hospital nodes"</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">driver</span><span class="o">.</span><span class="n">session</span><span class="p">(</span><span class="n">database</span><span class="o">=</span><span class="s2">"neo4j"</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
        <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"""</span>
<span class="s2">        LOAD CSV WITH HEADERS</span>
<span class="s2">        FROM '</span><span class="si">{</span><span class="n">HOSPITALS_CSV_PATH</span><span class="si">}</span><span class="s2">' AS hospitals</span>
<span class="s2">        MERGE (h:Hospital </span><span class="se">{{</span><span class="s2">id: toInteger(hospitals.hospital_id),</span>
<span class="s2">                            name: hospitals.hospital_name,</span>
<span class="s2">                            state_name: hospitals.hospital_state</span><span class="se">}}</span><span class="s2">);</span>
<span class="s2">        """</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">{})</span>

   <span class="c1"># ...</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
    <span class="n">load_hospital_graph_from_csv</span><span class="p">()</span>
</code></pre></div>
    
    <button class="codeblock__copy btn btn-outline-secondary border m-1 px-1 d-hover-only" title="Copy to clipboard"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#@copy"></use></svg></span></button>
    <template class="codeblock__copied-template"></template>
    
  </div>
</div>
<p>Each node and relationship is loaded from their respective csv files and written to Neo4j according to your graph database design. At the end of the script, you call <code>load_hospital_graph_from_csv()</code> in the <a href="https://realpython.com/if-name-main-python/">name-main idiom</a>, and all of the data should populate in your Neo4j instance.</p>
<p>After writing <code>hospital_neo4j_etl/src/hospital_bulk_csv_write.py</code>, you can define an <code>entrypoint.sh</code> file that will run when your Docker container starts:</p>
<div class="codeblock mb-3 w-100" aria-label="Code block" data-syntax-language="sh">
  <div class="codeblock__header d-flex justify-content-between codeblock--yellow">
    <span class="mr-2 noselect" aria-label="Language">Shell</span>
    <span class="mr-2" aria-label="Filename"><code style="color: inherit;">hospital_neo4j_etl/src/entrypoint.sh</code></span>
    <div class="noselect">
      
    </div>
  </div>
  <div style="position: relative;">
    <div class="highlight highlight--with-header"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># Run any setup steps or pre-processing tasks here</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">"Running ETL to move hospital data from csvs to Neo4j..."</span>

<span class="c1"># Run the ETL script</span>
python<span class="w"> </span>hospital_bulk_csv_write.py
</code></pre></div>
    
    <button class="codeblock__copy btn btn-outline-secondary border m-1 px-1 d-hover-only" title="Copy to clipboard"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#@copy"></use></svg></span></button>
    <template class="codeblock__copied-template"></template>
    
  </div>
</div>
<p>This entrypoint file isn’t technically necessary for this project, but it’s a good practice when building containers because it allows you to execute necessary shell commands before running your main script.</p>
<p>The last file to write for your ETL is the Docker file. It looks like this:</p>
<div class="codeblock mb-3 w-100" aria-label="Code block" data-syntax-language="dockerfile">
  <div class="codeblock__header d-flex justify-content-between codeblock--grey">
    <span class="mr-2 noselect" aria-label="Language">Dockerfile</span>
    <span class="mr-2" aria-label="Filename"><code style="color: inherit;">hospital_neo4j_etl/Dockerfile</code></span>
    <div class="noselect">
      
    </div>
  </div>
  <div style="position: relative;">
    <div class="highlight highlight--with-header"><pre><span></span><code><span class="k">FROM</span><span class="w"> </span><span class="s">python:3.11-slim</span>

<span class="k">WORKDIR</span><span class="w"> </span><span class="s">/app</span>

<span class="k">COPY</span><span class="w"> </span>./src/<span class="w"> </span>/app

<span class="k">COPY</span><span class="w"> </span>./pyproject.toml<span class="w"> </span>/code/pyproject.toml
<span class="k">RUN</span><span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>/code/.

<span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">"sh"</span><span class="p">,</span><span class="w"> </span><span class="s2">"entrypoint.sh"</span><span class="p">]</span>
</code></pre></div>
    
    <button class="codeblock__copy btn btn-outline-secondary border m-1 px-1 d-hover-only" title="Copy to clipboard"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#@copy"></use></svg></span></button>
    <template class="codeblock__copied-template"></template>
    
  </div>
</div>
<p>This <code>Dockerfile</code> tells your container to use the <code>python:3.11-slim</code> <a href="https://hub.docker.com/_/python">distribution</a>, copy the contents from <code>hospital_neo4j_etl/src/</code> into the <code>/app</code> directory within the container, install the dependencies from <code>pyproject.toml</code>, and run <code>entrypoint.sh</code>.</p>
<p>You can now add this project to <code>docker-compose.yml</code>:</p>
<div class="codeblock mb-3 w-100" aria-label="Code block" data-syntax-language="yaml">
  <div class="codeblock__header d-flex justify-content-between codeblock--grey">
    <span class="mr-2 noselect" aria-label="Language">YAML</span>
    <span class="mr-2" aria-label="Filename"><code style="color: inherit;">docker-compose.yml</code></span>
    <div class="noselect">
      
    </div>
  </div>
  <div style="position: relative;">
    <div class="highlight highlight--with-header"><pre><span></span><code><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">'3'</span>

<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">hospital_neo4j_etl</span><span class="p">:</span>
<span class="w">    </span><span class="nt">build</span><span class="p">:</span>
<span class="w">      </span><span class="nt">context</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./hospital_neo4j_etl</span>
<span class="w">    </span><span class="nt">env_file</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.env</span>
</code></pre></div>
    
    <button class="codeblock__copy btn btn-outline-secondary border m-1 px-1 d-hover-only" title="Copy to clipboard"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#@copy"></use></svg></span></button>
    <template class="codeblock__copied-template"></template>
    
  </div>
</div>
<p>The ETL will run as a service called <code>hospital_neo4j_etl</code>, and it will run the Dockerfile in <code>./hospital_neo4j_etl</code> using environment variables from <code>.env</code>. Since you only have one container, you don’t need docker-compose yet. However, you’ll add more containers to orchestrate with your ETL in the next section, so it’s helpful to get started on <code>docker-compose.yml</code>.</p>
<p>To run your ETL, open a terminal and run:</p>
<div class="codeblock mb-3 w-100" aria-label="Code block" data-syntax-language="console" data-is-repl="true">
  <div class="codeblock__header d-flex justify-content-between codeblock--yellow">
    <span class="mr-2 noselect" aria-label="Language">Shell</span>
    
    <div class="noselect">
      
        <span class="codeblock__output-toggle" title="Toggle prompts and output"><span class="icon baseline js-codeblock-output-on codeblock__header--icon-lower"><svg><use href="/static/icons.67f62bbffdec.svg#regular--rectangle-terminal"></use></svg></span></span>
      
    </div>
  </div>
  <div style="position: relative;">
    <div class="highlight highlight--with-header"><pre><span></span><code><span class="gp">$ </span>docker-compose<span class="w"> </span>up<span class="w"> </span>--build
</code></pre></div>
    
    <button class="codeblock__copy btn btn-outline-secondary border m-1 px-1 d-hover-only" title="Copy to clipboard"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#@copy"></use></svg></span></button>
    <template class="codeblock__copied-template"></template>
    
  </div>
</div>
<p>Once the ETL finishes running, return to your Aura console:</p>
<figure class="js-lightbox"><a href="./Build an LLM RAG Chatbot With LangChain – Real Python_files/Screenshot_2024-01-10_at_10.00.34_AM.0ca76879f1fc.png" target="_blank"><img loading="lazy" class="img-fluid mx-auto d-block " src="./Build an LLM RAG Chatbot With LangChain – Real Python_files/Screenshot_2024-01-10_at_10.00.34_AM.0ca76879f1fc.png" width="2558" height="1234" srcset="https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/Screenshot_2024-01-10_at_10.00.34_AM.0ca76879f1fc.png&amp;w=639&amp;sig=9af013b61a2e40377bfa3ad33a924fdcf47b6dd8 639w, https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/Screenshot_2024-01-10_at_10.00.34_AM.0ca76879f1fc.png&amp;w=852&amp;sig=0f13af9cb4a2cd5611d290a770640b00016741be 852w, https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/Screenshot_2024-01-10_at_10.00.34_AM.0ca76879f1fc.png&amp;w=1279&amp;sig=92cae958c0778b03ac8b64a0205c747cc0313069 1279w, https://files.realpython.com/media/Screenshot_2024-01-10_at_10.00.34_AM.0ca76879f1fc.png 2558w" sizes="(min-width: 1200px) 690px, (min-width: 780px) calc(-5vw + 669px), (min-width: 580px) 510px, calc(100vw - 30px)" alt="Neo4j Aura Running Instance" data-asset="5636"></a><figcaption class="figure-caption text-center">Aura console</figcaption></figure>

<p>Click <strong>Open</strong> and you’ll be prompted to enter your Neo4j password. After successfully logging into the instance, you should see a screen similar to this:</p>
<figure class="js-lightbox"><a href="./Build an LLM RAG Chatbot With LangChain – Real Python_files/Screenshot_2024-01-12_at_8.14.38_AM.72233e36a1e0.png" target="_blank"><img loading="lazy" class="img-fluid mx-auto d-block " src="./Build an LLM RAG Chatbot With LangChain – Real Python_files/Screenshot_2024-01-12_at_8.14.38_AM.72233e36a1e0.png" width="2648" height="1434" srcset="https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/Screenshot_2024-01-12_at_8.14.38_AM.72233e36a1e0.png&amp;w=662&amp;sig=476052047ddbaa3cd2f4956b68067d8263598794 662w, https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/Screenshot_2024-01-12_at_8.14.38_AM.72233e36a1e0.png&amp;w=882&amp;sig=960a5f96e4b53671427d820f4e323f902aa5aefe 882w, https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/Screenshot_2024-01-12_at_8.14.38_AM.72233e36a1e0.png&amp;w=1324&amp;sig=4ca5187fe27d86ea74383f983d68aab6d7912367 1324w, https://files.realpython.com/media/Screenshot_2024-01-12_at_8.14.38_AM.72233e36a1e0.png 2648w" sizes="(min-width: 1200px) 690px, (min-width: 780px) calc(-5vw + 669px), (min-width: 580px) 510px, calc(100vw - 30px)" alt="Neo4j Aura instance with hospital data loaded" data-asset="5640"></a><figcaption class="figure-caption text-center">Neo4j Aura instance with hospital system data loaded</figcaption></figure>

<p>As you can see under <strong>Database Information</strong>, all of the nodes, relationships, and properties were loaded. There are 21,187 nodes and 48,259 relationships. You’re ready to start writing queries! </p>
<div><div class="rounded border border-light" style="display:block;position:relative;"> <div style="display:block;width:100%;padding-top:12.5%;"></div> <div class="rpad rounded border" data-unit="8x1" style="position:absolute;left:0;top:0;right:0;bottom:0;overflow:hidden;"> </div></div><a class="small text-muted" href="https://realpython.com/account/join/" rel="nofollow"> <span class="icon baseline mr-1"><svg><use href="/static/icons.67f62bbffdec.svg#solid--circle-info"></use></svg></span>Remove ads</a></div></section><section class="section3"><h3 id="query-the-hospital-system-graph">Query the Hospital System Graph<a class="headerlink" href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#query-the-hospital-system-graph" title="Permanent link"></a></h3>
<p>The last thing you need to do before building your chatbot is get familiar with <a href="https://neo4j.com/docs/getting-started/cypher-intro/">Cypher</a> syntax. Cypher is Neo4j’s query language, and it’s fairly intuitive to learn, especially if you’re familiar with SQL. This section will cover the basics, and that’s all you need to build the chatbot. You can check out <a href="https://neo4j.com/docs/getting-started/cypher-intro/">Neo4j’s documentation</a> for a more comprehensive Cypher overview. </p>
<p>The most commonly used key word for reading data in Cypher is <code>MATCH</code>, and it’s used to specify patterns to look for in the graph. The simplest pattern is one with a single node. For example, if you wanted to find the first five patient nodes written to the graph, you could run the following Cypher query:</p>
<div class="codeblock mb-3 w-100" aria-label="Code block" data-syntax-language="cypher">
  <div class="codeblock__header d-flex justify-content-between codeblock--red">
    <span class="mr-2 noselect" aria-label="Language">Cypher Query Language</span>
    
    <div class="noselect">
      
    </div>
  </div>
  <div style="position: relative;">
    <div class="highlight highlight--with-header"><pre><span></span><code><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="p">:</span><span class="n">Patient</span><span class="p">)</span>
<span class="k">RETURN</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="k">LIMIT</span><span class="w"> </span><span class="m">5</span><span class="p">;</span>
</code></pre></div>
    
    <button class="codeblock__copy btn btn-outline-secondary border m-1 px-1 d-hover-only" title="Copy to clipboard"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#@copy"></use></svg></span></button>
    <template class="codeblock__copied-template"></template>
    
  </div>
</div>
<p>In this query, you’re matching on <code>Patient</code> nodes. In Cypher, nodes are always indicated by parentheses. The <code>p</code> in <code>(p:Patient)</code> is an alias that you can reference later in the query. <code>RETURN p LIMIT 5;</code> tells Neo4j to only return five patient nodes. You can run this query in the Neo4j UI, and the results should look like this:</p>
<figure class="js-lightbox"><a href="./Build an LLM RAG Chatbot With LangChain – Real Python_files/Screenshot_2024-01-12_at_8.43.18_AM.da207917fbbd.png" target="_blank"><img loading="lazy" class="img-fluid mx-auto d-block " src="./Build an LLM RAG Chatbot With LangChain – Real Python_files/Screenshot_2024-01-12_at_8.43.18_AM.da207917fbbd.png" width="2928" height="1440" srcset="https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/Screenshot_2024-01-12_at_8.43.18_AM.da207917fbbd.png&amp;w=732&amp;sig=3da084666bc0b4e377f0e88a20bb061f958326cd 732w, https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/Screenshot_2024-01-12_at_8.43.18_AM.da207917fbbd.png&amp;w=976&amp;sig=9033fe26b4493ab03743be8f8ec00277387c7a12 976w, https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/Screenshot_2024-01-12_at_8.43.18_AM.da207917fbbd.png&amp;w=1464&amp;sig=5fe4d19e962b137df61bac0eb2a1dba921c8a7cb 1464w, https://files.realpython.com/media/Screenshot_2024-01-12_at_8.43.18_AM.da207917fbbd.png 2928w" sizes="(min-width: 1200px) 690px, (min-width: 780px) calc(-5vw + 669px), (min-width: 580px) 510px, calc(100vw - 30px)" alt="Cypher match node query" data-asset="5641"></a><figcaption class="figure-caption text-center">Cypher match node query in the Neo4j UI</figcaption></figure>

<p>The <strong>Table</strong> view shows you the five <strong>Patient</strong> nodes returned along with their properties. You can also explore the graph and raw view if you’re interested.</p>
<p>While matching on a single node is straightforward, sometimes that’s all you need to get useful insights. For example, if your stakeholder said <strong>give me a summary of visit 56</strong>, the following query gives you the answer:</p>
<div class="codeblock mb-3 w-100" aria-label="Code block" data-syntax-language="cypher">
  <div class="codeblock__header d-flex justify-content-between codeblock--red">
    <span class="mr-2 noselect" aria-label="Language">Cypher Query Language</span>
    
    <div class="noselect">
      
    </div>
  </div>
  <div style="position: relative;">
    <div class="highlight highlight--with-header"><pre><span></span><code><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">v</span><span class="p">:</span><span class="n">Visit</span><span class="p">)</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">v</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="m">56</span>
<span class="k">RETURN</span><span class="w"> </span><span class="n">v</span><span class="p">;</span>
</code></pre></div>
    
    <button class="codeblock__copy btn btn-outline-secondary border m-1 px-1 d-hover-only" title="Copy to clipboard"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#@copy"></use></svg></span></button>
    <template class="codeblock__copied-template"></template>
    
  </div>
</div>
<p>This query matches <code>Visit</code> nodes that have an <code>id</code> of 56, specified by <code>WHERE v.id = 56</code>. You can filter on arbitrary node and relationship properties in <code>WHERE</code> clauses. The results of this query look like this:</p>
<figure class="js-lightbox"><a href="./Build an LLM RAG Chatbot With LangChain – Real Python_files/Screenshot_2024-01-12_at_9.23.59_AM.cf28876d7d65.png" target="_blank"><img loading="lazy" class="img-fluid mx-auto d-block " src="./Build an LLM RAG Chatbot With LangChain – Real Python_files/Screenshot_2024-01-12_at_9.23.59_AM.cf28876d7d65.png" width="3178" height="1258" srcset="https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/Screenshot_2024-01-12_at_9.23.59_AM.cf28876d7d65.png&amp;w=794&amp;sig=f397b6e0323dc538611493d15c463e6d524813bf 794w, https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/Screenshot_2024-01-12_at_9.23.59_AM.cf28876d7d65.png&amp;w=1059&amp;sig=33ba163f03fef49fa95433d0152798c56cbae04e 1059w, https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/Screenshot_2024-01-12_at_9.23.59_AM.cf28876d7d65.png&amp;w=1589&amp;sig=15b37d125c707d5d80a521207bb7b111df6ce9ce 1589w, https://files.realpython.com/media/Screenshot_2024-01-12_at_9.23.59_AM.cf28876d7d65.png 3178w" sizes="(min-width: 1200px) 690px, (min-width: 780px) calc(-5vw + 669px), (min-width: 580px) 510px, calc(100vw - 30px)" alt="Cypher match node query with filter" data-asset="5642"></a><figcaption class="figure-caption text-center">Cypher match node query filtered on a node property</figcaption></figure>

<p>From the query output, you can see the returned <strong>Visit</strong> indeed has <strong>id</strong> 56. You could then look at all of the visit properties to come up with a verbal summary of the visit—this is what your Cypher chain will do.</p>
<p>Matching on nodes is great, but the real power of Cypher comes from its ability to match on relationship patterns. This gives you insight into sophisticated relationships, exploiting the power of graph databases. Continuing with the <strong>Visit</strong> query, you probably want to know which <strong>Patient</strong> the <strong>Visit</strong> belongs to. You can get this from the <strong>HAS</strong> relationship:</p>
<div class="codeblock mb-3 w-100" aria-label="Code block" data-syntax-language="cypher">
  <div class="codeblock__header d-flex justify-content-between codeblock--red">
    <span class="mr-2 noselect" aria-label="Language">Cypher Query Language</span>
    
    <div class="noselect">
      
    </div>
  </div>
  <div style="position: relative;">
    <div class="highlight highlight--with-header"><pre><span></span><code><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="p">:</span><span class="n">Patient</span><span class="p">)</span><span class="o">-[</span><span class="n">h</span><span class="p">:</span><span class="n">HAS</span><span class="o">]-&gt;</span><span class="p">(</span><span class="n">v</span><span class="p">:</span><span class="n">Visit</span><span class="p">)</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">v</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="m">56</span>
<span class="k">RETURN</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="n">p</span><span class="p">;</span>
</code></pre></div>
    
    <button class="codeblock__copy btn btn-outline-secondary border m-1 px-1 d-hover-only" title="Copy to clipboard"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#@copy"></use></svg></span></button>
    <template class="codeblock__copied-template"></template>
    
  </div>
</div>
<p>This Cypher query searches for the <code>Patient</code> that has a <code>Visit</code> with <code>id</code> 56. You’ll notice that the relationship <code>HAS</code> is surrounded by square brackets instead of parentheses, and its directionality is indicated by an arrow. If you tried <code>MATCH (p:Patient)&lt;-[h:HAS]-(v:Visit)</code>, the query would return nothing because the direction of <strong>HAS</strong> relationship is incorrect.</p>
<p>The query results look like this:</p>
<figure class="js-lightbox"><a href="./Build an LLM RAG Chatbot With LangChain – Real Python_files/Screenshot_2024-01-12_at_9.49.31_AM.3cad959aa115.png" target="_blank"><img loading="lazy" class="img-fluid mx-auto d-block " src="./Build an LLM RAG Chatbot With LangChain – Real Python_files/Screenshot_2024-01-12_at_9.49.31_AM.3cad959aa115.png" width="3196" height="1284" srcset="https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/Screenshot_2024-01-12_at_9.49.31_AM.3cad959aa115.png&amp;w=799&amp;sig=abdef85bf60937d5ee89ca398f25c02ac329cfbc 799w, https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/Screenshot_2024-01-12_at_9.49.31_AM.3cad959aa115.png&amp;w=1065&amp;sig=a8cc4d01ff621b7d18661b2a9042fcba323f36d3 1065w, https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/Screenshot_2024-01-12_at_9.49.31_AM.3cad959aa115.png&amp;w=1598&amp;sig=c09d150b19e29712b1041bc9ff7cd6246298e599 1598w, https://files.realpython.com/media/Screenshot_2024-01-12_at_9.49.31_AM.3cad959aa115.png 3196w" sizes="(min-width: 1200px) 690px, (min-width: 780px) calc(-5vw + 669px), (min-width: 580px) 510px, calc(100vw - 30px)" alt="Cypher match relationship query" data-asset="5643"></a><figcaption class="figure-caption text-center">Cypher query for the HAS relationship</figcaption></figure>

<p>Notice the output includes data for the <strong>Visit</strong>, <strong>HAS</strong> relationship, and <strong>Patient</strong>. This gives you more insight than if you only match on <strong>Visit</strong> nodes. If you wanted to see which physicians treated the patient during the <strong>Visit</strong>, you could add the following relationship to the query:</p>
<div class="codeblock mb-3 w-100" aria-label="Code block" data-syntax-language="cypher">
  <div class="codeblock__header d-flex justify-content-between codeblock--red">
    <span class="mr-2 noselect" aria-label="Language">Cypher Query Language</span>
    
    <div class="noselect">
      
    </div>
  </div>
  <div style="position: relative;">
    <div class="highlight highlight--with-header"><pre><span></span><code><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="p">:</span><span class="n">Patient</span><span class="p">)</span><span class="o">-[</span><span class="n">h</span><span class="p">:</span><span class="n">HAS</span><span class="o">]-&gt;</span><span class="p">(</span><span class="n">v</span><span class="p">:</span><span class="n">Visit</span><span class="p">)</span><span class="o">&lt;-[</span><span class="n">t</span><span class="p">:</span><span class="n">TREATS</span><span class="o">]-</span><span class="p">(</span><span class="n">ph</span><span class="p">:</span><span class="n">Physician</span><span class="p">)</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">v</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="m">56</span>
<span class="k">RETURN</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">ph</span>
</code></pre></div>
    
    <button class="codeblock__copy btn btn-outline-secondary border m-1 px-1 d-hover-only" title="Copy to clipboard"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#@copy"></use></svg></span></button>
    <template class="codeblock__copied-template"></template>
    
  </div>
</div>
<p>This statement <code>(p:Patient)-[h:HAS]-&gt;(v:Visit)&lt;-[t:TREATS]-(ph:Physician)</code> tells Neo4j to find all patterns where a <code>Patient</code> has a <code>Visit</code> that’s treated by a <code>Physician</code>. If you wanted to match all relationships going in and out of the <code>Visit</code> node, you could run this query:</p>
<div class="codeblock mb-3 w-100" aria-label="Code block" data-syntax-language="cypher">
  <div class="codeblock__header d-flex justify-content-between codeblock--red">
    <span class="mr-2 noselect" aria-label="Language">Cypher Query Language</span>
    
    <div class="noselect">
      
    </div>
  </div>
  <div style="position: relative;">
    <div class="highlight highlight--with-header"><pre><span></span><code><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">v</span><span class="p">:</span><span class="n">Visit</span><span class="p">)</span><span class="o">-[</span><span class="n">r</span><span class="o">]-</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">v</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="m">56</span>
<span class="k">RETURN</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="n">n</span><span class="p">;</span>
</code></pre></div>
    
    <button class="codeblock__copy btn btn-outline-secondary border m-1 px-1 d-hover-only" title="Copy to clipboard"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#@copy"></use></svg></span></button>
    <template class="codeblock__copied-template"></template>
    
  </div>
</div>
<p>Notice now that the relationship <code>[r]</code>, has no direction with respect to <code>(v:Visit)</code> or <code>(n)</code>. In essence, this match statement will look for all relationships that go in and out of <code>Visit</code> 56, along with the nodes connected to those relationships. Here’s the results:</p>
<figure class="js-lightbox"><a href="./Build an LLM RAG Chatbot With LangChain – Real Python_files/Screenshot_2024-01-12_at_10.15.30_AM.a7ebafaf83f5.png" target="_blank"><img loading="lazy" class="img-fluid mx-auto d-block " src="./Build an LLM RAG Chatbot With LangChain – Real Python_files/Screenshot_2024-01-12_at_10.15.30_AM.a7ebafaf83f5.png" width="3188" height="1320" srcset="https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/Screenshot_2024-01-12_at_10.15.30_AM.a7ebafaf83f5.png&amp;w=797&amp;sig=e24f621e498a6f03d8a6e671284c022e135eb9c6 797w, https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/Screenshot_2024-01-12_at_10.15.30_AM.a7ebafaf83f5.png&amp;w=1062&amp;sig=f619a407e25f84752a2e061e676aafa5a85f9bec 1062w, https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/Screenshot_2024-01-12_at_10.15.30_AM.a7ebafaf83f5.png&amp;w=1594&amp;sig=db35b7cd5995f8baff9a4276591ef096984baa12 1594w, https://files.realpython.com/media/Screenshot_2024-01-12_at_10.15.30_AM.a7ebafaf83f5.png 3188w" sizes="(min-width: 1200px) 690px, (min-width: 780px) calc(-5vw + 669px), (min-width: 580px) 510px, calc(100vw - 30px)" alt="Cypher match all relationships to a node" data-asset="5644"></a><figcaption class="figure-caption text-center">Cypher query matching all relationships and nodes to Visit 56</figcaption></figure>

<p>This gives you a nice view of all the relationships and nodes associated with <strong>Visit</strong> 56. Think about how powerful this representation is. Instead of performing multiple SQL joins, as you’d have to do in a relational database, you get all of the information about how a <strong>Visit</strong> is connected to the entire hospital system with three short lines of Cypher. </p>
<p>You can imagine how much more powerful this would become as more nodes and relationships are added to the graph database. For example, you could record which nurses, pharmacies, drugs, or surgeries are associated with the <strong>Visit</strong>. Each relationship that you add would necessitate another join in SQL, but the above Cypher query about <strong>Visit</strong> 56 would remain unchanged.</p>
<p>The last thing you’ll cover in this section is how to perform aggregations in Cypher. So far, you’ve only queried raw data from nodes and relationships, but you can also compute aggregate statistics in Cypher. </p>
<p>Suppose you wanted to answer the question <em>What is the total number of visits and total billing amount for visits covered by Aetna in Texas?</em> Here’s the Cypher query that would answer this question:</p>
<div class="codeblock mb-3 w-100" aria-label="Code block" data-syntax-language="cypher">
  <div class="codeblock__header d-flex justify-content-between codeblock--red">
    <span class="mr-2 noselect" aria-label="Language">Cypher Query Language</span>
    
    <div class="noselect">
      
    </div>
  </div>
  <div style="position: relative;">
    <div class="highlight highlight--with-header"><pre><span></span><code><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="p">:</span><span class="n">Payer</span><span class="p">)</span><span class="o">&lt;-[</span><span class="n">c</span><span class="p">:</span><span class="n">COVERED_BY</span><span class="o">]-</span><span class="p">(</span><span class="n">v</span><span class="p">:</span><span class="n">Visit</span><span class="p">)</span><span class="o">-[</span><span class="p">:</span><span class="n">AT</span><span class="o">]-&gt;</span><span class="p">(</span><span class="n">h</span><span class="p">:</span><span class="n">Hospital</span><span class="p">)</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">"Aetna"</span>
<span class="n">AND</span><span class="w"> </span><span class="n">h</span><span class="p">.</span><span class="n">state_name</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">"TX"</span>
<span class="k">RETURN</span><span class="w"> </span><span class="n">COUNT</span><span class="p">(*)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">num_visits</span><span class="p">,</span>
<span class="n">SUM</span><span class="p">(</span><span class="n">c</span><span class="p">.</span><span class="n">billing_amount</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">total_billing_amount</span><span class="p">;</span>
</code></pre></div>
    
    <button class="codeblock__copy btn btn-outline-secondary border m-1 px-1 d-hover-only" title="Copy to clipboard"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#@copy"></use></svg></span></button>
    <template class="codeblock__copied-template"></template>
    
  </div>
</div>
<p>In this query, you first match all <code>Visits</code> that occur at a <code>Hospital</code> and are covered by a <code>Payer</code>. You then filter to <code>Payers</code> with a <code>name</code> property of <strong>Aetna</strong> and <code>Hospitals</code> with a <code>state_name</code> of <strong>TX</strong>. Lastly, <code>COUNT(*)</code> counts the number of matched patterns, and <code>SUM(c.billing_amount)</code> gives you the total billing amount. The output looks like this:</p>
<figure class="js-lightbox"><a href="./Build an LLM RAG Chatbot With LangChain – Real Python_files/Screenshot_2024-01-12_at_10.38.24_AM.a939c19875db.png" target="_blank"><img loading="lazy" class="img-fluid mx-auto d-block " src="./Build an LLM RAG Chatbot With LangChain – Real Python_files/Screenshot_2024-01-12_at_10.38.24_AM.a939c19875db.png" width="3200" height="1192" srcset="https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/Screenshot_2024-01-12_at_10.38.24_AM.a939c19875db.png&amp;w=800&amp;sig=2e7970b3adff21c591ce2a9394457b199aacf2b5 800w, https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/Screenshot_2024-01-12_at_10.38.24_AM.a939c19875db.png&amp;w=1066&amp;sig=89a4640e7abab700a9381083770c7b76b6a134f8 1066w, https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/Screenshot_2024-01-12_at_10.38.24_AM.a939c19875db.png&amp;w=1600&amp;sig=6805843f5a3a99649113d93a0f6c1ad030fc7e42 1600w, https://files.realpython.com/media/Screenshot_2024-01-12_at_10.38.24_AM.a939c19875db.png 3200w" sizes="(min-width: 1200px) 690px, (min-width: 780px) calc(-5vw + 669px), (min-width: 580px) 510px, calc(100vw - 30px)" alt="Cypher aggregate query" data-asset="5645"></a><figcaption class="figure-caption text-center">Cypher aggregate query</figcaption></figure>

<p>The results tell you there were 198 <strong>Visits</strong> matching this pattern with a total billing amount of about $5,056,439. </p>
<p>You now have a solid understanding of Cypher fundamentals, as well as the kinds of questions you can answer. In short, Cypher is great at matching complicated relationships without requiring a verbose query. There’s a lot more that you can do with Neo4j and Cypher, but the knowledge you obtained in this section is enough to start building the chatbot, and that’s what you’ll do next.</p>
</section></section><section class="section2"><h2 id="step-4-build-a-graph-rag-chatbot-in-langchain">Step 4: Build a Graph RAG Chatbot in LangChain<a class="headerlink" href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#step-4-build-a-graph-rag-chatbot-in-langchain" title="Permanent link"></a></h2>
<p>After all the preparatory design and data work you’ve done so far, you’re finally ready to build your chatbot! You’ll likely notice that, with the hospital system data stored in Neo4j, and the power of LangChain abstractions, building your chatbot doesn’t take much work. This is a common theme in AI and ML projects—most of the work is in design, data preparation, and deployment rather than building the AI itself.</p>
<p>Before you jump in, add a <code>chatbot_api/</code> folder to your project with the following files and folders: </p>
<div class="highlight"><pre><span></span><code>./
│
<span class="hll">├── chatbot_api/
</span><span class="hll">│   │
</span><span class="hll">│   ├── src/
</span><span class="hll">│   │   │
</span><span class="hll">│   │   ├── agents/
</span><span class="hll">│   │   │   └── hospital_rag_agent.py
</span><span class="hll">│   │   │
</span><span class="hll">│   │   ├── chains/
</span><span class="hll">│   │   │   ├── hospital_cypher_chain.py
</span><span class="hll">│   │   │   └── hospital_review_chain.py
</span><span class="hll">│   │   │
</span><span class="hll">│   │   ├── tools/
</span><span class="hll">│   │   │   └── wait_times.py
</span><span class="hll">│   │
</span><span class="hll">│   └── pyproject.toml
</span>│
├── hospital_neo4j_etl/
│   │
│   ├── src/
│   │   ├── entrypoint.sh
│   │   └── hospital_bulk_csv_write.py
│   │
│   ├── Dockerfile
│   └── pyproject.toml
│
├── .env
└── docker-compose.yml
</code></pre></div>
<p>You’ll want to add a few more environment variables to your <code>.env</code> file as well:</p>
<div class="codeblock mb-3 w-100" aria-label="Code block" data-syntax-language="dotenv">
  <div class="codeblock__header d-flex justify-content-between codeblock--grey">
    <span class="mr-2 noselect" aria-label="Language">.env</span>
    
    <div class="noselect">
      
    </div>
  </div>
  <div style="position: relative;">
    <div class="highlight highlight--with-header"><pre><span></span><code><span class="na">OPENAI_API_KEY</span><span class="o">=</span><span class="s">&lt;YOUR_OPENAI_API_KEY&gt;</span>

<span class="na">NEO4J_URI</span><span class="o">=</span><span class="s">&lt;YOUR_NEO4J_URI&gt;</span>
<span class="na">NEO4J_USERNAME</span><span class="o">=</span><span class="s">&lt;YOUR_NEO4J_URI&gt;</span>
<span class="na">NEO4J_PASSWORD</span><span class="o">=</span><span class="s">&lt;YOUR_NEO4J_PASSWORD&gt;</span>

<span class="na">HOSPITALS_CSV_PATH</span><span class="o">=</span><span class="s">https://raw.githubusercontent.com/hfhoffman1144/langchain_neo4j_rag_app/main/data/hospitals.csv</span>
<span class="na">PAYERS_CSV_PATH</span><span class="o">=</span><span class="s">https://raw.githubusercontent.com/hfhoffman1144/langchain_neo4j_rag_app/main/data/payers.csv</span>
<span class="na">PHYSICIANS_CSV_PATH</span><span class="o">=</span><span class="s">https://raw.githubusercontent.com/hfhoffman1144/langchain_neo4j_rag_app/main/data/physicians.csv</span>
<span class="na">PATIENTS_CSV_PATH</span><span class="o">=</span><span class="s">https://raw.githubusercontent.com/hfhoffman1144/langchain_neo4j_rag_app/main/data/patients.csv</span>
<span class="na">VISITS_CSV_PATH</span><span class="o">=</span><span class="s">https://raw.githubusercontent.com/hfhoffman1144/langchain_neo4j_rag_app/main/data/visits.csv</span>
<span class="na">REVIEWS_CSV_PATH</span><span class="o">=</span><span class="s">https://raw.githubusercontent.com/hfhoffman1144/langchain_neo4j_rag_app/main/data/reviews.csv</span>

<span class="hll"><span class="na">HOSPITAL_AGENT_MODEL</span><span class="o">=</span><span class="s">gpt-3.5-turbo-1106</span>
</span><span class="hll"><span class="na">HOSPITAL_CYPHER_MODEL</span><span class="o">=</span><span class="s">gpt-3.5-turbo-1106</span>
</span><span class="hll"><span class="na">HOSPITAL_QA_MODEL</span><span class="o">=</span><span class="s">gpt-3.5-turbo-0125</span>
</span></code></pre></div>
    
    <button class="codeblock__copy btn btn-outline-secondary border m-1 px-1 d-hover-only" title="Copy to clipboard"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#@copy"></use></svg></span></button>
    <template class="codeblock__copied-template"></template>
    
  </div>
</div>
<p>Your <code>.env</code> file now includes variables that specify which LLM you’ll use for different components of your chatbot. You’ve specified these models as environment variables so that you can easily switch between different OpenAI models without changing any code. Keep in mind, however, that each LLM might benefit from a unique prompting strategy, so you might need to modify your prompts if you plan on using a different suite of LLMs.</p>
<p>You should already have the <code>hospital_neo4j_etl/</code> folder completed, and <code>docker-compose.yml</code> and <code>.env</code> are the same as before. Open up <code>chatbot_api/pyproject.toml</code> and add the following dependencies:</p>
<div class="codeblock mb-3 w-100" aria-label="Code block" data-syntax-language="toml">
  <div class="codeblock__header d-flex justify-content-between codeblock--grey">
    <span class="mr-2 noselect" aria-label="Language">TOML</span>
    <span class="mr-2" aria-label="Filename"><code style="color: inherit;">chatbot_api/pyproject.toml</code></span>
    <div class="noselect">
      
    </div>
  </div>
  <div style="position: relative;">
    <div class="highlight highlight--with-header"><pre><span></span><code><span class="k">[project]</span>
<span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"chatbot_api"</span>
<span class="n">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"0.1"</span>
<span class="n">dependencies</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="s2">"asyncio==3.4.3"</span><span class="p">,</span>
<span class="w">    </span><span class="s2">"fastapi==0.109.0"</span><span class="p">,</span>
<span class="w">    </span><span class="s2">"langchain==0.1.0"</span><span class="p">,</span>
<span class="w">    </span><span class="s2">"langchain-openai==0.0.2"</span><span class="p">,</span>
<span class="w">    </span><span class="s2">"langchainhub==0.1.14"</span><span class="p">,</span>
<span class="w">    </span><span class="s2">"neo4j==5.14.1"</span><span class="p">,</span>
<span class="w">    </span><span class="s2">"numpy==1.26.2"</span><span class="p">,</span>
<span class="w">    </span><span class="s2">"openai==1.7.2"</span><span class="p">,</span>
<span class="w">    </span><span class="s2">"opentelemetry-api==1.22.0"</span><span class="p">,</span>
<span class="w">    </span><span class="s2">"pydantic==2.5.1"</span><span class="p">,</span>
<span class="w">    </span><span class="s2">"uvicorn==0.25.0"</span>
<span class="p">]</span>

<span class="k">[project.optional-dependencies]</span>
<span class="n">dev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">"black"</span><span class="p">,</span><span class="w"> </span><span class="s2">"flake8"</span><span class="p">]</span>
</code></pre></div>
    
    <button class="codeblock__copy btn btn-outline-secondary border m-1 px-1 d-hover-only" title="Copy to clipboard"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#@copy"></use></svg></span></button>
    <template class="codeblock__copied-template"></template>
    
  </div>
</div>
<p>You can certainly use more recent versions of these dependencies if they’re available, but keep in mind any features that might be deprecated. Open a terminal, activate your virtual environment, navigate into your <code>chatbot_api/</code> folder, and install dependencies from the project’s <code>pyproject.toml</code>:</p>
<div class="codeblock mb-3 w-100" aria-label="Code block" data-syntax-language="console" data-is-repl="true">
  <div class="codeblock__header d-flex justify-content-between codeblock--yellow">
    <span class="mr-2 noselect" aria-label="Language">Shell</span>
    
    <div class="noselect">
      
        <span class="codeblock__output-toggle" title="Toggle prompts and output"><span class="icon baseline js-codeblock-output-on codeblock__header--icon-lower"><svg><use href="/static/icons.67f62bbffdec.svg#regular--rectangle-terminal"></use></svg></span></span>
      
    </div>
  </div>
  <div style="position: relative;">
    <div class="highlight highlight--with-header"><pre><span></span><code><span class="gp gp-VirtualEnv">(venv)</span> <span class="gp">$ </span>python<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>.
</code></pre></div>
    
    <button class="codeblock__copy btn btn-outline-secondary border m-1 px-1 d-hover-only" title="Copy to clipboard"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#@copy"></use></svg></span></button>
    <template class="codeblock__copied-template"></template>
    
  </div>
</div>
<p>Once everything is installed, you’re ready to build the reviews chain!</p>
<section class="section3"><h3 id="create-a-neo4j-vector-chain">Create a Neo4j Vector Chain<a class="headerlink" href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#create-a-neo4j-vector-chain" title="Permanent link"></a></h3>
<p>In <a href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#step-1-get-familiar-with-langchain">Step 1</a>, you got a hands-on introduction to LangChain by building a chain that answers questions about patient experiences using their reviews. In this section, you’ll build a similar chain except you’ll use Neo4j as your vector index.</p>
<p><a href="https://neo4j.com/docs/cypher-manual/current/indexes-for-vector-search/">Vector search indexes</a> were released as a public beta in Neo4j 5.11. They allow you to run semantic queries directly on your graph. This is really convenient for your chatbot because you can store review embeddings in the same place as your structured hospital system data. </p>
<p>In LangChain, you can use <a href="https://python.langchain.com/docs/integrations/vectorstores/neo4jvector">Neo4jVector</a> to create review embeddings and the retriever needed for your chain. Here’s the code to create the reviews chain:</p>
<div class="codeblock mb-3 w-100" aria-label="Code block" data-syntax-language="python">
  <div class="codeblock__header d-flex justify-content-between codeblock--blue">
    <span class="mr-2 noselect" aria-label="Language">Python</span>
    <span class="mr-2" aria-label="Filename"><code style="color: inherit;">chatbot_api/src/chains/hospital_review_chain.py</code></span>
    <div class="noselect">
      
    </div>
  </div>
  <div style="position: relative;">
    <div class="highlight highlight--with-header"><pre><span></span><code><span class="linenos"> 1</span><span class="kn">import</span> <span class="nn">os</span>
<span class="linenos"> 2</span><span class="kn">from</span> <span class="nn">langchain.vectorstores.neo4j_vector</span> <span class="kn">import</span> <span class="n">Neo4jVector</span>
<span class="linenos"> 3</span><span class="kn">from</span> <span class="nn">langchain_openai</span> <span class="kn">import</span> <span class="n">OpenAIEmbeddings</span>
<span class="linenos"> 4</span><span class="kn">from</span> <span class="nn">langchain.chains</span> <span class="kn">import</span> <span class="n">RetrievalQA</span>
<span class="linenos"> 5</span><span class="kn">from</span> <span class="nn">langchain_openai</span> <span class="kn">import</span> <span class="n">ChatOpenAI</span>
<span class="linenos"> 6</span><span class="kn">from</span> <span class="nn">langchain.prompts</span> <span class="kn">import</span> <span class="p">(</span>
<span class="linenos"> 7</span>    <span class="n">PromptTemplate</span><span class="p">,</span>
<span class="linenos"> 8</span>    <span class="n">SystemMessagePromptTemplate</span><span class="p">,</span>
<span class="linenos"> 9</span>    <span class="n">HumanMessagePromptTemplate</span><span class="p">,</span>
<span class="linenos">10</span>    <span class="n">ChatPromptTemplate</span><span class="p">,</span>
<span class="linenos">11</span><span class="p">)</span>
<span class="linenos">12</span>
<span class="linenos">13</span><span class="n">HOSPITAL_QA_MODEL</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">"HOSPITAL_QA_MODEL"</span><span class="p">)</span>
<span class="linenos">14</span>
<span class="linenos">15</span><span class="n">neo4j_vector_index</span> <span class="o">=</span> <span class="n">Neo4jVector</span><span class="o">.</span><span class="n">from_existing_graph</span><span class="p">(</span>
<span class="linenos">16</span>    <span class="n">embedding</span><span class="o">=</span><span class="n">OpenAIEmbeddings</span><span class="p">(),</span>
<span class="linenos">17</span>    <span class="n">url</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">"NEO4J_URI"</span><span class="p">),</span>
<span class="linenos">18</span>    <span class="n">username</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">"NEO4J_USERNAME"</span><span class="p">),</span>
<span class="linenos">19</span>    <span class="n">password</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">"NEO4J_PASSWORD"</span><span class="p">),</span>
<span class="linenos">20</span>    <span class="n">index_name</span><span class="o">=</span><span class="s2">"reviews"</span><span class="p">,</span>
<span class="linenos">21</span>    <span class="n">node_label</span><span class="o">=</span><span class="s2">"Review"</span><span class="p">,</span>
<span class="linenos">22</span>    <span class="n">text_node_properties</span><span class="o">=</span><span class="p">[</span>
<span class="linenos">23</span>        <span class="s2">"physician_name"</span><span class="p">,</span>
<span class="linenos">24</span>        <span class="s2">"patient_name"</span><span class="p">,</span>
<span class="linenos">25</span>        <span class="s2">"text"</span><span class="p">,</span>
<span class="linenos">26</span>        <span class="s2">"hospital_name"</span><span class="p">,</span>
<span class="linenos">27</span>    <span class="p">],</span>
<span class="linenos">28</span>    <span class="n">embedding_node_property</span><span class="o">=</span><span class="s2">"embedding"</span><span class="p">,</span>
<span class="linenos">29</span><span class="p">)</span>
<span class="linenos">30</span>
<span class="linenos">31</span><span class="n">review_template</span> <span class="o">=</span> <span class="s2">"""Your job is to use patient</span>
<span class="linenos">32</span><span class="s2">reviews to answer questions about their experience at a hospital. Use</span>
<span class="linenos">33</span><span class="s2">the following context to answer questions. Be as detailed as possible, but</span>
<span class="linenos">34</span><span class="s2">don't make up any information that's not from the context. If you don't know</span>
<span class="linenos">35</span><span class="s2">an answer, say you don't know.</span>
<span class="linenos">36</span><span class="si">{context}</span>
<span class="linenos">37</span><span class="s2">"""</span>
<span class="linenos">38</span>
<span class="linenos">39</span><span class="n">review_system_prompt</span> <span class="o">=</span> <span class="n">SystemMessagePromptTemplate</span><span class="p">(</span>
<span class="linenos">40</span>    <span class="n">prompt</span><span class="o">=</span><span class="n">PromptTemplate</span><span class="p">(</span><span class="n">input_variables</span><span class="o">=</span><span class="p">[</span><span class="s2">"context"</span><span class="p">],</span> <span class="n">template</span><span class="o">=</span><span class="n">review_template</span><span class="p">)</span>
<span class="linenos">41</span><span class="p">)</span>
<span class="linenos">42</span>
<span class="linenos">43</span><span class="n">review_human_prompt</span> <span class="o">=</span> <span class="n">HumanMessagePromptTemplate</span><span class="p">(</span>
<span class="linenos">44</span>    <span class="n">prompt</span><span class="o">=</span><span class="n">PromptTemplate</span><span class="p">(</span><span class="n">input_variables</span><span class="o">=</span><span class="p">[</span><span class="s2">"question"</span><span class="p">],</span> <span class="n">template</span><span class="o">=</span><span class="s2">"</span><span class="si">{question}</span><span class="s2">"</span><span class="p">)</span>
<span class="linenos">45</span><span class="p">)</span>
<span class="linenos">46</span><span class="n">messages</span> <span class="o">=</span> <span class="p">[</span><span class="n">review_system_prompt</span><span class="p">,</span> <span class="n">review_human_prompt</span><span class="p">]</span>
<span class="linenos">47</span>
<span class="linenos">48</span><span class="n">review_prompt</span> <span class="o">=</span> <span class="n">ChatPromptTemplate</span><span class="p">(</span>
<span class="linenos">49</span>    <span class="n">input_variables</span><span class="o">=</span><span class="p">[</span><span class="s2">"context"</span><span class="p">,</span> <span class="s2">"question"</span><span class="p">],</span> <span class="n">messages</span><span class="o">=</span><span class="n">messages</span>
<span class="linenos">50</span><span class="p">)</span>
<span class="linenos">51</span>
<span class="linenos">52</span><span class="n">reviews_vector_chain</span> <span class="o">=</span> <span class="n">RetrievalQA</span><span class="o">.</span><span class="n">from_chain_type</span><span class="p">(</span>
<span class="linenos">53</span>    <span class="n">llm</span><span class="o">=</span><span class="n">ChatOpenAI</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">HOSPITAL_QA_MODEL</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
<span class="linenos">54</span>    <span class="n">chain_type</span><span class="o">=</span><span class="s2">"stuff"</span><span class="p">,</span>
<span class="linenos">55</span>    <span class="n">retriever</span><span class="o">=</span><span class="n">neo4j_vector_index</span><span class="o">.</span><span class="n">as_retriever</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="mi">12</span><span class="p">),</span>
<span class="linenos">56</span><span class="p">)</span>
<span class="linenos">57</span><span class="n">reviews_vector_chain</span><span class="o">.</span><span class="n">combine_documents_chain</span><span class="o">.</span><span class="n">llm_chain</span><span class="o">.</span><span class="n">prompt</span> <span class="o">=</span> <span class="n">review_prompt</span>
</code></pre></div>
    
    <button class="codeblock__copy btn btn-outline-secondary border m-1 px-1 d-hover-only" title="Copy to clipboard"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#@copy"></use></svg></span></button>
    <template class="codeblock__copied-template"></template>
    
  </div>
</div>
<p>In lines 1 to 11, you import the dependencies needed to build your review chain with Neo4j. In line 13, you load the name of the chat model you’ll use for the review chain and store it in <code>HOSPITAL_QA_MODEL</code>. Lines 15 to 29 create the vector index in Neo4j. Here’s a breakdown of each parameter:</p>
<ul>
<li><code>embedding</code>: The model used to create the embeddings—you’re using <code>OpenAIEmeddings()</code> in this example.</li>
<li><code>url</code>, <code>username</code>, and <code>password</code>: Your Neo4j instance credentials.</li>
<li><code>index_name</code>: The name given to your vector index.</li>
<li><code>node_label</code>: The node to create embeddings for.</li>
<li><code>text_node_properties</code>: The node properties to include in the embedding.</li>
<li><code>embedding_node_property</code>: The name of the embedding node property.</li>
</ul>
<p>Once <code>Neo4jVector.from_existing_graph()</code> runs, you’ll see that every <strong>Review</strong> node in Neo4j has an <strong>embedding</strong> property which is a vector representation of the <strong>physician_name</strong>, <strong>patient_name</strong>, <strong>text</strong>, and <strong>hospital_name</strong> properties. This allows you to answer questions like <em>Which hospitals have had positive reviews?</em> It also allows the LLM to tell you which patient and physician wrote reviews matching your question.</p>
<p>Lines 31 to 50 create the prompt template for your review chain the same way you did in <a href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#prompt-templates">Step 1</a>.</p>
<p>Lastly, lines 52 to 57 create your reviews vector chain using a Neo4j vector index retriever that returns 12 reviews embeddings from a similarity search. By setting <code>chain_type</code> to <code>"stuff"</code> in <code>.from_chain_type()</code>, you’re telling the chain to pass all 12 reviews to the prompt. You can explore other chain types in <a href="https://python.langchain.com/docs/modules/chains">LangChain’s documentation on chains</a>.</p>
<p>You’re ready to try out your new reviews chain. Navigate to the root directory of your project, start a Python interpreter, and run the following commands:</p>
<div class="codeblock mb-3 w-100" aria-label="Code block" data-syntax-language="pycon" data-is-repl="true">
  <div class="codeblock__header d-flex justify-content-between codeblock--blue">
    <span class="mr-2 noselect" aria-label="Language">Python</span>
    
    <div class="noselect">
      
        <span class="codeblock__output-toggle" title="Toggle prompts and output"><span class="icon baseline js-codeblock-output-on codeblock__header--icon-lower"><svg><use href="/static/icons.67f62bbffdec.svg#regular--rectangle-terminal"></use></svg></span></span>
      
    </div>
  </div>
  <div style="position: relative;">
    <div class="highlight highlight--with-header"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">dotenv</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dotenv</span><span class="o">.</span><span class="n">load_dotenv</span><span class="p">()</span>
<span class="go">True</span>

<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">chatbot_api.src.chains.hospital_review_chain</span> <span class="kn">import</span> <span class="p">(</span>
<span class="gp">... </span>    <span class="n">reviews_vector_chain</span>
<span class="gp">... </span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">query</span> <span class="o">=</span> <span class="s2">"""What have patients said about hospital efficiency?</span>
<span class="gp">... </span><span class="s2">        Mention details from specific reviews."""</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span> <span class="o">=</span> <span class="n">reviews_vector_chain</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"result"</span><span class="p">)</span>
<span class="go">"Patients have mentioned different aspects of hospital efficiency in their</span>
<span class="go">reviews. In Kevin Cox's review of Wallace-Hamilton hospital, he mentioned</span>
<span class="go">that the hospital staff was efficient. However, he also mentioned a lack of</span>
<span class="go">personalized attention and communication, which left him feeling neglected.</span>
<span class="go">This suggests that while the hospital may have been efficient in terms of</span>
<span class="go">completing tasks and providing services, they may have lacked in terms of</span>
<span class="go">individualized care and communication with patients.</span>
<span class="go">On the other hand, Beverly Johnson's review of Brown Inc. hospital mentioned</span>
<span class="go">that the hospital had a modern feel and the staff was attentive. However,</span>
<span class="go">she also mentioned that the bureaucratic procedures for check-in and</span>
<span class="go">discharge were cumbersome. This suggests that while the hospital may have</span>
<span class="go">been efficient in terms of its facilities and staff attentiveness, the</span>
<span class="go">administrative processes may have been inefficient and caused inconvenience</span>
<span class="go">for patients. It is important to note that the specific reviews do not</span>
<span class="go">provide a comprehensive picture of hospital efficiency, as they focus on</span>
<span class="go">specific aspects of the hospital experience."</span>
</code></pre></div>
    
    <button class="codeblock__copy btn btn-outline-secondary border m-1 px-1 d-hover-only" title="Copy to clipboard"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#@copy"></use></svg></span></button>
    <template class="codeblock__copied-template"></template>
    
  </div>
</div>
<p>In this block, you import <code>dotenv</code> and load environment variables from <code>.env</code>. You then import <code>reviews_vector_chain</code> from <code>hospital_review_chain</code> and invoke it with a question about hospital efficiency. Your chain’s response might not be identical to this, but the LLM should return a nice detailed summary, as you’ve told it to.</p>
<p>In this example, notice how specific patient and hospital names are mentioned in the response. This happens because you embedded hospital and patient names along with the review text, so the LLM can use this information to answer questions. </p>
<div class="alert alert-primary" role="alert">
<p><strong>Note</strong>: Before moving on, you should play around with <code>reviews_vector_chain</code> to see how it responds to different queries. Do the responses seem correct? How might you evaluate the quality of <code>reviews_vector_chain</code>? You won’t learn how to evaluate RAG systems in this tutorial, but you can look at this <a href="https://mlflow.org/docs/latest/llms/rag/notebooks/mlflow-e2e-evaluation.html">comprehensive Python example with MLFlow</a> to get a feel for how it’s done.</p>
</div>
<p>Next up, you’ll create the Cypher generation chain that you’ll use to answer queries about structured hospital system data.</p>
</section><section class="section3"><h3 id="create-a-neo4j-cypher-chain">Create a Neo4j Cypher Chain<a class="headerlink" href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#create-a-neo4j-cypher-chain" title="Permanent link"></a></h3>
<p>As you saw in <a href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#design-the-chatbot">Step 2</a>, your Neo4j Cypher chain will accept a user’s natural language query, convert the natural language query to a Cypher query, run the Cypher query in Neo4j, and use the Cypher query results to respond to the user’s query. You’ll leverage LangChain’s <a href="https://python.langchain.com/docs/use_cases/graph/graph_cypher_qa"><code>GraphCypherQAChain</code></a> for this.</p>
<div class="alert alert-primary" role="alert">
<p><strong>Note</strong>: Any time you allow users to query a database, as you’ll do with your Cypher chain, you need to ensure they only have necessary permissions. The Neo4j credentials you’re using in this project allow users to read, write, update, and delete data from your database.</p>
<p>If you were building this application for a real-world project, you’d want to create credentials that restrict your user’s permissions to reads only, preventing them from writing or deleting valuable data. </p>
</div>
<p>Using LLMs to generate accurate Cypher queries can be challenging, especially if you have a complicated graph. Because of this, a lot of prompt engineering is required to show your graph structure and query use-cases to the LLM. <a href="https://en.wikipedia.org/wiki/Fine-tuning_(deep_learning)">Fine-tuning</a> an LLM to generate queries is also an option, but this requires manually curated and labeled data.</p>
<p>To get started creating your Cypher generation chain, import dependencies and instantiate a <code>Neo4jGraph</code>:</p>
<div class="codeblock mb-3 w-100" aria-label="Code block" data-syntax-language="python">
  <div class="codeblock__header d-flex justify-content-between codeblock--blue">
    <span class="mr-2 noselect" aria-label="Language">Python</span>
    <span class="mr-2" aria-label="Filename"><code style="color: inherit;">chatbot_api/src/chains/hospital_cypher_chain.py</code></span>
    <div class="noselect">
      
    </div>
  </div>
  <div style="position: relative;">
    <div class="highlight highlight--with-header"><pre><span></span><code><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">langchain_community.graphs</span> <span class="kn">import</span> <span class="n">Neo4jGraph</span>
<span class="kn">from</span> <span class="nn">langchain.chains</span> <span class="kn">import</span> <span class="n">GraphCypherQAChain</span>
<span class="kn">from</span> <span class="nn">langchain_openai</span> <span class="kn">import</span> <span class="n">ChatOpenAI</span>
<span class="kn">from</span> <span class="nn">langchain.prompts</span> <span class="kn">import</span> <span class="n">PromptTemplate</span>

<span class="n">HOSPITAL_QA_MODEL</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">"HOSPITAL_QA_MODEL"</span><span class="p">)</span>
<span class="n">HOSPITAL_CYPHER_MODEL</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">"HOSPITAL_CYPHER_MODEL"</span><span class="p">)</span>

<span class="n">graph</span> <span class="o">=</span> <span class="n">Neo4jGraph</span><span class="p">(</span>
    <span class="n">url</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">"NEO4J_URI"</span><span class="p">),</span>
    <span class="n">username</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">"NEO4J_USERNAME"</span><span class="p">),</span>
    <span class="n">password</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">"NEO4J_PASSWORD"</span><span class="p">),</span>
<span class="p">)</span>

<span class="n">graph</span><span class="o">.</span><span class="n">refresh_schema</span><span class="p">()</span>
</code></pre></div>
    
    <button class="codeblock__copy btn btn-outline-secondary border m-1 px-1 d-hover-only" title="Copy to clipboard"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#@copy"></use></svg></span></button>
    <template class="codeblock__copied-template"></template>
    
  </div>
</div>
<p>The <code>Neo4jGraph</code> object is a LangChain wrapper that allows LLMs to execute queries on your Neo4j instance. You instantiate <code>graph</code> using your Neo4j credentials, and you call <code>graph.refresh_schema()</code> to sync any recent changes to your instance. </p>
<p>The next and most important component of your Cypher generation chain is the prompt template. Here’s what that looks like:</p>
<div class="codeblock mb-3 w-100" aria-label="Code block" data-syntax-language="python">
  <div class="codeblock__header d-flex justify-content-between codeblock--blue">
    <span class="mr-2 noselect" aria-label="Language">Python</span>
    <span class="mr-2" aria-label="Filename"><code style="color: inherit;">chatbot_api/src/chains/hospital_cypher_chain.py</code></span>
    <div class="noselect">
      
    </div>
  </div>
  <div style="position: relative;">
    <div class="highlight highlight--with-header"><pre><span></span><code><span class="c1"># ...</span>

<span class="n">cypher_generation_template</span> <span class="o">=</span> <span class="s2">"""</span>
<span class="s2">Task:</span>
<span class="s2">Generate Cypher query for a Neo4j graph database.</span>

<span class="s2">Instructions:</span>
<span class="s2">Use only the provided relationship types and properties in the schema.</span>
<span class="s2">Do not use any other relationship types or properties that are not provided.</span>

<span class="s2">Schema:</span>
<span class="si">{schema}</span>

<span class="s2">Note:</span>
<span class="s2">Do not include any explanations or apologies in your responses.</span>
<span class="s2">Do not respond to any questions that might ask anything other than</span>
<span class="s2">for you to construct a Cypher statement. Do not include any text except</span>
<span class="s2">the generated Cypher statement. Make sure the direction of the relationship is</span>
<span class="s2">correct in your queries. Make sure you alias both entities and relationships</span>
<span class="s2">properly. Do not run any queries that would add to or delete from</span>
<span class="s2">the database. Make sure to alias all statements that follow as with</span>
<span class="s2">statement (e.g. WITH v as visit, c.billing_amount as billing_amount)</span>
<span class="s2">If you need to divide numbers, make sure to</span>
<span class="s2">filter the denominator to be non zero.</span>

<span class="s2">Examples:</span>
<span class="s2"># Who is the oldest patient and how old are they?</span>
<span class="s2">MATCH (p:Patient)</span>
<span class="s2">RETURN p.name AS oldest_patient,</span>
<span class="s2">       duration.between(date(p.dob), date()).years AS age</span>
<span class="s2">ORDER BY age DESC</span>
<span class="s2">LIMIT 1</span>

<span class="s2"># Which physician has billed the least to Cigna</span>
<span class="s2">MATCH (p:Payer)&lt;-[c:COVERED_BY]-(v:Visit)-[t:TREATS]-(phy:Physician)</span>
<span class="s2">WHERE p.name = 'Cigna'</span>
<span class="s2">RETURN phy.name AS physician_name, SUM(c.billing_amount) AS total_billed</span>
<span class="s2">ORDER BY total_billed</span>
<span class="s2">LIMIT 1</span>

<span class="s2"># Which state had the largest percent increase in Cigna visits</span>
<span class="s2"># from 2022 to 2023?</span>
<span class="s2">MATCH (h:Hospital)&lt;-[:AT]-(v:Visit)-[:COVERED_BY]-&gt;(p:Payer)</span>
<span class="s2">WHERE p.name = 'Cigna' AND v.admission_date &gt;= '2022-01-01' AND</span>
<span class="s2">v.admission_date &lt; '2024-01-01'</span>
<span class="s2">WITH h.state_name AS state, COUNT(v) AS visit_count,</span>
<span class="s2">     SUM(CASE WHEN v.admission_date &gt;= '2022-01-01' AND</span>
<span class="s2">     v.admission_date &lt; '2023-01-01' THEN 1 ELSE 0 END) AS count_2022,</span>
<span class="s2">     SUM(CASE WHEN v.admission_date &gt;= '2023-01-01' AND</span>
<span class="s2">     v.admission_date &lt; '2024-01-01' THEN 1 ELSE 0 END) AS count_2023</span>
<span class="s2">WITH state, visit_count, count_2022, count_2023,</span>
<span class="s2">     (toFloat(count_2023) - toFloat(count_2022)) / toFloat(count_2022) * 100</span>
<span class="s2">     AS percent_increase</span>
<span class="s2">RETURN state, percent_increase</span>
<span class="s2">ORDER BY percent_increase DESC</span>
<span class="s2">LIMIT 1</span>

<span class="s2"># How many non-emergency patients in North Carolina have written reviews?</span>
<span class="s2">MATCH (r:Review)&lt;-[:WRITES]-(v:Visit)-[:AT]-&gt;(h:Hospital)</span>
<span class="s2">WHERE h.state_name = 'NC' and v.admission_type &lt;&gt; 'Emergency'</span>
<span class="s2">RETURN count(*)</span>

<span class="s2">String category values:</span>
<span class="s2">Test results are one of: 'Inconclusive', 'Normal', 'Abnormal'</span>
<span class="s2">Visit statuses are one of: 'OPEN', 'DISCHARGED'</span>
<span class="s2">Admission Types are one of: 'Elective', 'Emergency', 'Urgent'</span>
<span class="s2">Payer names are one of: 'Cigna', 'Blue Cross', 'UnitedHealthcare', 'Medicare',</span>
<span class="s2">'Aetna'</span>

<span class="s2">A visit is considered open if its status is 'OPEN' and the discharge date is</span>
<span class="s2">missing.</span>
<span class="s2">Use abbreviations when</span>
<span class="s2">filtering on hospital states (e.g. "Texas" is "TX",</span>
<span class="s2">"Colorado" is "CO", "North Carolina" is "NC",</span>
<span class="s2">"Florida" is "FL", "Georgia" is "GA", etc.)</span>

<span class="s2">Make sure to use IS NULL or IS NOT NULL when analyzing missing properties.</span>
<span class="s2">Never return embedding properties in your queries. You must never include the</span>
<span class="s2">statement "GROUP BY" in your query. Make sure to alias all statements that</span>
<span class="s2">follow as with statement (e.g. WITH v as visit, c.billing_amount as</span>
<span class="s2">billing_amount)</span>
<span class="s2">If you need to divide numbers, make sure to filter the denominator to be non</span>
<span class="s2">zero.</span>

<span class="s2">The question is:</span>
<span class="si">{question}</span>
<span class="s2">"""</span>

<span class="n">cypher_generation_prompt</span> <span class="o">=</span> <span class="n">PromptTemplate</span><span class="p">(</span>
    <span class="n">input_variables</span><span class="o">=</span><span class="p">[</span><span class="s2">"schema"</span><span class="p">,</span> <span class="s2">"question"</span><span class="p">],</span> <span class="n">template</span><span class="o">=</span><span class="n">cypher_generation_template</span>
<span class="p">)</span>
</code></pre></div>
    
    <button class="codeblock__copy btn btn-outline-secondary border m-1 px-1 d-hover-only" title="Copy to clipboard"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#@copy"></use></svg></span></button>
    <template class="codeblock__copied-template"></template>
    
  </div>
</div>
<p>Read the contents of <code>cypher_generation_template</code> carefully. Notice how you’re providing the LLM with very specific instructions on what it should and shouldn’t do when generating Cypher queries. Most importantly, you’re showing the LLM your graph’s structure with the <code>schema</code> parameter, some example queries, and the categorical values of a few node properties. </p>
<p>All of the detail you provide in your prompt template improves the LLM’s chance of generating a correct Cypher query for a given question. If you’re curious about how necessary all this detail is, try creating your own prompt template with as few details as possible. Then run questions through your Cypher chain and see whether it correctly generates Cypher queries.</p>
<p>From there, you can iteratively update your prompt template to correct for queries that the LLM struggles to generate, but make sure you’re also cognizant of the number of input tokens you’re using. As with your review chain, you’ll want a solid system for evaluating prompt templates and the correctness of your chain’s generated Cypher queries. However, as you’ll see, the template you have above is a great starting place.</p>
<div class="alert alert-primary" role="alert">
<p><strong>Note</strong>: The above prompt template provides the LLM with four examples of valid Cypher queries for your graph. Giving the LLM a few examples and then asking it to perform a task is known as <a href="https://realpython.com/practical-prompt-engineering/#start-engineering-your-prompts">few-shot prompting</a>, and it’s a simple yet powerful technique for improving generation accuracy. </p>
<p>However, few-shot prompting might not be sufficient for Cypher query generation, especially if you have a complicated graph. One way to improve this is to create a vector database that embeds example user questions/queries and stores their corresponding Cypher queries as metadata. </p>
<p>When a user asks a question, you inject Cypher queries from semantically similar questions into the prompt, providing the LLM with the most relevant examples needed to answer the current question.</p>
</div>
<p>Next, you define the prompt template for the question-answer component of your chain. This template tells the LLM to use the Cypher query results to generate a nicely-formatted answer to the user’s query:</p>
<div class="codeblock mb-3 w-100" aria-label="Code block" data-syntax-language="python">
  <div class="codeblock__header d-flex justify-content-between codeblock--blue">
    <span class="mr-2 noselect" aria-label="Language">Python</span>
    <span class="mr-2" aria-label="Filename"><code style="color: inherit;">chatbot_api/src/chains/hospital_cypher_chain.py</code></span>
    <div class="noselect">
      
    </div>
  </div>
  <div style="position: relative;">
    <div class="highlight highlight--with-header"><pre><span></span><code><span class="c1"># ...</span>

<span class="n">qa_generation_template</span> <span class="o">=</span> <span class="s2">"""You are an assistant that takes the results</span>
<span class="s2">from a Neo4j Cypher query and forms a human-readable response. The</span>
<span class="s2">query results section contains the results of a Cypher query that was</span>
<span class="s2">generated based on a user's natural language question. The provided</span>
<span class="s2">information is authoritative, you must never doubt it or try to use</span>
<span class="s2">your internal knowledge to correct it. Make the answer sound like a</span>
<span class="s2">response to the question.</span>

<span class="s2">Query Results:</span>
<span class="si">{context}</span>

<span class="s2">Question:</span>
<span class="si">{question}</span>

<span class="s2">If the provided information is empty, say you don't know the answer.</span>
<span class="s2">Empty information looks like this: []</span>

<span class="s2">If the information is not empty, you must provide an answer using the</span>
<span class="s2">results. If the question involves a time duration, assume the query</span>
<span class="s2">results are in units of days unless otherwise specified.</span>

<span class="s2">When names are provided in the query results, such as hospital names,</span>
<span class="s2">beware  of any names that have commas or other punctuation in them.</span>
<span class="s2">For instance, 'Jones, Brown and Murray' is a single hospital name,</span>
<span class="s2">not multiple hospitals. Make sure you return any list of names in</span>
<span class="s2">a way that isn't ambiguous and allows someone to tell what the full</span>
<span class="s2">names are.</span>

<span class="s2">Never say you don't have the right information if there is data in</span>
<span class="s2">the query results. Always use the data in the query results.</span>

<span class="s2">Helpful Answer:</span>
<span class="s2">"""</span>

<span class="n">qa_generation_prompt</span> <span class="o">=</span> <span class="n">PromptTemplate</span><span class="p">(</span>
    <span class="n">input_variables</span><span class="o">=</span><span class="p">[</span><span class="s2">"context"</span><span class="p">,</span> <span class="s2">"question"</span><span class="p">],</span> <span class="n">template</span><span class="o">=</span><span class="n">qa_generation_template</span>
<span class="p">)</span>
</code></pre></div>
    
    <button class="codeblock__copy btn btn-outline-secondary border m-1 px-1 d-hover-only" title="Copy to clipboard"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#@copy"></use></svg></span></button>
    <template class="codeblock__copied-template"></template>
    
  </div>
</div>
<p>This template requires much less detail than your Cypher generation template, and you should only have to modify it if you want the LLM to respond differently, or if you’re noticing that it’s not using the query results how you want. The last step in creating your Cypher chain is to instantiate a <code>GraphCypherQAChain</code> object:</p>
<div class="codeblock mb-3 w-100" aria-label="Code block" data-syntax-language="python">
  <div class="codeblock__header d-flex justify-content-between codeblock--blue">
    <span class="mr-2 noselect" aria-label="Language">Python</span>
    <span class="mr-2" aria-label="Filename"><code style="color: inherit;">chatbot_api/src/chains/hospital_cypher_chain.py</code></span>
    <div class="noselect">
      
    </div>
  </div>
  <div style="position: relative;">
    <div class="highlight highlight--with-header"><pre><span></span><code><span class="c1"># ...</span>

<span class="n">hospital_cypher_chain</span> <span class="o">=</span> <span class="n">GraphCypherQAChain</span><span class="o">.</span><span class="n">from_llm</span><span class="p">(</span>
    <span class="n">cypher_llm</span><span class="o">=</span><span class="n">ChatOpenAI</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">HOSPITAL_CYPHER_MODEL</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
    <span class="n">qa_llm</span><span class="o">=</span><span class="n">ChatOpenAI</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">HOSPITAL_QA_MODEL</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
    <span class="n">graph</span><span class="o">=</span><span class="n">graph</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">qa_prompt</span><span class="o">=</span><span class="n">qa_generation_prompt</span><span class="p">,</span>
    <span class="n">cypher_prompt</span><span class="o">=</span><span class="n">cypher_generation_prompt</span><span class="p">,</span>
    <span class="n">validate_cypher</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">top_k</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>
    
    <button class="codeblock__copy btn btn-outline-secondary border m-1 px-1 d-hover-only" title="Copy to clipboard"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#@copy"></use></svg></span></button>
    <template class="codeblock__copied-template"></template>
    
  </div>
</div>
<p>Here’s a breakdown of the parameters used in <code>GraphCypherQAChain.from_llm()</code>:</p>
<ul>
<li><code>cypher_llm</code>: The LLM used to generate Cypher queries.</li>
<li><code>qa_llm</code>: The LLM used to generate an answer given Cypher query results.</li>
<li><code>graph</code>: The <code>Neo4jGraph</code> object that connects to your Neo4j instance.</li>
<li><code>verbose</code>: Whether intermediate steps your chain performs should be printed.</li>
<li><code>qa_prompt</code>: The prompt template for responding to questions/queries.</li>
<li><code>cypher_prompt</code>: The prompt template for generating Cypher queries.</li>
<li><code>validate_cypher</code>: If true, the Cypher query will be inspected for errors and corrected before running. Note that this doesn’t guarantee the Cypher query will be valid. Instead, it corrects simple syntax errors that are easily detectable using <a href="https://realpython.com/regex-python/">regular expressions</a>.</li>
<li><code>top_k</code>: The number of query results to include in <code>qa_prompt</code>.</li>
</ul>
<p>Your hospital system Cypher generation chain is ready to use! It works the same way as your reviews chain. Navigate to your project directory and start a new Python interpreter session, then give it a try:</p>
<div class="codeblock mb-3 w-100" aria-label="Code block" data-syntax-language="pycon" data-is-repl="true">
  <div class="codeblock__header d-flex justify-content-between codeblock--blue">
    <span class="mr-2 noselect" aria-label="Language">Python</span>
    
    <div class="noselect">
      
        <span class="codeblock__output-toggle" title="Toggle prompts and output"><span class="icon baseline js-codeblock-output-on codeblock__header--icon-lower"><svg><use href="/static/icons.67f62bbffdec.svg#regular--rectangle-terminal"></use></svg></span></span>
      
    </div>
  </div>
  <div style="position: relative;">
    <div class="highlight highlight--with-header"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">dotenv</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dotenv</span><span class="o">.</span><span class="n">load_dotenv</span><span class="p">()</span>
<span class="go">True</span>

<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">chatbot_api.src.chains.hospital_cypher_chain</span> <span class="kn">import</span> <span class="p">(</span>
<span class="gp">... </span><span class="n">hospital_cypher_chain</span>
<span class="gp">... </span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">question</span> <span class="o">=</span> <span class="s2">"""What is the average visit duration for</span>
<span class="gp">... </span><span class="s2">emergency visits in North Carolina?"""</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span> <span class="o">=</span> <span class="n">hospital_cypher_chain</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">question</span><span class="p">)</span>


<span class="go">&gt; Entering new GraphCypherQAChain chain...</span>
<span class="go">Generated Cypher:</span>
<span class="go">MATCH (v:Visit)-[:AT]-&gt;(h:Hospital)</span>
<span class="go">WHERE h.state_name = 'NC' AND v.admission_type = 'Emergency'</span>
<span class="go">AND v.status = 'DISCHARGED'</span>
<span class="go">WITH v, duration.between(date(v.admission_date),</span>
<span class="go">date(v.discharge_date)).days AS visit_duration</span>
<span class="go">RETURN AVG(visit_duration) AS average_visit_duration</span>
<span class="go">Full Context:</span>
<span class="go">[{'average_visit_duration': 15.072972972972991}]</span>

<span class="go">&gt; Finished chain.</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"result"</span><span class="p">)</span>
<span class="go">'The average visit duration for emergency visits in North</span>
<span class="go">Carolina is 15.07 days.'</span>
</code></pre></div>
    
    <button class="codeblock__copy btn btn-outline-secondary border m-1 px-1 d-hover-only" title="Copy to clipboard"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#@copy"></use></svg></span></button>
    <template class="codeblock__copied-template"></template>
    
  </div>
</div>
<p>After loading environment variables, importing <code>hospital_cypher_chain</code>, and invoking it with a question, you can see the steps your chain takes to answer the question. Take a second to appreciate a few accomplishments your chain made when generating the Cypher query:</p>
<ul>
<li>The Cypher generation LLM understood the relationship between visits and hospitals from the provided graph schema.</li>
<li>Even though you asked it about <strong>North Carolina</strong>, the LLM knew from the prompt to use the state abbreviation <strong>NC</strong>.</li>
<li>The LLM knew that <strong>admission_type</strong> properties only have the first letter capitalized, while the <strong>status</strong> properties are all caps. </li>
<li>The QA generation LLM knew from your prompt that the query results were in units of days.</li>
</ul>
<p>You can experiment with all kinds of queries about the hospital system. For example, here’s a relatively challenging question to convert to Cypher:</p>
<div class="codeblock mb-3 w-100" aria-label="Code block" data-syntax-language="pycon" data-is-repl="true">
  <div class="codeblock__header d-flex justify-content-between codeblock--blue">
    <span class="mr-2 noselect" aria-label="Language">Python</span>
    
    <div class="noselect">
      
        <span class="codeblock__output-toggle" title="Toggle prompts and output"><span class="icon baseline js-codeblock-output-on codeblock__header--icon-lower"><svg><use href="/static/icons.67f62bbffdec.svg#regular--rectangle-terminal"></use></svg></span></span>
      
    </div>
  </div>
  <div style="position: relative;">
    <div class="highlight highlight--with-header"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">question</span> <span class="o">=</span> <span class="s2">"""Which state had the largest percent increase</span>
<span class="gp">... </span><span class="s2">           in Medicaid visits from 2022 to 2023?"""</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span> <span class="o">=</span> <span class="n">hospital_cypher_chain</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">question</span><span class="p">)</span>


<span class="go">&gt; Entering new GraphCypherQAChain chain...</span>
<span class="go">Generated Cypher:</span>
<span class="go">MATCH (h:Hospital)&lt;-[:AT]-(v:Visit)-[:COVERED_BY]-&gt;(p:Payer)</span>
<span class="go">WHERE p.name = 'Medicaid' AND v.admission_date &gt;= '2022-01-01'</span>
<span class="go">AND v.admission_date &lt; '2024-01-01'</span>
<span class="go">WITH h.state_name AS state, COUNT(v) AS visit_count,</span>
<span class="go">     SUM(CASE WHEN v.admission_date &gt;= '2022-01-01'</span>
<span class="go">     AND v.admission_date &lt; '2023-01-01' THEN 1 ELSE 0 END) AS count_2022,</span>
<span class="go">     SUM(CASE WHEN v.admission_date &gt;= '2023-01-01'</span>
<span class="go">     AND v.admission_date &lt; '2024-01-01' THEN 1 ELSE 0 END) AS count_2023</span>
<span class="go">WITH state, visit_count, count_2022, count_2023,</span>
<span class="go">     (toFloat(count_2023) - toFloat(count_2022)) / toFloat(count_2022) * 100</span>
<span class="go">     AS percent_increase</span>
<span class="go">RETURN state, percent_increase</span>
<span class="go">ORDER BY percent_increase DESC</span>
<span class="go">LIMIT 1</span>
<span class="go">Full Context:</span>
<span class="go">[{'state': 'TX', 'percent_increase': 8.823529411764707}]</span>

<span class="go">&gt; Finished chain.</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"result"</span><span class="p">)</span>
<span class="go">'The state with the largest percent increase in Medicaid visits</span>
<span class="go">from 2022 to 2023 is Texas (TX), with a percent increase of 8.82%.'</span>
</code></pre></div>
    
    <button class="codeblock__copy btn btn-outline-secondary border m-1 px-1 d-hover-only" title="Copy to clipboard"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#@copy"></use></svg></span></button>
    <template class="codeblock__copied-template"></template>
    
  </div>
</div>
<p>To answer the question <em>Which state had the largest percent increase in Medicaid visits from 2022 to 2023?</em>, the LLM had to generate a fairly verbose Cypher query involving multiple nodes, relationships, and filters. Nonetheless, it was able to arrive at the correct answer.</p>
<p>The last capability your chatbot needs is to answer questions about wait times, and that’s what you’ll cover next.</p>
</section><section class="section3"><h3 id="create-wait-time-functions">Create Wait Time Functions<a class="headerlink" href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#create-wait-time-functions" title="Permanent link"></a></h3>
<p>This last capability your chatbot needs is to answer questions about hospital wait times. As discussed earlier, your organization doesn’t store wait time data anywhere, so your chatbot will have to fetch it from an external source. You’ll write two functions for this—one that simulates finding the current wait time at a hospital, and another that finds the hospital with the shortest wait time.</p>
<div class="alert alert-primary" role="alert">
<p><strong>Note</strong>: The purpose of creating wait time functions is to show you that LangChain agents can run arbitrary Python code, not just chains or other LangChain methods. This capability is extremely valuable because it means, in theory, you could create an agent to do just about anything that can be expressed in code.</p>
</div>
<p>Start by defining functions to fetch current wait times at a hospital:</p>
<div class="codeblock mb-3 w-100" aria-label="Code block" data-syntax-language="python">
  <div class="codeblock__header d-flex justify-content-between codeblock--blue">
    <span class="mr-2 noselect" aria-label="Language">Python</span>
    <span class="mr-2" aria-label="Filename"><code style="color: inherit;">chatbot_api/src/tools/wait_times.py</code></span>
    <div class="noselect">
      
    </div>
  </div>
  <div style="position: relative;">
    <div class="highlight highlight--with-header"><pre><span></span><code><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">langchain_community.graphs</span> <span class="kn">import</span> <span class="n">Neo4jGraph</span>

<span class="k">def</span> <span class="nf">_get_current_hospitals</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">"""Fetch a list of current hospital names from a Neo4j database."""</span>
    <span class="n">graph</span> <span class="o">=</span> <span class="n">Neo4jGraph</span><span class="p">(</span>
        <span class="n">url</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">"NEO4J_URI"</span><span class="p">),</span>
        <span class="n">username</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">"NEO4J_USERNAME"</span><span class="p">),</span>
        <span class="n">password</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">"NEO4J_PASSWORD"</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">current_hospitals</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        MATCH (h:Hospital)</span>
<span class="sd">        RETURN h.name AS hospital_name</span>
<span class="sd">        """</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s2">"hospital_name"</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">current_hospitals</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">_get_current_wait_time_minutes</span><span class="p">(</span><span class="n">hospital</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Get the current wait time at a hospital in minutes."""</span>
    <span class="n">current_hospitals</span> <span class="o">=</span> <span class="n">_get_current_hospitals</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">hospital</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">current_hospitals</span><span class="p">:</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">get_current_wait_times</span><span class="p">(</span><span class="n">hospital</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Get the current wait time at a hospital formatted as a string."""</span>
    <span class="n">wait_time_in_minutes</span> <span class="o">=</span> <span class="n">_get_current_wait_time_minutes</span><span class="p">(</span><span class="n">hospital</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">wait_time_in_minutes</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">"Hospital '</span><span class="si">{</span><span class="n">hospital</span><span class="si">}</span><span class="s2">' does not exist."</span>

    <span class="n">hours</span><span class="p">,</span> <span class="n">minutes</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">wait_time_in_minutes</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">hours</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">hours</span><span class="si">}</span><span class="s2"> hours </span><span class="si">{</span><span class="n">minutes</span><span class="si">}</span><span class="s2"> minutes"</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">minutes</span><span class="si">}</span><span class="s2"> minutes"</span>
</code></pre></div>
    
    <button class="codeblock__copy btn btn-outline-secondary border m-1 px-1 d-hover-only" title="Copy to clipboard"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#@copy"></use></svg></span></button>
    <template class="codeblock__copied-template"></template>
    
  </div>
</div>
<p>The first function you define is <code>_get_current_hospitals()</code> which returns a list of hospital names from your Neo4j database. Then, <code>_get_current_wait_time_minutes()</code> takes a hospital name as input. If the hospital name is invalid, <code>_get_current_wait_time_minutes()</code> returns -1. If the hospital name is valid, <code>_get_current_wait_time_minutes()</code> returns a random integer between 0 and 600 simulating a wait time in minutes.</p>
<p>You then define <code>get_current_wait_times()</code> which is a wrapper around <code>_get_current_wait_time_minutes()</code> that returns the wait time formatted as a string. </p>
<p>You can use <code>_get_current_wait_time_minutes()</code> to define a second function that finds the hospital with the shortest wait time:</p>
<div class="codeblock mb-3 w-100" aria-label="Code block" data-syntax-language="python">
  <div class="codeblock__header d-flex justify-content-between codeblock--blue">
    <span class="mr-2 noselect" aria-label="Language">Python</span>
    <span class="mr-2" aria-label="Filename"><code style="color: inherit;">chatbot_api/src/tools/wait_times.py</code></span>
    <div class="noselect">
      
    </div>
  </div>
  <div style="position: relative;">
    <div class="highlight highlight--with-header"><pre><span></span><code><span class="c1"># ...</span>

<span class="k">def</span> <span class="nf">get_most_available_hospital</span><span class="p">(</span><span class="n">_</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">"""Find the hospital with the shortest wait time."""</span>
    <span class="n">current_hospitals</span> <span class="o">=</span> <span class="n">_get_current_hospitals</span><span class="p">()</span>

    <span class="n">current_wait_times</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">_get_current_wait_time_minutes</span><span class="p">(</span><span class="n">h</span><span class="p">)</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">current_hospitals</span>
    <span class="p">]</span>

    <span class="n">best_time_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">current_wait_times</span><span class="p">)</span>
    <span class="n">best_hospital</span> <span class="o">=</span> <span class="n">current_hospitals</span><span class="p">[</span><span class="n">best_time_idx</span><span class="p">]</span>
    <span class="n">best_wait_time</span> <span class="o">=</span> <span class="n">current_wait_times</span><span class="p">[</span><span class="n">best_time_idx</span><span class="p">]</span>

    <span class="k">return</span> <span class="p">{</span><span class="n">best_hospital</span><span class="p">:</span> <span class="n">best_wait_time</span><span class="p">}</span>
</code></pre></div>
    
    <button class="codeblock__copy btn btn-outline-secondary border m-1 px-1 d-hover-only" title="Copy to clipboard"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#@copy"></use></svg></span></button>
    <template class="codeblock__copied-template"></template>
    
  </div>
</div>
<p>Here, you define <code>get_most_available_hospital()</code> which calls <code>_get_current_wait_time_minutes()</code> on each hospital and returns the hospital with the shortest wait time. Notice how <code>get_most_available_hospital()</code> has a <a href="https://realpython.com/python-double-underscore/#public-interfaces-and-naming-conventions-in-python">throwaway input</a> <code>_</code>. This will be required later on by your agent because it’s designed to pass inputs into functions.</p>
<p>Here’s how you use <code>get_current_wait_times()</code> and <code>get_most_available_hospital()</code>:</p>
<div class="codeblock mb-3 w-100" aria-label="Code block" data-syntax-language="pycon" data-is-repl="true">
  <div class="codeblock__header d-flex justify-content-between codeblock--blue">
    <span class="mr-2 noselect" aria-label="Language">Python</span>
    
    <div class="noselect">
      
        <span class="codeblock__output-toggle" title="Toggle prompts and output"><span class="icon baseline js-codeblock-output-on codeblock__header--icon-lower"><svg><use href="/static/icons.67f62bbffdec.svg#regular--rectangle-terminal"></use></svg></span></span>
      
    </div>
  </div>
  <div style="position: relative;">
    <div class="highlight highlight--with-header"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">dotenv</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dotenv</span><span class="o">.</span><span class="n">load_dotenv</span><span class="p">()</span>
<span class="go">True</span>

<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">chatbot_api.src.tools.wait_times</span> <span class="kn">import</span> <span class="p">(</span>
<span class="gp">... </span>    <span class="n">get_current_wait_times</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">get_most_available_hospital</span><span class="p">,</span>
<span class="gp">... </span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">get_current_wait_times</span><span class="p">(</span><span class="s2">"Wallace-Hamilton"</span><span class="p">)</span>
<span class="go">'1 hours 35 minutes'</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">get_current_wait_times</span><span class="p">(</span><span class="s2">"fake hospital"</span><span class="p">)</span>
<span class="go">"Hospital 'fake hospital' does not exist."</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">get_most_available_hospital</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
<span class="go">{'cunningham and sons': 24}</span>
</code></pre></div>
    
    <button class="codeblock__copy btn btn-outline-secondary border m-1 px-1 d-hover-only" title="Copy to clipboard"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#@copy"></use></svg></span></button>
    <template class="codeblock__copied-template"></template>
    
  </div>
</div>
<p>After loading environment variables, you call <code>get_current_wait_times("Wallace-Hamilton")</code> which returns the current wait time in minutes at <strong>Wallace-Hamilton</strong> hospital. When you try <code>get_current_wait_times("fake hospital")</code>, you get a string telling you <strong>fake hospital</strong> does not exist in the database.</p>
<p>Lastly, <code>get_most_available_hospital()</code> returns a dictionary storing the wait time for the hospital with the shortest wait time in minutes. Next, you’ll create an agent that uses these functions, along with the Cypher and review chain, to answer arbitrary questions about the hospital system.</p>
</section><section class="section3"><h3 id="create-the-chatbot-agent">Create the Chatbot Agent<a class="headerlink" href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#create-the-chatbot-agent" title="Permanent link"></a></h3>
<p>Give yourself a pat on the back if you’ve made it this far. You’ve covered a lot of information, and you’re finally ready to piece it all together and assemble the agent that will serve as your chatbot. Depending on the query you give it, your agent needs to decide between your Cypher chain, reviews chain, and wait times functions.</p>
<p>Start by loading your agent’s dependencies, reading in the agent model name from an environment variable, and loading a prompt template from <a href="https://smith.langchain.com/hub">LangChain Hub</a>:</p>
<div class="codeblock mb-3 w-100" aria-label="Code block" data-syntax-language="python">
  <div class="codeblock__header d-flex justify-content-between codeblock--blue">
    <span class="mr-2 noselect" aria-label="Language">Python</span>
    <span class="mr-2" aria-label="Filename"><code style="color: inherit;">chatbot_api/src/agents/hospital_rag_agent.py</code></span>
    <div class="noselect">
      
    </div>
  </div>
  <div style="position: relative;">
    <div class="highlight highlight--with-header"><pre><span></span><code><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">langchain_openai</span> <span class="kn">import</span> <span class="n">ChatOpenAI</span>
<span class="kn">from</span> <span class="nn">langchain.agents</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">create_openai_functions_agent</span><span class="p">,</span>
    <span class="n">Tool</span><span class="p">,</span>
    <span class="n">AgentExecutor</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">langchain</span> <span class="kn">import</span> <span class="n">hub</span>
<span class="kn">from</span> <span class="nn">chains.hospital_review_chain</span> <span class="kn">import</span> <span class="n">reviews_vector_chain</span>
<span class="kn">from</span> <span class="nn">chains.hospital_cypher_chain</span> <span class="kn">import</span> <span class="n">hospital_cypher_chain</span>
<span class="kn">from</span> <span class="nn">tools.wait_times</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">get_current_wait_times</span><span class="p">,</span>
    <span class="n">get_most_available_hospital</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">HOSPITAL_AGENT_MODEL</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">"HOSPITAL_AGENT_MODEL"</span><span class="p">)</span>

<span class="n">hospital_agent_prompt</span> <span class="o">=</span> <span class="n">hub</span><span class="o">.</span><span class="n">pull</span><span class="p">(</span><span class="s2">"hwchase17/openai-functions-agent"</span><span class="p">)</span>
</code></pre></div>
    
    <button class="codeblock__copy btn btn-outline-secondary border m-1 px-1 d-hover-only" title="Copy to clipboard"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#@copy"></use></svg></span></button>
    <template class="codeblock__copied-template"></template>
    
  </div>
</div>
<p>Notice how you’re importing <code>reviews_vector_chain</code>, <code>hospital_cypher_chain</code>, <code>get_current_wait_times()</code>, and <code>get_most_available_hospital()</code>. Your agent will directly use these as tools. <code>HOSPITAL_AGENT_MODEL</code> is the LLM that will act as your agent’s brain, deciding which tools to call and what inputs to pass them. </p>
<p>Instead of defining your own prompt for the agent, which you can certainly do, you load a predefined prompt from LangChain Hub. LangChain hub lets you upload, browse, pull, test, and manage prompts. In this case, the default prompt for OpenAI function agents works great.</p>
<p>Next, you define a list of tools your agent can use:</p>
<div class="codeblock mb-3 w-100" aria-label="Code block" data-syntax-language="python">
  <div class="codeblock__header d-flex justify-content-between codeblock--blue">
    <span class="mr-2 noselect" aria-label="Language">Python</span>
    <span class="mr-2" aria-label="Filename"><code style="color: inherit;">chatbot_api/src/agents/hospital_rag_agent.py</code></span>
    <div class="noselect">
      
    </div>
  </div>
  <div style="position: relative;">
    <div class="highlight highlight--with-header"><pre><span></span><code><span class="c1"># ...</span>

<span class="n">tools</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">Tool</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">"Experiences"</span><span class="p">,</span>
        <span class="n">func</span><span class="o">=</span><span class="n">reviews_vector_chain</span><span class="o">.</span><span class="n">invoke</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">"""Useful when you need to answer questions</span>
<span class="s2">        about patient experiences, feelings, or any other qualitative</span>
<span class="s2">        question that could be answered about a patient using semantic</span>
<span class="s2">        search. Not useful for answering objective questions that involve</span>
<span class="s2">        counting, percentages, aggregations, or listing facts. Use the</span>
<span class="s2">        entire prompt as input to the tool. For instance, if the prompt is</span>
<span class="s2">        "Are patients satisfied with their care?", the input should be</span>
<span class="s2">        "Are patients satisfied with their care?".</span>
<span class="s2">        """</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">Tool</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">"Graph"</span><span class="p">,</span>
        <span class="n">func</span><span class="o">=</span><span class="n">hospital_cypher_chain</span><span class="o">.</span><span class="n">invoke</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">"""Useful for answering questions about patients,</span>
<span class="s2">        physicians, hospitals, insurance payers, patient review</span>
<span class="s2">        statistics, and hospital visit details. Use the entire prompt as</span>
<span class="s2">        input to the tool. For instance, if the prompt is "How many visits</span>
<span class="s2">        have there been?", the input should be "How many visits have</span>
<span class="s2">        there been?".</span>
<span class="s2">        """</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">Tool</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">"Waits"</span><span class="p">,</span>
        <span class="n">func</span><span class="o">=</span><span class="n">get_current_wait_times</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">"""Use when asked about current wait times</span>
<span class="s2">        at a specific hospital. This tool can only get the current</span>
<span class="s2">        wait time at a hospital and does not have any information about</span>
<span class="s2">        aggregate or historical wait times. Do not pass the word "hospital"</span>
<span class="s2">        as input, only the hospital name itself. For example, if the prompt</span>
<span class="s2">        is "What is the current wait time at Jordan Inc Hospital?", the</span>
<span class="s2">        input should be "Jordan Inc".</span>
<span class="s2">        """</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">Tool</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">"Availability"</span><span class="p">,</span>
        <span class="n">func</span><span class="o">=</span><span class="n">get_most_available_hospital</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">"""</span>
<span class="s2">        Use when you need to find out which hospital has the shortest</span>
<span class="s2">        wait time. This tool does not have any information about aggregate</span>
<span class="s2">        or historical wait times. This tool returns a dictionary with the</span>
<span class="s2">        hospital name as the key and the wait time in minutes as the value.</span>
<span class="s2">        """</span><span class="p">,</span>
    <span class="p">),</span>
<span class="p">]</span>
</code></pre></div>
    
    <button class="codeblock__copy btn btn-outline-secondary border m-1 px-1 d-hover-only" title="Copy to clipboard"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#@copy"></use></svg></span></button>
    <template class="codeblock__copied-template"></template>
    
  </div>
</div>
<p>Your agent has four tools available to it: <strong>Experiences</strong>, <strong>Graph</strong>, <strong>Waits</strong>, and <strong>Availability</strong>. The <strong>Experiences</strong> and <strong>Graph</strong> tools call <code>.invoke()</code> from their respective chains, while <strong>Waits</strong> and <strong>Availability</strong> call the wait time functions you defined. Notice that many of the tool descriptions have few-shot prompts, telling the agent when it should use the tool and providing it with an example of what inputs to pass.</p>
<p>As with chains, good prompt engineering is crucial for your agent’s success. You have to clearly describe each tool and how to use it so that your agent isn’t confused by a query.</p>
<p>The last step is to instantiate you agent:</p>
<div class="codeblock mb-3 w-100" aria-label="Code block" data-syntax-language="python">
  <div class="codeblock__header d-flex justify-content-between codeblock--blue">
    <span class="mr-2 noselect" aria-label="Language">Python</span>
    <span class="mr-2" aria-label="Filename"><code style="color: inherit;">chatbot_api/src/agents/hospital_rag_agent.py</code></span>
    <div class="noselect">
      
    </div>
  </div>
  <div style="position: relative;">
    <div class="highlight highlight--with-header"><pre><span></span><code><span class="c1"># ...</span>

<span class="n">chat_model</span> <span class="o">=</span> <span class="n">ChatOpenAI</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">HOSPITAL_AGENT_MODEL</span><span class="p">,</span>
    <span class="n">temperature</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">hospital_rag_agent</span> <span class="o">=</span> <span class="n">create_openai_functions_agent</span><span class="p">(</span>
    <span class="n">llm</span><span class="o">=</span><span class="n">chat_model</span><span class="p">,</span>
    <span class="n">prompt</span><span class="o">=</span><span class="n">hospital_agent_prompt</span><span class="p">,</span>
    <span class="n">tools</span><span class="o">=</span><span class="n">tools</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">hospital_rag_agent_executor</span> <span class="o">=</span> <span class="n">AgentExecutor</span><span class="p">(</span>
    <span class="n">agent</span><span class="o">=</span><span class="n">hospital_rag_agent</span><span class="p">,</span>
    <span class="n">tools</span><span class="o">=</span><span class="n">tools</span><span class="p">,</span>
    <span class="n">return_intermediate_steps</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>
    
    <button class="codeblock__copy btn btn-outline-secondary border m-1 px-1 d-hover-only" title="Copy to clipboard"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#@copy"></use></svg></span></button>
    <template class="codeblock__copied-template"></template>
    
  </div>
</div>
<p>You first initialize a <code>ChatOpenAI</code> object using <code>HOSPITAL_AGENT_MODEL</code> as the LLM. You then create an OpenAI functions agent with <code>create_openai_functions_agent()</code>. This creates an agent that’s been designed by OpenAI to pass inputs to functions. It does this by returning JSON objects that store function inputs and their corresponding value.</p>
<p>To create the agent run time, you pass your agent and tools into <a href="https://python.langchain.com/docs/modules/agents/concepts#agentexecutor"><code>AgentExecutor</code></a>. Setting <code>return_intermediate_steps</code> and <code>verbose</code> to true allows you to see the agent’s thought process and the tools it calls. </p>
<p>With that, you’ve completed building the hospital system agent. To try it out, you’ll have to navigate into the <code>chatbot_api/src/</code> folder and start a new REPL session from there.</p>
<div class="alert alert-primary" role="alert">
<p><strong>Note:</strong> This is necessary because you set up relative imports in <code>hospital_rag_agent.py</code> that’ll later run within a Docker container. For now it means that you’ll have to start your Python interpreter only after navigating into <code>chatbot_api/src/</code> for the imports to work.</p>
</div>
<p>You can now try out your hospital system agent on your command line:</p>
<div class="codeblock mb-3 w-100" aria-label="Code block" data-syntax-language="pycon" data-is-repl="true">
  <div class="codeblock__header d-flex justify-content-between codeblock--blue">
    <span class="mr-2 noselect" aria-label="Language">Python</span>
    
    <div class="noselect">
      
        <span class="codeblock__output-toggle" title="Toggle prompts and output"><span class="icon baseline js-codeblock-output-on codeblock__header--icon-lower"><svg><use href="/static/icons.67f62bbffdec.svg#regular--rectangle-terminal"></use></svg></span></span>
      
    </div>
  </div>
  <div style="position: relative;">
    <div class="highlight highlight--with-header"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">dotenv</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dotenv</span><span class="o">.</span><span class="n">load_dotenv</span><span class="p">()</span>
<span class="go">True</span>

<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">agents.hospital_rag_agent</span> <span class="kn">import</span> <span class="n">hospital_rag_agent_executor</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span> <span class="o">=</span> <span class="n">hospital_rag_agent_executor</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span>
<span class="gp">... </span>    <span class="p">{</span><span class="s2">"input"</span><span class="p">:</span> <span class="s2">"What is the wait time at Wallace-Hamilton?"</span><span class="p">}</span>
<span class="gp">... </span><span class="p">)</span>

<span class="go">&gt; Entering new AgentExecutor chain...</span>

<span class="go">Invoking: `Waits` with `Wallace-Hamilton`</span>

<span class="go">54The current wait time at Wallace-Hamilton is 54 minutes.</span>

<span class="go">&gt; Finished chain.</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"output"</span><span class="p">)</span>
<span class="go">'The current wait time at Wallace-Hamilton is 54 minutes.'</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span> <span class="o">=</span> <span class="n">hospital_rag_agent_executor</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span>
<span class="gp">... </span>    <span class="p">{</span><span class="s2">"input"</span><span class="p">:</span> <span class="s2">"Which hospital has the shortest wait time?"</span><span class="p">}</span>
<span class="gp">... </span><span class="p">)</span>

<span class="go">&gt; Entering new AgentExecutor chain...</span>

<span class="go">Invoking: `Availability` with `shortest wait time`</span>

<span class="go">{'smith, edwards and obrien': 2}The hospital with the shortest</span>
<span class="go">wait time is Smith, Edwards and O'Brien, with a wait time of 2 minutes.</span>

<span class="go">&gt; Finished chain.</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"output"</span><span class="p">)</span>
<span class="go">"The hospital with the shortest wait time is Smith, Edwards</span>
<span class="go">and O'Brien, with a wait time of 2 minutes."</span>
</code></pre></div>
    
    <button class="codeblock__copy btn btn-outline-secondary border m-1 px-1 d-hover-only" title="Copy to clipboard"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#@copy"></use></svg></span></button>
    <template class="codeblock__copied-template"></template>
    
  </div>
</div>
<p>After loading environment variables, you ask the agent about wait times. You can see exactly what it’s doing in response to each of your queries. For instance, when you ask <em>“What is the wait time at Wallace-Hamilton?”</em>, it invokes the <strong>Wait</strong> tool and passes <strong>Wallace-Hamilton</strong> as input. This means the agent is calling <code>get_current_wait_times("Wallace-Hamilton")</code>, observing the return value, and using the return value to answer your question.</p>
<p>To see the agents full capabilities, you can ask it questions about patient experiences that require patient reviews to answer:</p>
<div class="codeblock mb-3 w-100" aria-label="Code block" data-syntax-language="pycon" data-is-repl="true">
  <div class="codeblock__header d-flex justify-content-between codeblock--blue">
    <span class="mr-2 noselect" aria-label="Language">Python</span>
    
    <div class="noselect">
      
        <span class="codeblock__output-toggle" title="Toggle prompts and output"><span class="icon baseline js-codeblock-output-on codeblock__header--icon-lower"><svg><use href="/static/icons.67f62bbffdec.svg#regular--rectangle-terminal"></use></svg></span></span>
      
    </div>
  </div>
  <div style="position: relative;">
    <div class="highlight highlight--with-header"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">response</span> <span class="o">=</span> <span class="n">hospital_rag_agent_executor</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span>
<span class="gp">... </span>    <span class="p">{</span>
<span class="gp">... </span>        <span class="s2">"input"</span><span class="p">:</span> <span class="p">(</span>
<span class="gp">... </span>            <span class="s2">"What have patients said about their "</span>
<span class="gp">... </span>            <span class="s2">"quality of rest during their stay?"</span>
<span class="gp">... </span>        <span class="p">)</span>
<span class="gp">... </span>    <span class="p">}</span>
<span class="gp">... </span><span class="p">)</span>

<span class="go">&gt; Entering new AgentExecutor chain...</span>

<span class="go">Invoking: `Experiences` with `What have patients said about their quality of</span>
<span class="go">rest during their stay?`</span>

<span class="go">{'query': 'What have patients said about their quality of rest during their</span>
<span class="go">stay?','result': "Patients have mentioned that the constant interruptions</span>
<span class="go">for routine checks and the noise level at night were disruptive and made</span>
<span class="go">it difficult for them to get a good night's sleep during their stay.</span>
<span class="go">Additionally, some patients have complained about uncomfortable beds</span>
<span class="go">affecting their quality of rest."}Patients have mentioned that the</span>
<span class="go">constant interruptions for routine checks and the noise level at night</span>
<span class="go">were disruptive and made it difficult for them to get a good night's sleep</span>
<span class="go">during their stay. Additionally, some patients have complained about</span>
<span class="go">uncomfortable beds affecting their quality of rest.</span>

<span class="go">&gt; Finished chain.</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"output"</span><span class="p">)</span>
<span class="go">"Patients have mentioned that the constant interruptions for routine checks</span>
<span class="go">and the noise level at night were disruptive and made it difficult for them</span>
<span class="go">to get a good night's sleep during their stay. Additionally, some patients</span>
<span class="go">have complained about uncomfortable beds affecting their quality of rest."</span>
</code></pre></div>
    
    <button class="codeblock__copy btn btn-outline-secondary border m-1 px-1 d-hover-only" title="Copy to clipboard"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#@copy"></use></svg></span></button>
    <template class="codeblock__copied-template"></template>
    
  </div>
</div>
<p>Notice here how you never explicitly mention reviews or experiences in your question. The agent knows, based on the tool description, that it needs to invoke <strong>Experiences</strong>. Lastly, you can ask the agent a question requiring a Cypher query to answer:</p>
<div class="codeblock mb-3 w-100" aria-label="Code block" data-syntax-language="pycon" data-is-repl="true">
  <div class="codeblock__header d-flex justify-content-between codeblock--blue">
    <span class="mr-2 noselect" aria-label="Language">Python</span>
    
    <div class="noselect">
      
        <span class="codeblock__output-toggle" title="Toggle prompts and output"><span class="icon baseline js-codeblock-output-on codeblock__header--icon-lower"><svg><use href="/static/icons.67f62bbffdec.svg#regular--rectangle-terminal"></use></svg></span></span>
      
    </div>
  </div>
  <div style="position: relative;">
    <div class="highlight highlight--with-header"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">response</span> <span class="o">=</span> <span class="n">hospital_rag_agent_executor</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span>
<span class="gp">... </span>    <span class="p">{</span>
<span class="gp">... </span>        <span class="s2">"input"</span><span class="p">:</span> <span class="p">(</span>
<span class="gp">... </span>            <span class="s2">"Which physician has treated the "</span>
<span class="gp">... </span>            <span class="s2">"most patients covered by Cigna?"</span>
<span class="gp">... </span>        <span class="p">)</span>
<span class="gp">... </span>    <span class="p">}</span>
<span class="gp">... </span><span class="p">)</span>

<span class="go">&gt; Entering new AgentExecutor chain...</span>

<span class="go">Invoking: `Graph` with `Which physician has treated the most patients</span>
<span class="go">covered by Cigna?`</span>

<span class="go">&gt; Entering new GraphCypherQAChain chain...</span>
<span class="go">Generated Cypher:</span>
<span class="go">MATCH (phy:Physician)-[:TREATS]-&gt;(v:Visit)-[:COVERED_BY]-&gt;(p:Payer)</span>
<span class="go">WHERE p.name = 'Cigna'</span>
<span class="go">WITH phy, COUNT(DISTINCT v) AS patient_count</span>
<span class="go">RETURN phy.name AS physician_name, patient_count</span>
<span class="go">ORDER BY patient_count DESC</span>
<span class="go">LIMIT 1</span>
<span class="go">Full Context:</span>
<span class="go">[{'physician_name': 'Renee Brown', 'patient_count': 10}]</span>

<span class="go">&gt; Finished chain.</span>
<span class="go">{'query': 'Which physician has treated the most patients covered by Cigna?',</span>
<span class="go">'result': 'The physician who has treated the most patients covered by Cigna</span>
<span class="go">is Dr. Renee Brown. She has treated a total of 10 patients.'}The</span>
<span class="go">physician who has treated the most patients covered by Cigna is Dr. Renee</span>
<span class="go">Brown. She has treated a total of 10 patients.</span>

<span class="go">&gt; Finished chain.</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"output"</span><span class="p">)</span>
<span class="go">'The physician who has treated the most patients covered by</span>
<span class="go">Cigna is Dr. Renee Brown.</span>
<span class="go">She has treated a total of 10 patients.'</span>
</code></pre></div>
    
    <button class="codeblock__copy btn btn-outline-secondary border m-1 px-1 d-hover-only" title="Copy to clipboard"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#@copy"></use></svg></span></button>
    <template class="codeblock__copied-template"></template>
    
  </div>
</div>
<p>Your agent has a remarkable ability to know which tools to use and which inputs to pass based on your query. This is your fully-functioning chatbot. It has the potential to answer all the questions your stakeholders might ask based on the requirements given, and it appears to be doing a great job so far. </p>
<p>As you ask your chatbot more questions, you’ll almost certainly encounter situations where it calls the wrong tool or generates an incorrect answer. While modifying your prompts can help address incorrect answers, sometimes you can modify your input query to help your chatbot. Take a look at this example:</p>
<div class="codeblock mb-3 w-100" aria-label="Code block" data-syntax-language="pycon" data-is-repl="true">
  <div class="codeblock__header d-flex justify-content-between codeblock--blue">
    <span class="mr-2 noselect" aria-label="Language">Python</span>
    
    <div class="noselect">
      
        <span class="codeblock__output-toggle" title="Toggle prompts and output"><span class="icon baseline js-codeblock-output-on codeblock__header--icon-lower"><svg><use href="/static/icons.67f62bbffdec.svg#regular--rectangle-terminal"></use></svg></span></span>
      
    </div>
  </div>
  <div style="position: relative;">
    <div class="highlight highlight--with-header"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">response</span> <span class="o">=</span> <span class="n">hospital_rag_agent_executor</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span>
<span class="gp">... </span>    <span class="p">{</span><span class="s2">"input"</span><span class="p">:</span> <span class="s2">"Show me reviews written by patient 7674."</span><span class="p">}</span>
<span class="gp">... </span><span class="p">)</span>

<span class="go">&gt; Entering new AgentExecutor chain...</span>

<span class="go">Invoking: `Experiences` with `Show me reviews written by patient 7674.`</span>

<span class="go">{'query': 'Show me reviews written by patient 7674.', 'result': 'I\'m sorry,</span>
<span class="go">but there are no reviews provided by a patient with the identifier "7674" in</span>
<span class="go">the context given. If you have any other questions or need information about</span>
<span class="go">the reviews provided, feel free to ask.'}I'm sorry, but there are no reviews</span>
<span class="go">provided by a patient with the identifier "7674" in the context given. If</span>
<span class="go">you have any other questions or need information about the reviews provided,</span>
<span class="go">feel free to ask.</span>

<span class="go">&gt; Finished chain.</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"output"</span><span class="p">)</span>
<span class="go">'I\'m sorry, but there are no reviews provided by a patient with the identifier</span>
<span class="go">"7674" in the context given. If you have any other questions or need information</span>
<span class="go">about the reviews provided, feel free to ask.'</span>
</code></pre></div>
    
    <button class="codeblock__copy btn btn-outline-secondary border m-1 px-1 d-hover-only" title="Copy to clipboard"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#@copy"></use></svg></span></button>
    <template class="codeblock__copied-template"></template>
    
  </div>
</div>
<p>In this example, you ask the agent to show you reviews written by patient 7674. Your agent invokes <code>Experiences</code> and doesn’t find the answer you’re looking for. While it may be possible to find the answer using semantic vector search, you can get an exact answer by generating a Cypher query to look up reviews corresponding to patient ID 7674. To help your agent understand this, you can add additional detail to your query:</p>
<div class="codeblock mb-3 w-100" aria-label="Code block" data-syntax-language="pycon" data-is-repl="true">
  <div class="codeblock__header d-flex justify-content-between codeblock--blue">
    <span class="mr-2 noselect" aria-label="Language">Python</span>
    
    <div class="noselect">
      
        <span class="codeblock__output-toggle" title="Toggle prompts and output"><span class="icon baseline js-codeblock-output-on codeblock__header--icon-lower"><svg><use href="/static/icons.67f62bbffdec.svg#regular--rectangle-terminal"></use></svg></span></span>
      
    </div>
  </div>
  <div style="position: relative;">
    <div class="highlight highlight--with-header"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">response</span> <span class="o">=</span> <span class="n">hospital_rag_agent_executor</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span>
<span class="gp">... </span>    <span class="p">{</span>
<span class="gp">... </span>        <span class="s2">"input"</span><span class="p">:</span> <span class="p">(</span>
<span class="gp">... </span>            <span class="s2">"Query the graph database to show me "</span>
<span class="gp">... </span>            <span class="s2">"the reviews written by patient 7674"</span>
<span class="gp">... </span>        <span class="p">)</span>
<span class="gp">... </span>    <span class="p">}</span>
<span class="gp">... </span><span class="p">)</span>

<span class="go">&gt; Entering new AgentExecutor chain...</span>

<span class="go">Invoking: `Graph` with `Show me reviews written by patient 7674`</span>

<span class="go">&gt; Entering new GraphCypherQAChain chain...</span>
<span class="go">Generated Cypher:</span>
<span class="go">MATCH (p:Patient {id: 7674})-[:HAS]-&gt;(v:Visit)-[:WRITES]-&gt;(r:Review)</span>
<span class="go">RETURN r.text AS review_written</span>

<span class="go">Full Context:</span>
<span class="go">[{'review_written': 'The hospital provided exceptional care,</span>
<span class="go">but the billing process was confusing and frustrating. Clearer</span>
<span class="go">communication about costs would have been appreciated.'}]</span>

<span class="go">&gt; Finished chain.</span>
<span class="go">{'query': 'Show me reviews written by patient 7674', 'result': 'Here</span>
<span class="go">is a review written by patient 7674: "The hospital provided exceptional</span>
<span class="go">care, but the billing process was confusing and frustrating. Clearer</span>
<span class="go">communication about costs would have been appreciated."'}Patient 7674</span>
<span class="go">wrote the following review: "The hospital provided exceptional</span>
<span class="go">care, but the billing process was confusing and frustrating.</span>
<span class="go">Clearer communication about costs would have been appreciated."</span>

<span class="go">&gt; Finished chain.</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"output"</span><span class="p">)</span>
<span class="go">'Patient 7674 wrote the following review: "The hospital provided exceptional</span>
<span class="go">care, but the billing process was confusing and frustrating. Clearer</span>
<span class="go">communication about costs would have been appreciated."'</span>
</code></pre></div>
    
    <button class="codeblock__copy btn btn-outline-secondary border m-1 px-1 d-hover-only" title="Copy to clipboard"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#@copy"></use></svg></span></button>
    <template class="codeblock__copied-template"></template>
    
  </div>
</div>
<p>Here, you explicitly tell your agent that you want to query the graph database, which correctly invokes <code>Graph</code> to find the review matching patient ID 7674. Providing more detail in your queries like this is a simple yet effective way to guide your agent when it’s clearly invoking the wrong tools.</p>
<p>As with your reviews and Cypher chain, before placing this in front of stakeholders, you’d want to come up with a framework for evaluating your agent. The primary functionality you’d want to evaluate is the agent’s ability to call the correct tools with the correct inputs, and its ability to understand and interpret the outputs of the tools it calls.</p>
<p>In the final step, you’ll learn how to deploy your hospital system agent with FastAPI and Streamlit. This will make your agent accessible to anyone who calls the API endpoint or interacts with the Streamlit UI.</p>
</section></section><section class="section2"><h2 id="step-5-deploy-the-langchain-agent">Step 5: Deploy the LangChain Agent<a class="headerlink" href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#step-5-deploy-the-langchain-agent" title="Permanent link"></a></h2>
<p>At long last, you have a functioning LangChain agent that serves as your hospital system chatbot. The last thing you need to do is get your chatbot in front of stakeholders. For this, you’ll deploy your chatbot as a FastAPI endpoint and create a Streamlit UI to interact with the endpoint. </p>
<p>Before you get started, create two new folders called <code>chatbot_frontend/</code> and <code>tests/</code> in your project’s root directory. You’ll also need to add some additional files and folders to <code>chatbot_api/</code>:</p>
<div class="highlight"><pre><span></span><code>./
│
├── chatbot_api/
│   │
│   ├── src/
│   │   │
│   │   ├── agents/
│   │   │   └── hospital_rag_agent.py
│   │   │
│   │   ├── chains/
│   │   │   ├── hospital_cypher_chain.py
│   │   │   └── hospital_review_chain.py
│   │   │
<span class="hll">│   │   ├── models/
</span><span class="hll">│   │   │   └── hospital_rag_query.py
</span>│   │   │
│   │   ├── tools/
│   │   │   └── wait_times.py
│   │   │
<span class="hll">│   │   ├── utils/
</span><span class="hll">│   │   │   └── async_utils.py
</span>│   │   │
<span class="hll">│   │   ├── entrypoint.sh
</span><span class="hll">│   │   └── main.py
</span>│   │
<span class="hll">│   ├── Dockerfile
</span>│   └── pyproject.toml
│
<span class="hll">├── chatbot_frontend/
</span><span class="hll">│   │
</span><span class="hll">│   ├── src/
</span><span class="hll">│   │   ├── entrypoint.sh
</span><span class="hll">│   │   └── main.py
</span><span class="hll">│   │
</span><span class="hll">│   ├── Dockerfile
</span><span class="hll">│   └── pyproject.toml
</span>│
├── hospital_neo4j_etl/
│   │
│   ├── src/
│   │   ├── entrypoint.sh
│   │   └── hospital_bulk_csv_write.py
│   │
│   ├── Dockerfile
│   └── pyproject.toml
│
<span class="hll">├── tests/
</span><span class="hll">│   ├── async_agent_requests.py
</span><span class="hll">│   └── sync_agent_requests.py
</span>│
├── .env
└── docker-compose.yml
</code></pre></div>
<p>You need the new files in <code>chatbot_api</code> to build your FastAPI app, and <code>tests/</code> has two scripts to demonstrate the power of making asynchronous requests to your agent. Lastly, <code>chatbot_frontend/</code> has the code for the Streamlit UI that’ll interface with your chatbot. You’ll start by creating a FastAPI application to serve your agent.</p>
<section class="section3"><h3 id="serve-the-agent-with-fastapi">Serve the Agent With FastAPI<a class="headerlink" href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#serve-the-agent-with-fastapi" title="Permanent link"></a></h3>
<p><a href="https://realpython.com/fastapi-python-web-apis/">FastAPI</a> is a modern, high-performance web framework for building APIs with Python based on standard type hints. It comes with a lot of great features including development speed, runtime speed, and great community support, making it a great choice for serving your chatbot agent.</p>
<p>You’ll serve your agent through a <a href="https://en.wikipedia.org/wiki/POST_(HTTP)">POST</a> request, so the first step is to define what data you expect to get in the request body and what data the request returns. FastAPI does this with <a href="https://docs.pydantic.dev/latest/">Pydantic</a>:</p>
<div class="codeblock mb-3 w-100" aria-label="Code block" data-syntax-language="python">
  <div class="codeblock__header d-flex justify-content-between codeblock--blue">
    <span class="mr-2 noselect" aria-label="Language">Python</span>
    <span class="mr-2" aria-label="Filename"><code style="color: inherit;">chatbot_api/src/models/hospital_rag_query.py</code></span>
    <div class="noselect">
      
    </div>
  </div>
  <div style="position: relative;">
    <div class="highlight highlight--with-header"><pre><span></span><code><span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">BaseModel</span>

<span class="k">class</span> <span class="nc">HospitalQueryInput</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">text</span><span class="p">:</span> <span class="nb">str</span>

<span class="k">class</span> <span class="nc">HospitalQueryOutput</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="nb">input</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">output</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">intermediate_steps</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
</code></pre></div>
    
    <button class="codeblock__copy btn btn-outline-secondary border m-1 px-1 d-hover-only" title="Copy to clipboard"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#@copy"></use></svg></span></button>
    <template class="codeblock__copied-template"></template>
    
  </div>
</div>
<p>In this script, you define Pydantic models <code>HospitalQueryInput</code> and <code>HospitalQueryOutput</code>. <code>HospitalQueryInput</code> is used to verify that the POST request body includes a <code>text</code> field, representing the query your chatbot responds to. <code>HospitalQueryOutput</code> verifies the response body sent back to your user includes <code>input</code>, <code>output</code>, and <code>intermediate_step</code> fields. </p>
<p>One great feature of FastAPI is its <a href="https://fastapi.tiangolo.com/async/">asynchronous</a> serving capabilities. Because your agent calls OpenAI models hosted on an external server, there will always be latency while your agent waits for a response. This is a perfect opportunity for you to use asynchronous programming. </p>
<p>Instead of waiting for OpenAI to respond to each of your agent’s requests, you can have your agent make multiple requests in a row and store the responses as they’re received. This will save you a lot of time if you have multiple queries you need your agent to respond to.</p>
<p>As discussed previously, there can sometimes be intermittent connection issues with Neo4j that are usually resolved by establishing a new connection. Because of this, you’ll want to implement retry logic that works for asynchronous functions:</p>
<div class="codeblock mb-3 w-100" aria-label="Code block" data-syntax-language="python">
  <div class="codeblock__header d-flex justify-content-between codeblock--blue">
    <span class="mr-2 noselect" aria-label="Language">Python</span>
    <span class="mr-2" aria-label="Filename"><code style="color: inherit;">chatbot_api/src/utils/async_utils.py</code></span>
    <div class="noselect">
      
    </div>
  </div>
  <div style="position: relative;">
    <div class="highlight highlight--with-header"><pre><span></span><code><span class="kn">import</span> <span class="nn">asyncio</span>

<span class="k">def</span> <span class="nf">async_retry</span><span class="p">(</span><span class="n">max_retries</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">delay</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
        <span class="k">async</span> <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_retries</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">result</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Attempt </span><span class="si">{</span><span class="n">attempt</span><span class="si">}</span><span class="s2"> failed: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
                    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">delay</span><span class="p">)</span>

            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Failed after </span><span class="si">{</span><span class="n">max_retries</span><span class="si">}</span><span class="s2"> attempts"</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">wrapper</span>

    <span class="k">return</span> <span class="n">decorator</span>
</code></pre></div>
    
    <button class="codeblock__copy btn btn-outline-secondary border m-1 px-1 d-hover-only" title="Copy to clipboard"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#@copy"></use></svg></span></button>
    <template class="codeblock__copied-template"></template>
    
  </div>
</div>
<p>Don’t worry about the details of <code>@async_retry</code>. All you need to know is that it will retry an asynchronous function if it fails. You’ll see where this is used next.</p>
<p>The driving logic for your chatbot API is in <code>chatbot_api/src/main.py</code>:</p>
<div class="codeblock mb-3 w-100" aria-label="Code block" data-syntax-language="python">
  <div class="codeblock__header d-flex justify-content-between codeblock--blue">
    <span class="mr-2 noselect" aria-label="Language">Python</span>
    <span class="mr-2" aria-label="Filename"><code style="color: inherit;">chatbot_api/src/main.py</code></span>
    <div class="noselect">
      
    </div>
  </div>
  <div style="position: relative;">
    <div class="highlight highlight--with-header"><pre><span></span><code><span class="kn">from</span> <span class="nn">fastapi</span> <span class="kn">import</span> <span class="n">FastAPI</span>
<span class="kn">from</span> <span class="nn">agents.hospital_rag_agent</span> <span class="kn">import</span> <span class="n">hospital_rag_agent_executor</span>
<span class="kn">from</span> <span class="nn">models.hospital_rag_query</span> <span class="kn">import</span> <span class="n">HospitalQueryInput</span><span class="p">,</span> <span class="n">HospitalQueryOutput</span>
<span class="kn">from</span> <span class="nn">utils.async_utils</span> <span class="kn">import</span> <span class="n">async_retry</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">FastAPI</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Hospital Chatbot"</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">"Endpoints for a hospital system graph RAG chatbot"</span><span class="p">,</span>
<span class="p">)</span>

<span class="nd">@async_retry</span><span class="p">(</span><span class="n">max_retries</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">delay</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">invoke_agent_with_retry</span><span class="p">(</span><span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Retry the agent if a tool fails to run.</span>

<span class="sd">    This can help when there are intermittent connection issues</span>
<span class="sd">    to external APIs.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="k">await</span> <span class="n">hospital_rag_agent_executor</span><span class="o">.</span><span class="n">ainvoke</span><span class="p">({</span><span class="s2">"input"</span><span class="p">:</span> <span class="n">query</span><span class="p">})</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">get_status</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">"status"</span><span class="p">:</span> <span class="s2">"running"</span><span class="p">}</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">"/hospital-rag-agent"</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">query_hospital_agent</span><span class="p">(</span><span class="n">query</span><span class="p">:</span> <span class="n">HospitalQueryInput</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">HospitalQueryOutput</span><span class="p">:</span>
    <span class="n">query_response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">invoke_agent_with_retry</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
    <span class="n">query_response</span><span class="p">[</span><span class="s2">"intermediate_steps"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">query_response</span><span class="p">[</span><span class="s2">"intermediate_steps"</span><span class="p">]</span>
    <span class="p">]</span>

    <span class="k">return</span> <span class="n">query_response</span>
</code></pre></div>
    
    <button class="codeblock__copy btn btn-outline-secondary border m-1 px-1 d-hover-only" title="Copy to clipboard"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#@copy"></use></svg></span></button>
    <template class="codeblock__copied-template"></template>
    
  </div>
</div>
<p>You import <code>FastAPI</code>, your agent executor, the Pydantic models you created for the POST request, and <code>@async_retry</code>. Then you instantiate a <code>FastAPI</code> object and define <code>invoke_agent_with_retry()</code>, a function that runs your agent asynchronously. The <code>@async_retry</code> decorator above <code>invoke_agent_with_retry()</code> ensures the function will be retried ten times with a delay of one second before failing. </p>
<p>Lastly, you define <code>query_hospital_agent()</code> which serves POST requests to your agent at <strong>/hospital-rag-agent</strong>. This function extracts the <code>text</code> field from the request body, passes it to the agent, and returns the agent’s response to the user. </p>
<p>You’ll serve this API with Docker and you’ll want to define the following entrypoint file to run inside the container:</p>
<div class="codeblock mb-3 w-100" aria-label="Code block" data-syntax-language="sh">
  <div class="codeblock__header d-flex justify-content-between codeblock--yellow">
    <span class="mr-2 noselect" aria-label="Language">Shell</span>
    <span class="mr-2" aria-label="Filename"><code style="color: inherit;">chatbot_api/src/entrypoint.sh</code></span>
    <div class="noselect">
      
    </div>
  </div>
  <div style="position: relative;">
    <div class="highlight highlight--with-header"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># Run any setup steps or pre-processing tasks here</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">"Starting hospital RAG FastAPI service..."</span>

<span class="c1"># Start the main application</span>
uvicorn<span class="w"> </span>main:app<span class="w"> </span>--host<span class="w"> </span><span class="m">0</span>.0.0.0<span class="w"> </span>--port<span class="w"> </span><span class="m">8000</span>
</code></pre></div>
    
    <button class="codeblock__copy btn btn-outline-secondary border m-1 px-1 d-hover-only" title="Copy to clipboard"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#@copy"></use></svg></span></button>
    <template class="codeblock__copied-template"></template>
    
  </div>
</div>
<p>The command <code>uvicorn main:app --host 0.0.0.0 --port 8000</code> runs the FastAPI application at port 8000 on your machine. The driving <code>Dockerfile</code> for your FastAPI app looks like this:</p>
<div class="codeblock mb-3 w-100" aria-label="Code block" data-syntax-language="dockerfile">
  <div class="codeblock__header d-flex justify-content-between codeblock--grey">
    <span class="mr-2 noselect" aria-label="Language">Dockerfile</span>
    <span class="mr-2" aria-label="Filename"><code style="color: inherit;">chatbot_api/Dockerfile</code></span>
    <div class="noselect">
      
    </div>
  </div>
  <div style="position: relative;">
    <div class="highlight highlight--with-header"><pre><span></span><code><span class="c"># chatbot_api/Dockerfile</span>

<span class="k">FROM</span><span class="w"> </span><span class="s">python:3.11-slim</span>

<span class="k">WORKDIR</span><span class="w"> </span><span class="s">/app</span>
<span class="k">COPY</span><span class="w"> </span>./src/<span class="w"> </span>/app

<span class="k">COPY</span><span class="w"> </span>./pyproject.toml<span class="w"> </span>/code/pyproject.toml
<span class="k">RUN</span><span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>/code/.

<span class="k">EXPOSE</span><span class="w"> </span><span class="s">8000</span>
<span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">"sh"</span><span class="p">,</span><span class="w"> </span><span class="s2">"entrypoint.sh"</span><span class="p">]</span>
</code></pre></div>
    
    <button class="codeblock__copy btn btn-outline-secondary border m-1 px-1 d-hover-only" title="Copy to clipboard"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#@copy"></use></svg></span></button>
    <template class="codeblock__copied-template"></template>
    
  </div>
</div>
<p>This <code>Dockerfile</code> tells your container to use the <code>python:3.11-slim</code> <a href="https://hub.docker.com/_/python">distribution</a>, copy the contents from <code>chatbot_api/src/</code> into the <code>/app</code> directory within the container, install the dependencies from <code>pyproject.toml</code>, and run <code>entrypoint.sh</code>.</p>
<p>The last thing you’ll need to do is update the <code>docker-compose.yml</code> file to include your FastAPI container:</p>
<div class="codeblock mb-3 w-100" aria-label="Code block" data-syntax-language="yaml">
  <div class="codeblock__header d-flex justify-content-between codeblock--grey">
    <span class="mr-2 noselect" aria-label="Language">YAML</span>
    
    <div class="noselect">
      
    </div>
  </div>
  <div style="position: relative;">
    <div class="highlight highlight--with-header"><pre><span></span><code><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">'3'</span>

<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">hospital_neo4j_etl</span><span class="p">:</span>
<span class="w">    </span><span class="nt">build</span><span class="p">:</span>
<span class="w">      </span><span class="nt">context</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./hospital_neo4j_etl</span>
<span class="w">    </span><span class="nt">env_file</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.env</span>

<span class="hll"><span class="w">  </span><span class="nt">chatbot_api</span><span class="p">:</span>
</span><span class="hll"><span class="w">    </span><span class="nt">build</span><span class="p">:</span>
</span><span class="hll"><span class="w">      </span><span class="nt">context</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./chatbot_api</span>
</span><span class="hll"><span class="w">    </span><span class="nt">env_file</span><span class="p">:</span>
</span><span class="hll"><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.env</span>
</span><span class="hll"><span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span>
</span><span class="hll"><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hospital_neo4j_etl</span>
</span><span class="hll"><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span class="hll"><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">"8000:8000"</span>
</span></code></pre></div>
    
    <button class="codeblock__copy btn btn-outline-secondary border m-1 px-1 d-hover-only" title="Copy to clipboard"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#@copy"></use></svg></span></button>
    <template class="codeblock__copied-template"></template>
    
  </div>
</div>
<p>Here you add the <code>chatbot_api</code> service which is derived from the <code>Dockerfile</code> in <code>./chatbot_api</code>. It depends on <code>hospital_neo4j_etl</code> and will run on port 8000. </p>
<p>To run the API, along with the ETL you build earlier, open a terminal and run:</p>
<div class="codeblock mb-3 w-100" aria-label="Code block" data-syntax-language="console" data-is-repl="true">
  <div class="codeblock__header d-flex justify-content-between codeblock--yellow">
    <span class="mr-2 noselect" aria-label="Language">Shell</span>
    
    <div class="noselect">
      
        <span class="codeblock__output-toggle" title="Toggle prompts and output"><span class="icon baseline js-codeblock-output-on codeblock__header--icon-lower"><svg><use href="/static/icons.67f62bbffdec.svg#regular--rectangle-terminal"></use></svg></span></span>
      
    </div>
  </div>
  <div style="position: relative;">
    <div class="highlight highlight--with-header"><pre><span></span><code><span class="gp">$ </span>docker-compose<span class="w"> </span>up<span class="w"> </span>--build
</code></pre></div>
    
    <button class="codeblock__copy btn btn-outline-secondary border m-1 px-1 d-hover-only" title="Copy to clipboard"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#@copy"></use></svg></span></button>
    <template class="codeblock__copied-template"></template>
    
  </div>
</div>
<p>If everything runs successfully, you’ll see a screen similar to the following at <code>http://localhost:8000/docs#/</code>:</p>
<figure class="js-lightbox"><a href="./Build an LLM RAG Chatbot With LangChain – Real Python_files/Screenshot_2024-01-14_at_3.26.14_PM.46d6c97c9bfd.png" target="_blank"><img loading="lazy" class="img-fluid mx-auto d-block " src="./Build an LLM RAG Chatbot With LangChain – Real Python_files/Screenshot_2024-01-14_at_3.26.14_PM.46d6c97c9bfd.png" width="3030" height="1462" srcset="https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/Screenshot_2024-01-14_at_3.26.14_PM.46d6c97c9bfd.png&amp;w=757&amp;sig=15845c73ed2572bcfe19c0605d50c42ccd431f04 757w, https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/Screenshot_2024-01-14_at_3.26.14_PM.46d6c97c9bfd.png&amp;w=1010&amp;sig=14d027e9af7938252a5503fdec1e16b534e2204b 1010w, https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/Screenshot_2024-01-14_at_3.26.14_PM.46d6c97c9bfd.png&amp;w=1515&amp;sig=b17b4bdb13de1cd5a1f16702b93d14cc87f58bdc 1515w, https://files.realpython.com/media/Screenshot_2024-01-14_at_3.26.14_PM.46d6c97c9bfd.png 3030w" sizes="(min-width: 1200px) 690px, (min-width: 780px) calc(-5vw + 669px), (min-width: 580px) 510px, calc(100vw - 30px)" alt="FastAPI Docs" data-asset="5646"></a><figcaption class="figure-caption text-center">FastAPI docs screen</figcaption></figure>

<p>You can use the docs page to test the <code>hospital-rag-agent</code> endpoint, but you won’t be able to make asynchronous requests here. To see how your endpoint handles asynchronous requests, you can test it with a library like <a href="https://www.python-httpx.org/">httpx</a>.</p>
<div class="alert alert-primary" role="alert">
<p><strong>Note:</strong> You need to <a href="https://pypi.org/project/httpx/">install httpx</a> into your virtual environment before running the tests below.</p>
</div>
<p>To see how much time asynchronous requests save you, start by establishing a benchmark using synchronous requests. Create the following script:</p>
<div class="codeblock mb-3 w-100" aria-label="Code block" data-syntax-language="python">
  <div class="codeblock__header d-flex justify-content-between codeblock--blue">
    <span class="mr-2 noselect" aria-label="Language">Python</span>
    <span class="mr-2" aria-label="Filename"><code style="color: inherit;">tests/sync_agent_requests.py</code></span>
    <div class="noselect">
      
    </div>
  </div>
  <div style="position: relative;">
    <div class="highlight highlight--with-header"><pre><span></span><code><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="n">CHATBOT_URL</span> <span class="o">=</span> <span class="s2">"http://localhost:8000/hospital-rag-agent"</span>

<span class="n">questions</span> <span class="o">=</span> <span class="p">[</span>
   <span class="s2">"What is the current wait time at Wallace-Hamilton hospital?"</span><span class="p">,</span>
   <span class="s2">"Which hospital has the shortest wait time?"</span><span class="p">,</span>
   <span class="s2">"At which hospitals are patients complaining about billing and insurance issues?"</span><span class="p">,</span>
   <span class="s2">"What is the average duration in days for emergency visits?"</span><span class="p">,</span>
   <span class="s2">"What are patients saying about the nursing staff at Castaneda-Hardy?"</span><span class="p">,</span>
   <span class="s2">"What was the total billing amount charged to each payer for 2023?"</span><span class="p">,</span>
   <span class="s2">"What is the average billing amount for Medicaid visits?"</span><span class="p">,</span>
   <span class="s2">"How many patients has Dr. Ryan Brown treated?"</span><span class="p">,</span>
   <span class="s2">"Which physician has the lowest average visit duration in days?"</span><span class="p">,</span>
   <span class="s2">"How many visits are open and what is their average duration in days?"</span><span class="p">,</span>
   <span class="s2">"Have any patients complained about noise?"</span><span class="p">,</span>
   <span class="s2">"How much was billed for patient 789's stay?"</span><span class="p">,</span>
   <span class="s2">"Which physician has billed the most to cigna?"</span><span class="p">,</span>
   <span class="s2">"Which state had the largest percent increase in Medicaid visits from 2022 to 2023?"</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">request_bodies</span> <span class="o">=</span> <span class="p">[{</span><span class="s2">"text"</span><span class="p">:</span> <span class="n">q</span><span class="p">}</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">questions</span><span class="p">]</span>

<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
<span class="n">outputs</span> <span class="o">=</span> <span class="p">[</span><span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">CHATBOT_URL</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">data</span><span class="p">)</span> <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">request_bodies</span><span class="p">]</span>
<span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Run time: </span><span class="si">{</span><span class="n">end_time</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start_time</span><span class="si">}</span><span class="s2"> seconds"</span><span class="p">)</span>
</code></pre></div>
    
    <button class="codeblock__copy btn btn-outline-secondary border m-1 px-1 d-hover-only" title="Copy to clipboard"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#@copy"></use></svg></span></button>
    <template class="codeblock__copied-template"></template>
    
  </div>
</div>
<p>In this script, you import <code>requests</code> and <code>time</code>, define the URL to your chatbot, create a list of questions, and record the amount of time it takes to get a response to all the questions in the list. If you open a terminal and run <code>sync_agent_requests.py</code>, you’ll see how long it takes to answer all 14 questions:</p>
<div class="codeblock mb-3 w-100" aria-label="Code block" data-syntax-language="console" data-is-repl="true">
  <div class="codeblock__header d-flex justify-content-between codeblock--yellow">
    <span class="mr-2 noselect" aria-label="Language">Shell</span>
    
    <div class="noselect">
      
        <span class="codeblock__output-toggle" title="Toggle prompts and output"><span class="icon baseline js-codeblock-output-on codeblock__header--icon-lower"><svg><use href="/static/icons.67f62bbffdec.svg#regular--rectangle-terminal"></use></svg></span></span>
      
    </div>
  </div>
  <div style="position: relative;">
    <div class="highlight highlight--with-header"><pre><span></span><code><span class="gp gp-VirtualEnv">(venv)</span> <span class="gp">$ </span>python<span class="w"> </span>tests/sync_agent_requests.py
<span class="go">Run time: 68.20339595794212 seconds</span>
</code></pre></div>
    
    <button class="codeblock__copy btn btn-outline-secondary border m-1 px-1 d-hover-only" title="Copy to clipboard"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#@copy"></use></svg></span></button>
    <template class="codeblock__copied-template"></template>
    
  </div>
</div>
<p>You may get slightly different results depending on your Internet speed and the availability of the chat model, but you can see this script took around 68 seconds to run. Next, you’ll get answers to the same questions asynchronously:</p>
<div class="codeblock mb-3 w-100" aria-label="Code block" data-syntax-language="python">
  <div class="codeblock__header d-flex justify-content-between codeblock--blue">
    <span class="mr-2 noselect" aria-label="Language">Python</span>
    <span class="mr-2" aria-label="Filename"><code style="color: inherit;">tests/async_agent_requests.py</code></span>
    <div class="noselect">
      
    </div>
  </div>
  <div style="position: relative;">
    <div class="highlight highlight--with-header"><pre><span></span><code><span class="kn">import</span> <span class="nn">asyncio</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">httpx</span>

<span class="n">CHATBOT_URL</span> <span class="o">=</span> <span class="s2">"http://localhost:8000/hospital-rag-agent"</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">make_async_post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="n">timeout</span> <span class="o">=</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Timeout</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">120</span><span class="p">)</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">httpx</span><span class="o">.</span><span class="n">AsyncClient</span><span class="p">()</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">make_bulk_requests</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span><span class="n">make_async_post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">payload</span><span class="p">)</span> <span class="k">for</span> <span class="n">payload</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>
    <span class="n">responses</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">tasks</span><span class="p">)</span>
    <span class="n">outputs</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s2">"output"</span><span class="p">]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">responses</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">outputs</span>

<span class="n">questions</span> <span class="o">=</span> <span class="p">[</span>
   <span class="s2">"What is the current wait time at Wallace-Hamilton hospital?"</span><span class="p">,</span>
   <span class="s2">"Which hospital has the shortest wait time?"</span><span class="p">,</span>
   <span class="s2">"At which hospitals are patients complaining about billing and insurance issues?"</span><span class="p">,</span>
   <span class="s2">"What is the average duration in days for emergency visits?"</span><span class="p">,</span>
   <span class="s2">"What are patients saying about the nursing staff at Castaneda-Hardy?"</span><span class="p">,</span>
   <span class="s2">"What was the total billing amount charged to each payer for 2023?"</span><span class="p">,</span>
   <span class="s2">"What is the average billing amount for Medicaid visits?"</span><span class="p">,</span>
   <span class="s2">"How many patients has Dr. Ryan Brown treated?"</span><span class="p">,</span>
   <span class="s2">"Which physician has the lowest average visit duration in days?"</span><span class="p">,</span>
   <span class="s2">"How many visits are open and what is their average duration in days?"</span><span class="p">,</span>
   <span class="s2">"Have any patients complained about noise?"</span><span class="p">,</span>
   <span class="s2">"How much was billed for patient 789's stay?"</span><span class="p">,</span>
   <span class="s2">"Which physician has billed the most to cigna?"</span><span class="p">,</span>
   <span class="s2">"Which state had the largest percent increase in Medicaid visits from 2022 to 2023?"</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">request_bodies</span> <span class="o">=</span> <span class="p">[{</span><span class="s2">"text"</span><span class="p">:</span> <span class="n">q</span><span class="p">}</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">questions</span><span class="p">]</span>

<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
<span class="n">outputs</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">make_bulk_requests</span><span class="p">(</span><span class="n">CHATBOT_URL</span><span class="p">,</span> <span class="n">request_bodies</span><span class="p">))</span>
<span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Run time: </span><span class="si">{</span><span class="n">end_time</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start_time</span><span class="si">}</span><span class="s2"> seconds"</span><span class="p">)</span>
</code></pre></div>
    
    <button class="codeblock__copy btn btn-outline-secondary border m-1 px-1 d-hover-only" title="Copy to clipboard"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#@copy"></use></svg></span></button>
    <template class="codeblock__copied-template"></template>
    
  </div>
</div>
<p>In <code>async_agent_requests.py</code>, you make the same request you did in <code>sync_agent_requests.py</code>, except now you use <code>httpx</code> to make the requests asynchronously. Here are the results:</p>
<div class="codeblock mb-3 w-100" aria-label="Code block" data-syntax-language="console" data-is-repl="true">
  <div class="codeblock__header d-flex justify-content-between codeblock--yellow">
    <span class="mr-2 noselect" aria-label="Language">Shell</span>
    
    <div class="noselect">
      
        <span class="codeblock__output-toggle" title="Toggle prompts and output"><span class="icon baseline js-codeblock-output-on codeblock__header--icon-lower"><svg><use href="/static/icons.67f62bbffdec.svg#regular--rectangle-terminal"></use></svg></span></span>
      
    </div>
  </div>
  <div style="position: relative;">
    <div class="highlight highlight--with-header"><pre><span></span><code><span class="gp gp-VirtualEnv">(venv)</span> <span class="gp">$ </span>python<span class="w"> </span>tests/async_agent_requests.py
<span class="go">Run time: 17.766680584056303 seconds</span>
</code></pre></div>
    
    <button class="codeblock__copy btn btn-outline-secondary border m-1 px-1 d-hover-only" title="Copy to clipboard"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#@copy"></use></svg></span></button>
    <template class="codeblock__copied-template"></template>
    
  </div>
</div>
<p>Again, the exact time this takes to run may vary for you, but you can see making 14 requests asynchronously was roughly four times faster. Deploying your agent asynchronously allows you to scale to a high-request volume without having to increase your infrastructure demands. While there are always exceptions, serving REST endpoints asynchronously is usually a good idea when your code makes network-bound requests.</p>
<p>With this FastAPI endpoint functioning, you’ve made your agent accessible to anyone who can access the endpoint. This is great for integrating your agent into chatbot UIs, which is what you’ll do next with Streamlit. </p>
</section><section class="section3"><h3 id="create-a-chat-ui-with-streamlit">Create a Chat UI With Streamlit<a class="headerlink" href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#create-a-chat-ui-with-streamlit" title="Permanent link"></a></h3>
<p>Your stakeholders need a way to interact with your agent without making manual API requests. To accommodate this, you’ll build a <a href="https://streamlit.io/">Streamlit</a> app that acts as an interface between your stakeholders and your API. Here are the dependencies for the Streamlit UI:</p>
<div class="codeblock mb-3 w-100" aria-label="Code block" data-syntax-language="toml">
  <div class="codeblock__header d-flex justify-content-between codeblock--grey">
    <span class="mr-2 noselect" aria-label="Language">TOML</span>
    <span class="mr-2" aria-label="Filename"><code style="color: inherit;">chatbot_frontend/pyproject.toml</code></span>
    <div class="noselect">
      
    </div>
  </div>
  <div style="position: relative;">
    <div class="highlight highlight--with-header"><pre><span></span><code><span class="k">[project]</span>
<span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"chatbot_frontend"</span>
<span class="n">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"0.1"</span>
<span class="n">dependencies</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">   </span><span class="s2">"requests==2.31.0"</span><span class="p">,</span>
<span class="w">   </span><span class="s2">"streamlit==1.29.0"</span>
<span class="p">]</span>

<span class="k">[project.optional-dependencies]</span>
<span class="n">dev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">"black"</span><span class="p">,</span><span class="w"> </span><span class="s2">"flake8"</span><span class="p">]</span>
</code></pre></div>
    
    <button class="codeblock__copy btn btn-outline-secondary border m-1 px-1 d-hover-only" title="Copy to clipboard"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#@copy"></use></svg></span></button>
    <template class="codeblock__copied-template"></template>
    
  </div>
</div>
<p>The driving code for your Streamlit app is in <code>chatbot_frontend/src/main.py</code>:</p>
<div class="codeblock mb-3 w-100" aria-label="Code block" data-syntax-language="python">
  <div class="codeblock__header d-flex justify-content-between codeblock--blue">
    <span class="mr-2 noselect" aria-label="Language">Python</span>
    <span class="mr-2" aria-label="Filename"><code style="color: inherit;">chatbot_frontend/src/main.py</code></span>
    <div class="noselect">
      
    </div>
  </div>
  <div style="position: relative;">
    <div class="highlight highlight--with-header"><pre><span></span><code><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">streamlit</span> <span class="k">as</span> <span class="nn">st</span>

<span class="n">CHATBOT_URL</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">"CHATBOT_URL"</span><span class="p">,</span> <span class="s2">"http://localhost:8000/hospital-rag-agent"</span><span class="p">)</span>

<span class="k">with</span> <span class="n">st</span><span class="o">.</span><span class="n">sidebar</span><span class="p">:</span>
    <span class="n">st</span><span class="o">.</span><span class="n">header</span><span class="p">(</span><span class="s2">"About"</span><span class="p">)</span>
    <span class="n">st</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        This chatbot interfaces with a</span>
<span class="sd">        [LangChain](https://python.langchain.com/docs/get_started/introduction)</span>
<span class="sd">        agent designed to answer questions about the hospitals, patients,</span>
<span class="sd">        visits, physicians, and insurance payers in  a fake hospital system.</span>
<span class="sd">        The agent uses  retrieval-augment generation (RAG) over both</span>
<span class="sd">        structured and unstructured data that has been synthetically generated.</span>
<span class="sd">        """</span>
    <span class="p">)</span>

    <span class="n">st</span><span class="o">.</span><span class="n">header</span><span class="p">(</span><span class="s2">"Example Questions"</span><span class="p">)</span>
    <span class="n">st</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="s2">"- Which hospitals are in the hospital system?"</span><span class="p">)</span>
    <span class="n">st</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="s2">"- What is the current wait time at wallace-hamilton hospital?"</span><span class="p">)</span>
    <span class="n">st</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span>
        <span class="s2">"- At which hospitals are patients complaining about billing and "</span>
        <span class="s2">"insurance issues?"</span>
    <span class="p">)</span>
    <span class="n">st</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="s2">"- What is the average duration in days for closed emergency visits?"</span><span class="p">)</span>
    <span class="n">st</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span>
        <span class="s2">"- What are patients saying about the nursing staff at "</span>
        <span class="s2">"Castaneda-Hardy?"</span>
    <span class="p">)</span>
    <span class="n">st</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="s2">"- What was the total billing amount charged to each payer for 2023?"</span><span class="p">)</span>
    <span class="n">st</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="s2">"- What is the average billing amount for medicaid visits?"</span><span class="p">)</span>
    <span class="n">st</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="s2">"- Which physician has the lowest average visit duration in days?"</span><span class="p">)</span>
    <span class="n">st</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="s2">"- How much was billed for patient 789's stay?"</span><span class="p">)</span>
    <span class="n">st</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span>
        <span class="s2">"- Which state had the largest percent increase in medicaid visits "</span>
        <span class="s2">"from 2022 to 2023?"</span>
    <span class="p">)</span>
    <span class="n">st</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="s2">"- What is the average billing amount per day for Aetna patients?"</span><span class="p">)</span>
    <span class="n">st</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="s2">"- How many reviews have been written from patients in Florida?"</span><span class="p">)</span>
    <span class="n">st</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span>
        <span class="s2">"- For visits that are not missing chief complaints, "</span>
        <span class="s2">"what percentage have reviews?"</span>
    <span class="p">)</span>
    <span class="n">st</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span>
        <span class="s2">"- What is the percentage of visits that have reviews for each hospital?"</span>
    <span class="p">)</span>
    <span class="n">st</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span>
        <span class="s2">"- Which physician has received the most reviews for this visits "</span>
        <span class="s2">"they've attended?"</span>
    <span class="p">)</span>
    <span class="n">st</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="s2">"- What is the ID for physician James Cooper?"</span><span class="p">)</span>
    <span class="n">st</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span>
        <span class="s2">"- List every review for visits treated by physician 270. Don't leave any out."</span>
    <span class="p">)</span>

<span class="n">st</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">"Hospital System Chatbot"</span><span class="p">)</span>
<span class="n">st</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
    <span class="s2">"Ask me questions about patients, visits, insurance payers, hospitals, "</span>
    <span class="s2">"physicians, reviews, and wait times!"</span>
<span class="p">)</span>

<span class="k">if</span> <span class="s2">"messages"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="p">:</span>
    <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">messages</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">message</span> <span class="ow">in</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">messages</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">st</span><span class="o">.</span><span class="n">chat_message</span><span class="p">(</span><span class="n">message</span><span class="p">[</span><span class="s2">"role"</span><span class="p">]):</span>
        <span class="k">if</span> <span class="s2">"output"</span> <span class="ow">in</span> <span class="n">message</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">st</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="n">message</span><span class="p">[</span><span class="s2">"output"</span><span class="p">])</span>

        <span class="k">if</span> <span class="s2">"explanation"</span> <span class="ow">in</span> <span class="n">message</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">with</span> <span class="n">st</span><span class="o">.</span><span class="n">status</span><span class="p">(</span><span class="s2">"How was this generated"</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="s2">"complete"</span><span class="p">):</span>
                <span class="n">st</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">message</span><span class="p">[</span><span class="s2">"explanation"</span><span class="p">])</span>

<span class="k">if</span> <span class="n">prompt</span> <span class="o">:=</span> <span class="n">st</span><span class="o">.</span><span class="n">chat_input</span><span class="p">(</span><span class="s2">"What do you want to know?"</span><span class="p">):</span>
    <span class="n">st</span><span class="o">.</span><span class="n">chat_message</span><span class="p">(</span><span class="s2">"user"</span><span class="p">)</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span>

    <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">"role"</span><span class="p">:</span> <span class="s2">"user"</span><span class="p">,</span> <span class="s2">"output"</span><span class="p">:</span> <span class="n">prompt</span><span class="p">})</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"text"</span><span class="p">:</span> <span class="n">prompt</span><span class="p">}</span>

    <span class="k">with</span> <span class="n">st</span><span class="o">.</span><span class="n">spinner</span><span class="p">(</span><span class="s2">"Searching for an answer..."</span><span class="p">):</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">CHATBOT_URL</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
            <span class="n">output_text</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s2">"output"</span><span class="p">]</span>
            <span class="n">explanation</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s2">"intermediate_steps"</span><span class="p">]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">output_text</span> <span class="o">=</span> <span class="s2">"""An error occurred while processing your message.</span>
<span class="s2">            Please try again or rephrase your message."""</span>
            <span class="n">explanation</span> <span class="o">=</span> <span class="n">output_text</span>

    <span class="n">st</span><span class="o">.</span><span class="n">chat_message</span><span class="p">(</span><span class="s2">"assistant"</span><span class="p">)</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="n">output_text</span><span class="p">)</span>
    <span class="n">st</span><span class="o">.</span><span class="n">status</span><span class="p">(</span><span class="s2">"How was this generated"</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="s2">"complete"</span><span class="p">)</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">explanation</span><span class="p">)</span>

    <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">"role"</span><span class="p">:</span> <span class="s2">"assistant"</span><span class="p">,</span>
            <span class="s2">"output"</span><span class="p">:</span> <span class="n">output_text</span><span class="p">,</span>
            <span class="s2">"explanation"</span><span class="p">:</span> <span class="n">explanation</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">)</span>
</code></pre></div>
    
    <button class="codeblock__copy btn btn-outline-secondary border m-1 px-1 d-hover-only" title="Copy to clipboard"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#@copy"></use></svg></span></button>
    <template class="codeblock__copied-template"></template>
    
  </div>
</div>
<p>Learning Streamlit is not the focus of this tutorial, so you won’t get a detailed description of this code. However, here’s a high-level overview of what this UI does:</p>
<ul>
<li>The entire chat history is stored and displayed each time the user makes a new query.</li>
<li>The UI takes the user’s input and makes a synchronous POST request to the agent endpoint. </li>
<li>The most recent agent response is displayed at the bottom of the chat and appended to the chat history.</li>
<li>An explanation of how the agent generated its response it provided to the user. This is great for auditing purposes because you can see if the agent called the right tool, and you can check if the tool worked correctly.</li>
</ul>
<p>As you’ve done, you’ll create an entrypoint file to run the UI:</p>
<div class="codeblock mb-3 w-100" aria-label="Code block" data-syntax-language="sh">
  <div class="codeblock__header d-flex justify-content-between codeblock--yellow">
    <span class="mr-2 noselect" aria-label="Language">Shell</span>
    <span class="mr-2" aria-label="Filename"><code style="color: inherit;">chatbot_frontend/src/entrypoint.sh</code></span>
    <div class="noselect">
      
    </div>
  </div>
  <div style="position: relative;">
    <div class="highlight highlight--with-header"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># Run any setup steps or pre-processing tasks here</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">"Starting hospital chatbot frontend..."</span>

<span class="c1"># Run the ETL script</span>
streamlit<span class="w"> </span>run<span class="w"> </span>main.py
</code></pre></div>
    
    <button class="codeblock__copy btn btn-outline-secondary border m-1 px-1 d-hover-only" title="Copy to clipboard"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#@copy"></use></svg></span></button>
    <template class="codeblock__copied-template"></template>
    
  </div>
</div>
<p>And finally, the Docker file to create an image for the UI:</p>
<div class="codeblock mb-3 w-100" aria-label="Code block" data-syntax-language="dockerfile">
  <div class="codeblock__header d-flex justify-content-between codeblock--grey">
    <span class="mr-2 noselect" aria-label="Language">Dockerfile</span>
    <span class="mr-2" aria-label="Filename"><code style="color: inherit;">chatbot_frontend/Dockerfile</code></span>
    <div class="noselect">
      
    </div>
  </div>
  <div style="position: relative;">
    <div class="highlight highlight--with-header"><pre><span></span><code><span class="k">FROM</span><span class="w"> </span><span class="s">python:3.11-slim</span>

<span class="k">WORKDIR</span><span class="w"> </span><span class="s">/app</span>

<span class="k">COPY</span><span class="w"> </span>./src/<span class="w"> </span>/app

<span class="k">COPY</span><span class="w"> </span>./pyproject.toml<span class="w"> </span>/code/pyproject.toml
<span class="k">RUN</span><span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>/code/.

<span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">"sh"</span><span class="p">,</span><span class="w"> </span><span class="s2">"entrypoint.sh"</span><span class="p">]</span>
</code></pre></div>
    
    <button class="codeblock__copy btn btn-outline-secondary border m-1 px-1 d-hover-only" title="Copy to clipboard"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#@copy"></use></svg></span></button>
    <template class="codeblock__copied-template"></template>
    
  </div>
</div>
<p>This <code>Dockerfile</code> is identical to the previous ones you’ve created. With that, you’re ready to run your entire chatbot application end-to-end.</p>
</section><section class="section3"><h3 id="orchestrate-the-project-with-docker-compose">Orchestrate the Project With Docker Compose<a class="headerlink" href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#orchestrate-the-project-with-docker-compose" title="Permanent link"></a></h3>
<p>At this point, you’ve written all the code needed to run your chatbot. This last step is to build and run your project with <code>docker-compose</code>. Before doing so, make sure your have all of the following files and folders in your project directory:</p>
<div class="highlight"><pre><span></span><code>./
│
├── chatbot_api/
│   │
│   │
│   ├── src/
│   │   │
│   │   ├── agents/
│   │   │   └── hospital_rag_agent.py
│   │   │
│   │   ├── chains/
│   │   │   │
│   │   │   ├── hospital_cypher_chain.py
│   │   │   └── hospital_review_chain.py
│   │   │
│   │   ├── models/
│   │   │   └── hospital_rag_query.py
│   │   │
│   │   ├── tools/
│   │   │   └── wait_times.py
│   │   │
│   │   ├── utils/
│   │   │   └── async_utils.py
│   │   │
│   │   ├── entrypoint.sh
│   │   └── main.py
│   │
│   ├── Dockerfile
│   └── pyproject.toml
│
├── chatbot_frontend/
│   │
│   ├── src/
│   │   ├── entrypoint.sh
│   │   └── main.py
│   │
│   ├── Dockerfile
│   └── pyproject.toml
│
├── hospital_neo4j_etl/
│   │
│   ├── src/
│   │   ├── entrypoint.sh
│   │   └── hospital_bulk_csv_write.py
│   │
│   ├── Dockerfile
│   └── pyproject.toml
│
├── tests/
│   ├── async_agent_requests.py
│   └── sync_agent_requests.py
│
├── .env
└── docker-compose.yml
</code></pre></div>
<p>Your <code>.env</code> file should have the following environment variables. Most of them you created earlier in this tutorial, but you’ll also need to add one new one for <code>CHATBOT_URL</code> so that your Streamlit app will be able to find your API:</p>
<div class="codeblock mb-3 w-100" aria-label="Code block" data-syntax-language="dotenv">
  <div class="codeblock__header d-flex justify-content-between codeblock--grey">
    <span class="mr-2 noselect" aria-label="Language">.env</span>
    
    <div class="noselect">
      
    </div>
  </div>
  <div style="position: relative;">
    <div class="highlight highlight--with-header"><pre><span></span><code><span class="na">OPENAI_API_KEY</span><span class="o">=</span><span class="s">&lt;YOUR_OPENAI_API_KEY&gt;</span>

<span class="na">NEO4J_URI</span><span class="o">=</span><span class="s">&lt;YOUR_NEO4J_URI&gt;</span>
<span class="na">NEO4J_USERNAME</span><span class="o">=</span><span class="s">&lt;YOUR_NEO4J_USERNAME&gt;</span>
<span class="na">NEO4J_PASSWORD</span><span class="o">=</span><span class="s">&lt;YOUR_NEO4J_PASSWORD&gt;</span>

<span class="na">HOSPITALS_CSV_PATH</span><span class="o">=</span><span class="s">https://raw.githubusercontent.com/hfhoffman1144/langchain_neo4j_rag_app/main/data/hospitals.csv</span>
<span class="na">PAYERS_CSV_PATH</span><span class="o">=</span><span class="s">https://raw.githubusercontent.com/hfhoffman1144/langchain_neo4j_rag_app/main/data/payers.csv</span>
<span class="na">PHYSICIANS_CSV_PATH</span><span class="o">=</span><span class="s">https://raw.githubusercontent.com/hfhoffman1144/langchain_neo4j_rag_app/main/data/physicians.csv</span>
<span class="na">PATIENTS_CSV_PATH</span><span class="o">=</span><span class="s">https://raw.githubusercontent.com/hfhoffman1144/langchain_neo4j_rag_app/main/data/patients.csv</span>
<span class="na">VISITS_CSV_PATH</span><span class="o">=</span><span class="s">https://raw.githubusercontent.com/hfhoffman1144/langchain_neo4j_rag_app/main/data/visits.csv</span>
<span class="na">REVIEWS_CSV_PATH</span><span class="o">=</span><span class="s">https://raw.githubusercontent.com/hfhoffman1144/langchain_neo4j_rag_app/main/data/reviews.csv</span>

<span class="na">HOSPITAL_AGENT_MODEL</span><span class="o">=</span><span class="s">gpt-3.5-turbo-1106</span>
<span class="na">HOSPITAL_CYPHER_MODEL</span><span class="o">=</span><span class="s">gpt-3.5-turbo-1106</span>
<span class="na">HOSPITAL_QA_MODEL</span><span class="o">=</span><span class="s">gpt-3.5-turbo-0125</span>

<span class="hll"><span class="na">CHATBOT_URL</span><span class="o">=</span><span class="s">http://host.docker.internal:8000/hospital-rag-agent</span>
</span></code></pre></div>
    
    <button class="codeblock__copy btn btn-outline-secondary border m-1 px-1 d-hover-only" title="Copy to clipboard"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#@copy"></use></svg></span></button>
    <template class="codeblock__copied-template"></template>
    
  </div>
</div>
<p>To complete your <code>docker-compose.yml</code> file, you’ll need to add a <code>chatbot_frontend</code> service. Your final <code>docker-compose.yml</code> file should look like this:</p>
<div class="codeblock mb-3 w-100" aria-label="Code block" data-syntax-language="yaml">
  <div class="codeblock__header d-flex justify-content-between codeblock--grey">
    <span class="mr-2 noselect" aria-label="Language">YAML</span>
    <span class="mr-2" aria-label="Filename"><code style="color: inherit;">docker-compose.yml</code></span>
    <div class="noselect">
      
    </div>
  </div>
  <div style="position: relative;">
    <div class="highlight highlight--with-header"><pre><span></span><code><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">'3'</span>

<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">hospital_neo4j_etl</span><span class="p">:</span>
<span class="w">    </span><span class="nt">build</span><span class="p">:</span>
<span class="w">      </span><span class="nt">context</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./hospital_neo4j_etl</span>
<span class="w">    </span><span class="nt">env_file</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.env</span>

<span class="w">  </span><span class="nt">chatbot_api</span><span class="p">:</span>
<span class="w">    </span><span class="nt">build</span><span class="p">:</span>
<span class="w">      </span><span class="nt">context</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./chatbot_api</span>
<span class="w">    </span><span class="nt">env_file</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.env</span>
<span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hospital_neo4j_etl</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">"8000:8000"</span>

<span class="hll"><span class="w">  </span><span class="nt">chatbot_frontend</span><span class="p">:</span>
</span><span class="hll"><span class="w">    </span><span class="nt">build</span><span class="p">:</span>
</span><span class="hll"><span class="w">      </span><span class="nt">context</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./chatbot_frontend</span>
</span><span class="hll"><span class="w">    </span><span class="nt">env_file</span><span class="p">:</span>
</span><span class="hll"><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.env</span>
</span><span class="hll"><span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span>
</span><span class="hll"><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">chatbot_api</span>
</span><span class="hll"><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span class="hll"><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">"8501:8501"</span>
</span></code></pre></div>
    
    <button class="codeblock__copy btn btn-outline-secondary border m-1 px-1 d-hover-only" title="Copy to clipboard"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#@copy"></use></svg></span></button>
    <template class="codeblock__copied-template"></template>
    
  </div>
</div>
<p>Finally, open a terminal and run:</p>
<div class="codeblock mb-3 w-100" aria-label="Code block" data-syntax-language="console" data-is-repl="true">
  <div class="codeblock__header d-flex justify-content-between codeblock--yellow">
    <span class="mr-2 noselect" aria-label="Language">Shell</span>
    
    <div class="noselect">
      
        <span class="codeblock__output-toggle" title="Toggle prompts and output"><span class="icon baseline js-codeblock-output-on codeblock__header--icon-lower"><svg><use href="/static/icons.67f62bbffdec.svg#regular--rectangle-terminal"></use></svg></span></span>
      
    </div>
  </div>
  <div style="position: relative;">
    <div class="highlight highlight--with-header"><pre><span></span><code><span class="gp">$ </span>docker-compose<span class="w"> </span>up<span class="w"> </span>--build
</code></pre></div>
    
    <button class="codeblock__copy btn btn-outline-secondary border m-1 px-1 d-hover-only" title="Copy to clipboard"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#@copy"></use></svg></span></button>
    <template class="codeblock__copied-template"></template>
    
  </div>
</div>
<p>Once everything builds and runs, you can access the UI at <code>http://localhost:8501/</code> and begin chatting with your chatbot:</p>
<figure class="js-lightbox"><a href="./Build an LLM RAG Chatbot With LangChain – Real Python_files/Screenshot_2024-01-14_at_8.53.00_PM.4d035582b8ce.png" target="_blank"><img loading="lazy" class="img-fluid mx-auto d-block " src="./Build an LLM RAG Chatbot With LangChain – Real Python_files/Screenshot_2024-01-14_at_8.53.00_PM.4d035582b8ce.png" width="3172" height="1710" srcset="https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/Screenshot_2024-01-14_at_8.53.00_PM.4d035582b8ce.png&amp;w=793&amp;sig=f2f01143f5656fdf371f17dedaa9a5682b913fa7 793w, https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/Screenshot_2024-01-14_at_8.53.00_PM.4d035582b8ce.png&amp;w=1057&amp;sig=9cf1c2d751951926146dfc7a7b25c9e6b720e18b 1057w, https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/Screenshot_2024-01-14_at_8.53.00_PM.4d035582b8ce.png&amp;w=1586&amp;sig=3396be067ea7c0b35d82784331aa7ce9430da50c 1586w, https://files.realpython.com/media/Screenshot_2024-01-14_at_8.53.00_PM.4d035582b8ce.png 3172w" sizes="(min-width: 1200px) 690px, (min-width: 780px) calc(-5vw + 669px), (min-width: 580px) 510px, calc(100vw - 30px)" alt="Working chatbot" data-asset="5647"></a><figcaption class="figure-caption text-center">Working hospital system chatbot</figcaption></figure>

<p>You’ve built a fully functioning hospital system chatbot end-to-end. Take some time to ask it questions, see the kinds of questions it’s good at answering, find out where it fails, and think about how you might improve it with better prompting or data. You can start by making sure the example questions in the sidebar are answered successfully.</p>
</section></section><section class="section2"><h2 id="conclusion">Conclusion<a class="headerlink" href="https://realpython.com/build-llm-rag-chatbot-with-langchain/#conclusion" title="Permanent link"></a></h2>
<p>Congratulations on completing this in-depth tutorial!</p>
<p>You’ve successfully designed, built, and served a RAG LangChain chatbot that answers questions about a fake hospital system. There are certainly many ways you can improve the chatbot you built in this tutorial, but you now have a sound understanding of how to integrate LangChain with your own data, giving you the creative freedom to build all kinds of custom chatbots.</p>
<p><strong>In this tutorial, you’ve learned how to:</strong></p>
<ul>
<li>Use <strong>LangChain</strong> to build personalized <strong>chatbots</strong>.</li>
<li>Create a chatbot for a fake hospital system by aligning with <strong>business requirements</strong> and <strong>leveraging available data</strong>.</li>
<li>Consider the implementation of <strong>graph databases</strong> in your chatbot design.</li>
<li>Set up a <strong>Neo4j AuraDB</strong> instance for your project.</li>
<li>Develop a <strong>RAG</strong> chatbot capable of fetching both <strong>structured</strong> and <strong>unstructured</strong> data from Neo4j.</li>
<li>Deploy your chatbot using <strong>FastAPI</strong> and <strong>Streamlit</strong>.</li>
</ul>
<p>You can find the complete source code and data for this project, in the supporting materials, which you can download using the link below:</p>
<div class="alert alert-warning" role="alert">
<p><strong markdown="1">Get Your Code:</strong> <a href="https://realpython.com/bonus/build-llm-rag-chatbot-with-langchain-code/" class="alert-link" data-toggle="modal" data-target="#modal-build-llm-rag-chatbot-with-langchain-code" data-focus="false" markdown="1">Click here to download the free source code</a> for your LangChain chatbot.</p>
</div>
</section>

    
      
      <div class="text-center my-3">
        
<div class="jsCompletionStatusWidget btn-group mb-0">
  <button title="Click to mark as completed" class="jsBtnCompletion btn btn-secondary border-right" style="border-top-right-radius: 0; border-bottom-right-radius: 0;">Mark as Completed</button>
  <button title="Add bookmark" class="jsBtnBookmark btn btn-secondary border-left"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#light--bookmark"></use></svg></span></button>
</div>

        <span class="ml-2">
<div class="btn-group mb-0">
  <a class="btn btn-secondary border-right" style="border-top-right-radius: 0; border-bottom-right-radius: 0;" title="Liked it" role="button" aria-label="Thumbs up (liked it)" href="https://realpython.com/feedback/survey/article/build-llm-rag-chatbot-with-langchain/liked/?from=article-footer" target="_blank"><span class="icon"><svg><use href="/static/icons.67f62bbffdec.svg#light--thumbs-up"></use></svg></span></a> 
  <a class="btn btn-secondary border-left" role="button" aria-label="Thumbs down (disliked it)" title="Disliked it" href="https://realpython.com/feedback/survey/article/build-llm-rag-chatbot-with-langchain/disliked/?from=article-footer" target="_blank"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#light--thumbs-down"></use></svg></span></a>
</div>
</span>
      </div>
    

    
  </div>

  
    

<div class="card mt-4 mb-4 bg-secondary">
  <p class="card-header h3 text-center bg-light">🐍 Python Tricks 💌</p>
  <div class="card-body">
    <div class="container">
      <div class="row">
        <div class="col-xs-12 col-sm-7">
          <p>Get a short &amp; sweet <strong>Python Trick</strong> delivered to your inbox every couple of days. No spam ever. Unsubscribe any time. Curated by the Real Python team.</p>
        </div>
        <div class="col-xs-12 col-sm-5">
          <img loading="lazy" class="img-fluid rounded mb-3" src="./Build an LLM RAG Chatbot With LangChain – Real Python_files/pytrick-dict-merge.webp" width="738" height="490" alt="Python Tricks Dictionary Merge">
        </div>
      </div>
      <div class="row mb-3">
        <form class="col-12" action="https://realpython.com/optins/process/" method="post">
          <input type="hidden" name="csrfmiddlewaretoken" value="KV2gamRumCgJkMjOxEKxpyzE5kh0zbd6LLDrApShhsxqaR8gtZebMfI086Za77AV">
          <input type="hidden" name="slug" value="static-python-tricks-footer">
          <div class="form-group">
            <input name="email" type="email" class="form-control form-control-lg" placeholder="Email Address" required="">
          </div>
          <button name="submit" type="submit" class="btn btn-primary btn-lg btn-block">Send Me Python Tricks »</button>
        </form>
      </div>
    </div>
  </div>
</div>


  

  



<div class="card mt-3" id="author">
  <p class="card-header h3">About <strong>Harrison Hoffman</strong></p>
  <div class="card-body">
    <div class="container p-0">
      <div class="row">
        <div class="col-12 col-md-3 align-self-center">
          <a href="https://realpython.com/team/hhoffman/"><img loading="lazy" src="./Build an LLM RAG Chatbot With LangChain – Real Python_files/saved_resource(1)" srcset="https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/Screenshot_2024-01-17_at_9.18.04_AM.7a08390ba349.png&amp;w=151&amp;h=151&amp;mode=crop&amp;sig=180f21c9729d71568de0467639ae80b7ebf22e41 151w, https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/Screenshot_2024-01-17_at_9.18.04_AM.7a08390ba349.png&amp;w=201&amp;h=201&amp;mode=crop&amp;sig=a2dfd5cc2b53c63583dabe8b57c63dbeb4f42132 201w, https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/Screenshot_2024-01-17_at_9.18.04_AM.7a08390ba349.png&amp;w=302&amp;h=302&amp;mode=crop&amp;sig=120e47b52fff39a07bd2943b218e9f1f8f6bb53e 302w, https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/Screenshot_2024-01-17_at_9.18.04_AM.7a08390ba349.png&amp;w=605&amp;h=605&amp;mode=crop&amp;sig=9c1a6b9e3fdc690057c5363e95e70e01ab998848 605w" sizes="(min-width: 580px) 154px, calc(33.08vw - 24px)" width="605" height="605" style="background: #a4a9ac;" class="d-block d-md-none rounded-circle img-fluid w-33 mb-0 mx-auto" alt="Harrison Hoffman"></a>
          <a href="https://realpython.com/team/hhoffman/"><img loading="lazy" src="./Build an LLM RAG Chatbot With LangChain – Real Python_files/saved_resource(1)" srcset="https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/Screenshot_2024-01-17_at_9.18.04_AM.7a08390ba349.png&amp;w=151&amp;h=151&amp;mode=crop&amp;sig=180f21c9729d71568de0467639ae80b7ebf22e41 151w, https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/Screenshot_2024-01-17_at_9.18.04_AM.7a08390ba349.png&amp;w=201&amp;h=201&amp;mode=crop&amp;sig=a2dfd5cc2b53c63583dabe8b57c63dbeb4f42132 201w, https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/Screenshot_2024-01-17_at_9.18.04_AM.7a08390ba349.png&amp;w=302&amp;h=302&amp;mode=crop&amp;sig=120e47b52fff39a07bd2943b218e9f1f8f6bb53e 302w, https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/Screenshot_2024-01-17_at_9.18.04_AM.7a08390ba349.png&amp;w=605&amp;h=605&amp;mode=crop&amp;sig=9c1a6b9e3fdc690057c5363e95e70e01ab998848 605w" sizes="(min-width: 1200px) 140px, calc(-1.5vw + 137px)" width="605" height="605" style="background: #a4a9ac;" class="d-none d-md-block rounded-circle img-fluid w-100 mb-0" alt="Harrison Hoffman"></a>
        </div>
        <div class="col mt-3">
          <p>Harrison is an avid Pythonista, Data Scientist, and Real Python contributor. He has a background in mathematics, machine learning, and software development. Harrison lives in Texas with his wife, identical twin daughters, and two dogs.</p>
          <a href="https://realpython.com/team/hhoffman/" class="card-link">» More about Harrison</a>
        </div>
      </div>
    </div>
  </div>
  
  <hr class="my-0">
  <div class="card-body pb-0">
    <div class="container">
      <div class="row">
        <p><em>Each tutorial at Real Python is created by a team of developers so that it meets our high quality standards. The team members who worked on this tutorial are:</em></p>
      </div>

      
        
          <div class="row align-items-center w-100 mx-auto">
        

        <div class="col-4 col-sm-2 align-self-center">
          
            <a href="https://realpython.com/team/asantos/"><img loading="lazy" src="./Build an LLM RAG Chatbot With LangChain – Real Python_files/saved_resource(2)" srcset="https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/PP.9b8b026f75b8.jpg&amp;w=239&amp;h=239&amp;mode=crop&amp;sig=11667a6dd5c29e4c9363f18be59360551af5eddc 239w, https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/PP.9b8b026f75b8.jpg&amp;w=319&amp;h=319&amp;mode=crop&amp;sig=3b626fde72a314418766c7d4a14e58ec6f67da7b 319w, https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/PP.9b8b026f75b8.jpg&amp;w=479&amp;h=479&amp;mode=crop&amp;sig=1541e1ec541357813def826d8507c0565164b701 479w, https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/PP.9b8b026f75b8.jpg&amp;w=959&amp;h=959&amp;mode=crop&amp;sig=70bedc2eab90a227eb9a657c415689c3eb1eca4f 959w" sizes="(min-width: 1200px) 73px, (min-width: 780px) calc(-0.75vw + 69px), (min-width: 580px) 43px, calc(33.46vw - 64px)" width="959" height="959" style="background: #dadad8;" class="rounded-circle img-fluid w-100" alt="Aldren Santos"></a>
          
        </div>
        <div class="col pl-0 d-none d-sm-block">
          <a href="https://realpython.com/team/asantos/" class="card-link small"><p>Aldren</p></a>
        </div>

        

        
      
        

        <div class="col-4 col-sm-2 align-self-center">
          
            <a href="https://realpython.com/team/bweleschuk/"><img loading="lazy" src="./Build an LLM RAG Chatbot With LangChain – Real Python_files/saved_resource(3)" srcset="https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/IMG_3324_1.50b309355fc1.jpg&amp;w=80&amp;h=80&amp;mode=crop&amp;sig=30bc8370b84ce2302f9f08f097f9bf4a24227568 80w, https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/IMG_3324_1.50b309355fc1.jpg&amp;w=106&amp;h=106&amp;mode=crop&amp;sig=e32037516e2180a8e6ce53c5baaed66d0fdcb227 106w, https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/IMG_3324_1.50b309355fc1.jpg&amp;w=160&amp;h=160&amp;mode=crop&amp;sig=d3086574ce2502a04f8955bc0725176e8ff2aff9 160w, https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/IMG_3324_1.50b309355fc1.jpg&amp;w=320&amp;h=320&amp;mode=crop&amp;sig=f8992044d06cd46753b261c1d0f2f47e0eeebd69 320w" sizes="(min-width: 1200px) 73px, (min-width: 780px) calc(-0.75vw + 69px), (min-width: 580px) 43px, calc(33.46vw - 64px)" width="320" height="320" style="background: #d6d4ad;" class="rounded-circle img-fluid w-100" alt="Brenda Weleschuk"></a>
          
        </div>
        <div class="col pl-0 d-none d-sm-block">
          <a href="https://realpython.com/team/bweleschuk/" class="card-link small"><p>Brenda</p></a>
        </div>

        

        
      
        

        <div class="col-4 col-sm-2 align-self-center">
          
            <a href="https://realpython.com/team/gahjelle/"><img loading="lazy" src="./Build an LLM RAG Chatbot With LangChain – Real Python_files/saved_resource(4)" srcset="https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/gahjelle.470149ee709e.jpg&amp;w=200&amp;h=200&amp;mode=crop&amp;sig=c6390201e73d3e09429d73da5bb29c17ab10403a 200w, https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/gahjelle.470149ee709e.jpg&amp;w=266&amp;h=266&amp;mode=crop&amp;sig=7df7c39b123c3f9d8a4597311d09c3bd947f5fac 266w, https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/gahjelle.470149ee709e.jpg&amp;w=400&amp;h=400&amp;mode=crop&amp;sig=fcea459ee24a7b320573cadee324cf75509dc1d6 400w, https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/gahjelle.470149ee709e.jpg&amp;w=800&amp;h=800&amp;mode=crop&amp;sig=e9b761c6cf1359953014dba05554f5424eb116e1 800w" sizes="(min-width: 1200px) 73px, (min-width: 780px) calc(-0.75vw + 69px), (min-width: 580px) 43px, calc(33.46vw - 64px)" width="800" height="800" style="background: #080a09;" class="rounded-circle img-fluid w-100" alt="Geir Arne Hjelle"></a>
          
        </div>
        <div class="col pl-0 d-none d-sm-block">
          <a href="https://realpython.com/team/gahjelle/" class="card-link small"><p>Geir Arne</p></a>
        </div>

        

        
          </div>
        
      
        
          <div class="row align-items-center w-100 mx-auto">
        

        <div class="col-4 col-sm-2 align-self-center">
          
            <a href="https://realpython.com/team/kfinegan/"><img loading="lazy" src="./Build an LLM RAG Chatbot With LangChain – Real Python_files/saved_resource(5)" srcset="https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/VZxEtUor_400x400.7169c68e3950.jpg&amp;w=100&amp;h=100&amp;mode=crop&amp;sig=d9cf1b0b2fe0e552070ab0b5a15b72c54464c74c 100w, https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/VZxEtUor_400x400.7169c68e3950.jpg&amp;w=133&amp;h=133&amp;mode=crop&amp;sig=3cd149905e33db75311cae968f3e5edf76962663 133w, https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/VZxEtUor_400x400.7169c68e3950.jpg&amp;w=200&amp;h=200&amp;mode=crop&amp;sig=4e6d62ae536e46bd62dac2b283f8ea57536c1c5e 200w, https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/VZxEtUor_400x400.7169c68e3950.jpg&amp;w=400&amp;h=400&amp;mode=crop&amp;sig=dfa9b806107d5d44e9a4750b9618a2614153164b 400w" sizes="(min-width: 1200px) 73px, (min-width: 780px) calc(-0.75vw + 69px), (min-width: 580px) 43px, calc(33.46vw - 64px)" width="400" height="400" style="background: #d8d3d7;" class="rounded-circle img-fluid w-100" alt="Kate Finegan"></a>
          
        </div>
        <div class="col pl-0 d-none d-sm-block">
          <a href="https://realpython.com/team/kfinegan/" class="card-link small"><p>Kate</p></a>
        </div>

        

        
      
        

        <div class="col-4 col-sm-2 align-self-center">
          
            <a href="https://realpython.com/team/mbreuss/"><img loading="lazy" src="./Build an LLM RAG Chatbot With LangChain – Real Python_files/saved_resource(6)" srcset="https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/martin_breuss_python_square.efb2b07faf9f.jpg&amp;w=114&amp;h=114&amp;mode=crop&amp;sig=1a2362c5f4fdf6550020fa2edf1cbed47bffdf53 114w, https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/martin_breuss_python_square.efb2b07faf9f.jpg&amp;w=152&amp;h=152&amp;mode=crop&amp;sig=0d6fc7f31ab06da4c938b5632c7bafe99a0552eb 152w, https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/martin_breuss_python_square.efb2b07faf9f.jpg&amp;w=228&amp;h=228&amp;mode=crop&amp;sig=83e21635985e51035377eed031afa8feae263333 228w, https://robocrop.realpython.net/?url=https%3A//files.realpython.com/media/martin_breuss_python_square.efb2b07faf9f.jpg&amp;w=456&amp;h=456&amp;mode=crop&amp;sig=f73f6ae668249c7ab9ff74c61ea5ae7c5d360d54 456w" sizes="(min-width: 1200px) 73px, (min-width: 780px) calc(-0.75vw + 69px), (min-width: 580px) 43px, calc(33.46vw - 64px)" width="456" height="456" style="background: #f1f8fe;" class="rounded-circle img-fluid w-100" alt="Martin Breuss"></a>
          
        </div>
        <div class="col pl-0 d-none d-sm-block">
          <a href="https://realpython.com/team/mbreuss/" class="card-link small"><p>Martin</p></a>
        </div>

        
          
          
            <div class="col-4 col-sm-2 align-self-center"></div>
            <div class="col pl-0 d-none d-sm-block"></div>
          
        

        
          </div>
        
      
    </div>
  </div>
  

</div>





  
    

<div class="bg-light rounded py-4 my-4 shadow shadow-sm mx-n2">
  
  <div class="col-12 text-center d-block d-md-none">
    <p class="h2 mb-3">Master <u><span class="marker-highlight">Real-World Python Skills</span></u> With Unlimited Access to Real&nbsp;Python</p>
    <p class="mb-1"><img loading="lazy" class="w-75" src="./Build an LLM RAG Chatbot With LangChain – Real Python_files/lesson-locked.f5105cfd26db.svg" width="510" height="260"></p>
    <p class="mx-auto w-75 mb-3 small"><strong>Join us and get access to thousands of tutorials, hands-on video courses, and a community of expert&nbsp;Pythonistas:</strong></p>
    <p class="mb-0"><a href="https://realpython.com/account/join/?utm_source=rp_article_footer&amp;utm_content=build-llm-rag-chatbot-with-langchain" class="btn btn-primary btn-sm px-4 mb-0">Level Up Your Python Skills »</a>
  </p></div>

  
  <div class="col-12 text-center d-none d-md-block">
    <p class="h2 mb-2">Master <u><span class="marker-highlight">Real-World Python Skills</span></u><br>With Unlimited Access to Real&nbsp;Python</p>
    <p class="mb-2"><img loading="lazy" class="w-50 mb-2" src="./Build an LLM RAG Chatbot With LangChain – Real Python_files/lesson-locked.f5105cfd26db.svg" width="510" height="260"></p>
    <p class="mx-auto w-50 mb-3"><strong>Join us and get access to thousands of tutorials, hands-on video courses, and a community of expert Pythonistas:</strong></p>
    <p><a href="https://realpython.com/account/join/?utm_source=rp_article_footer&amp;utm_content=build-llm-rag-chatbot-with-langchain" class="btn btn-primary btn-lg px-4">Level Up Your Python Skills »</a>
  </p></div>
</div>

  

  
  <div class="card mt-4" id="reader-comments">
    <p class="card-header h3">What Do You Think?</p>
    
    <div class="text-center mt-3 mb-0 p-0">
      <div class="mb-2">
        <strong class="mr-2">Rate this article:</strong>
        
<div class="btn-group mb-0">
  <a class="btn btn-secondary border-right" style="border-top-right-radius: 0; border-bottom-right-radius: 0;" title="Liked it" role="button" aria-label="Thumbs up (liked it)" href="https://realpython.com/feedback/survey/article/build-llm-rag-chatbot-with-langchain/liked/?from=article-comments" target="_blank"><span class="icon"><svg><use href="/static/icons.67f62bbffdec.svg#light--thumbs-up"></use></svg></span></a> 
  <a class="btn btn-secondary border-left" role="button" aria-label="Thumbs down (disliked it)" title="Disliked it" href="https://realpython.com/feedback/survey/article/build-llm-rag-chatbot-with-langchain/disliked/?from=article-comments" target="_blank"><span class="icon baseline"><svg><use href="/static/icons.67f62bbffdec.svg#light--thumbs-down"></use></svg></span></a>
</div>

      </div>
      



<div class="text-center my-3">
  <span>
    
    
    <a target="_blank" rel="nofollow" href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Frealpython.com%2Fbuild-llm-rag-chatbot-with-langchain%2F" class="mr-1 btn btn-sm badge-linkedin text-light mb-1"><span class="icon baseline mr-1 text-light"><svg><use href="/static/icons.67f62bbffdec.svg#brands--linkedin"></use></svg></span>LinkedIn</a>
    
    
    <a target="_blank" rel="nofollow" href="https://twitter.com/intent/tweet/?text=Interesting%20Python%20article%20on%20%40realpython%3A%20Build%20an%20LLM%20RAG%20Chatbot%20With%20LangChain&amp;url=https%3A%2F%2Frealpython.com%2Fbuild-llm-rag-chatbot-with-langchain%2F" class="mr-1 btn btn-sm badge-x-twitter text-light mb-1"><span class="icon baseline mr-1 text-light"><svg><use href="/static/icons.67f62bbffdec.svg#brands--x-twitter"></use></svg></span>Twitter</a>
    
    
    <a target="_blank" rel="nofollow" href="https://facebook.com/sharer/sharer.php?u=https%3A%2F%2Frealpython.com%2Fbuild-llm-rag-chatbot-with-langchain%2F" class="mr-1 btn btn-sm badge-facebook text-light mb-1"><span class="icon baseline mr-1 text-light"><svg><use href="/static/icons.67f62bbffdec.svg#brands--facebook"></use></svg></span>Facebook</a>
    
    
    <a target="_blank" rel="nofollow" href="mailto:?subject=Python%20article%20for%20you&amp;body=Build%20an%20LLM%20RAG%20Chatbot%20With%20LangChain%20on%20Real%20Python%0A%0Ahttps%3A%2F%2Frealpython.com%2Fbuild-llm-rag-chatbot-with-langchain%2F%0A" class="mr-1 btn btn-sm badge-dark text-light mb-1"><span class="icon baseline mr-1 text-light"><svg><use href="/static/icons.67f62bbffdec.svg#solid--envelope"></use></svg></span>Email</a>
    
    
  </span>
</div>

    </div>
    
    <div class="card-body">
      <p>What’s your #1 takeaway or favorite thing you learned? How are you going to put your newfound skills to use? Leave a comment below and let us know.</p>

      <div class="alert alert-dark">
        <p class="mb-0"><strong>Commenting Tips:</strong> The most useful comments are those written with the goal of learning from or helping out other students. <a href="https://realpython.com/python-beginner-tips/#tip-9-ask-good-questions" target="_blank">Get tips for asking good questions</a> and <a href="https://support.realpython.com/" target="_blank">get answers to common questions in our support portal</a>.</p><hr>Looking for a real-time conversation? Visit the <a href="https://realpython.com/community/" target="_blank">Real Python Community Chat</a> or join the next <a href="https://realpython.com/office-hours/" target="_blank">“Office&nbsp;Hours” Live Q&amp;A Session</a>. Happy Pythoning!<p></p>

      </div>

      <div class="mb-4" id="disqus_thread">
      
      </div>
      
    </div>
  </div>

  <div class="card mt-4 mb-4">
    <p class="card-header h3">Keep Learning</p>
    <div class="card-body">
      <p class="mb-0">Related Tutorial Categories:
      
        <a href="https://realpython.com/tutorials/databases/" class="badge badge-light text-muted">databases</a>
      
        <a href="https://realpython.com/tutorials/data-science/" class="badge badge-light text-muted">data-science</a>
      
        <a href="https://realpython.com/tutorials/intermediate/" class="badge badge-light text-muted">intermediate</a>
      
      </p>
      
    </div>
  </div>

  
    
    
      
<div class="modal fade" tabindex="-1" role="dialog" id="rpvc">
  <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
    <div class="modal-content">

      <div class="modal-header border-0">
        <div class="col-12 col-lg-9 mx-auto modal-title text-center my-2">
          <h2 class="my-0">Master <u>Real-World Python Skills</u> With Unlimited Access to Real Python</h2>
        </div>
      </div>

      
      <div class="modal-body bg-light">
        <div class="col-12 text-center">

          <div class="col-12 col-lg-8 mx-auto mb-2 mt-3">
            <a href="https://realpython.com/account/join/?utm_source=rp&amp;utm_medium=web&amp;utm_campaign=pwn&amp;utm_content=v2&amp;next=%2Fbuild-llm-rag-chatbot-with-langchain%2F"><img loading="lazy" class="w-100" src="./Build an LLM RAG Chatbot With LangChain – Real Python_files/lesson-locked.f5105cfd26db.svg" width="510" height="260" alt="Unlock all content"></a>

            <p class="mb-3"><strong>Join us and get access to thousands of tutorials, hands-on video courses, and a community of expert Pythonistas:</strong></p>
          </div>

          <p><a href="https://realpython.com/account/join/?utm_source=rp&amp;utm_medium=web&amp;utm_campaign=pwn&amp;utm_content=v2" class="btn btn-primary btn-lg px-4"><span class="icon baseline mr-2"><svg><use href="/static/icons.67f62bbffdec.svg#@unlock"></use></svg></span>Unlock All Content »</a></p>

        </div>
      </div>
      

      <div class="modal-footer border-0">
        <button class="text-muted btn" data-dismiss="modal">Close</button>
      </div>

    </div>
  </div>
</div>

      <script src="./Build an LLM RAG Chatbot With LangChain – Real Python_files/pw.0223a05a2ced.js" async=""></script>
    
  


    </div>

  </div>

    </div>

    
    

    
    
      
        
          <div class="modal fade" id="modal-build-llm-rag-chatbot-with-langchain-code" tabindex="-1" aria-labelledby="modal-build-llm-rag-chatbot-with-langchain-code-title" aria-describedby="modal-build-llm-rag-chatbot-with-langchain-code-desc">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">

      <div class="modal-header bg-light pt-3 pb-2">
        <div class="container-fluid">
          <div class="row">
            <div class="col-12">
              <div class="progress" style="height: .5rem;" aria-hidden="true">
                <div class="progress-bar progress-bar-striped progress-bar-animated w-75" role="progressbar"></div>
              </div>
            </div>
            <div class="col-12">
              <p id="modal-build-llm-rag-chatbot-with-langchain-code-desc" class="text-muted text-center mb-0 mt-2">Almost there! Complete this form and click the button below to gain instant&nbsp;access:</p>
            </div>
          </div>
        </div>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">×</span>
        </button>
      </div>

      <div class="modal-body m-4">
        <div class="container-fluid">
          <div class="row align-items-center text-center">
            <div class="col-12 col-lg-4 mb-4 mb-lg-0">
              
              
                <img loading="lazy" class="img-fluid rounded" src="./Build an LLM RAG Chatbot With LangChain – Real Python_files/Build-a-LLM-Application-with-LangChain_Watermarked.b9d023202ad2.jpg" width="1920" height="1080" srcset="/cdn-cgi/image/width=480,format=auto/https://files.realpython.com/media/Build-a-LLM-Application-with-LangChain_Watermarked.b9d023202ad2.jpg 480w, /cdn-cgi/image/width=640,format=auto/https://files.realpython.com/media/Build-a-LLM-Application-with-LangChain_Watermarked.b9d023202ad2.jpg 640w, /cdn-cgi/image/width=960,format=auto/https://files.realpython.com/media/Build-a-LLM-Application-with-LangChain_Watermarked.b9d023202ad2.jpg 960w, /cdn-cgi/image/width=1920,format=auto/https://files.realpython.com/media/Build-a-LLM-Application-with-LangChain_Watermarked.b9d023202ad2.jpg 1920w" sizes="(min-width: 1000px) 207px, (min-width: 580px) 382px, calc(100vw - 134px)" alt="Build an LLM RAG Chatbot With LangChain">
              
            </div>
            <div class="col">
              <p id="modal-build-llm-rag-chatbot-with-langchain-code-title" class="text-center h3 mb-4">Build an LLM RAG Chatbot With LangChain (Source Code)</p>

              <form class="col-12" action="https://realpython.com/optins/process/" method="post">
                <input type="hidden" name="csrfmiddlewaretoken" value="KV2gamRumCgJkMjOxEKxpyzE5kh0zbd6LLDrApShhsxqaR8gtZebMfI086Za77AV">
                <input type="hidden" name="slug" value="build-llm-rag-chatbot-with-langchain-code">
                <input type="hidden" name="source_path" value="/build-llm-rag-chatbot-with-langchain/"> 
                <div class="form-group">
                  <input type="email" name="email" class="form-control" placeholder="Email Address" required="" autofocus="">
                </div>
                <button name="submit" type="submit" class="btn btn-primary btn-block text-wrap">Send Code »</button>
                <p class="mb-0 mt-2 text-muted text-center"><small>🔒 No spam. We take your privacy seriously.</small></p>
              </form>

            </div>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>

        
      
    

    
      
<footer class="footer">
  <div class="container">
    
      <div class="mx-auto mt-4 mb-0" style="max-width: 768px;">
        

<div style="display:block;position:relative;">
  <div style="display:block;width:100%;padding-top:12.5%;"></div>
  <div class="rpad rounded border" data-unit="8x1" style="position:absolute;left:0;top:0;right:0;bottom:0;overflow:hidden;"></div>
</div>
<a class="small text-muted" href="https://realpython.com/account/join/" rel="nofollow"><span class="icon baseline mr-1"><svg><use href="/static/icons.67f62bbffdec.svg#solid--circle-info"></use></svg></span>Remove ads</a>


      </div>
    

    <p class="text-center text-muted w-75 mx-auto">© 2012–2024 Real&nbsp;Python&nbsp;⋅ <a href="https://realpython.com/newsletter/">Newsletter</a>&nbsp;⋅ <a href="https://realpython.com/podcasts/rpp/">Podcast</a>&nbsp;⋅ <a href="https://www.youtube.com/realpython">YouTube</a>&nbsp;⋅ <a href="https://twitter.com/realpython">Twitter</a>&nbsp;⋅ <a href="https://facebook.com/LearnRealPython">Facebook</a>&nbsp;⋅ <a href="https://www.instagram.com/realpython/">Instagram</a>&nbsp;⋅ <a href="https://realpython.com/">Python&nbsp;Tutorials</a>&nbsp;⋅ <a href="https://realpython.com/search">Search</a>&nbsp;⋅ <a href="https://realpython.com/privacy-policy/">Privacy Policy</a>&nbsp;⋅ <a href="https://realpython.com/energy-policy/">Energy Policy</a>&nbsp;⋅ <a href="https://realpython.com/sponsorships/">Advertise</a>&nbsp;⋅ <a href="https://realpython.com/contact/">Contact</a><br><span class="icon baseline text-color-red"><svg><use href="/static/icons.67f62bbffdec.svg#solid--heart"></use></svg></span> Happy Pythoning!</p>
  </div>
</footer>

    

    

    
    <script>
      (function() {
        var isAndroid = navigator.userAgent.toLowerCase().indexOf("android") > -1;
        if (!isAndroid) {
          return;
        }

        var styles = `
        @font-face {
          font-family: 'DejaVu Sans Mono';
          font-weight: normal;
          font-style: normal;
          font-display: swap;
          src: url('/static/mfonts/dejavu-sans-mono.33f00225f915.woff2') format('woff2'),
               url('/static/mfonts/dejavu-sans-mono.0da77d3739f3.woff') format('woff'),
               url('/static/mfonts/dejavu-sans-mono.c2356fc49835.ttf') format('truetype');
        }
        code, kbd, pre, samp {
          font-family: 'DejaVu Sans Mono', monospace;
        }
        `

        var styleSheet = document.createElement("style")
        styleSheet.type = "text/css"
        styleSheet.innerText = styles
        document.head.appendChild(styleSheet)
      })();
    </script>

    
    
    <script src="./Build an LLM RAG Chatbot With LangChain – Real Python_files/jquery.min.2c872dbe60f4.js"></script>
    <script src="./Build an LLM RAG Chatbot With LangChain – Real Python_files/popper.min.47dc3aaf2942.js"></script>
    <script src="./Build an LLM RAG Chatbot With LangChain – Real Python_files/bootstrap.min.a3b2689424c3.js"></script>

    
    

    <script>
    (function() {
      document.querySelectorAll(".js-search-form-submit").forEach(function(el) {
        el.addEventListener("click", function(e) {
          e.preventDefault();
          e.currentTarget.parentElement.submit();
        })
      });
    })();
    </script>
    <script src="./Build an LLM RAG Chatbot With LangChain – Real Python_files/codeblock.5c8399b698d9.js" async=""></script>
    <script src="./Build an LLM RAG Chatbot With LangChain – Real Python_files/lightbox.5387b5824229.js" async=""></script>
    <script src="./Build an LLM RAG Chatbot With LangChain – Real Python_files/platforms-ui.b11202dc6079.js" async=""></script>
    
    <script src="./Build an LLM RAG Chatbot With LangChain – Real Python_files/session.58839787c740.js" async=""></script>
    

    


    

    
    

    

    
    

    
    

<script>window.rp_prop_id = '58946116052';</script>
<script src="./Build an LLM RAG Chatbot With LangChain – Real Python_files/tag.js" async=""></script>



<script src="./Build an LLM RAG Chatbot With LangChain – Real Python_files/toc-refresh.f019e7905d90.js" async=""></script>

<script id="js-context" type="application/json">{"is_completed": false, "is_bookmarked": false, "api_article_bookmark_url": "/api/v1/articles/build-llm-rag-chatbot-with-langchain/bookmark/", "api_article_completion_status_url": "/api/v1/articles/build-llm-rag-chatbot-with-langchain/completion_status/", "api_article_progress_url": "/api/v1/articles/build-llm-rag-chatbot-with-langchain/progress/"}</script>
<script src="./Build an LLM RAG Chatbot With LangChain – Real Python_files/completion-status.2633fbb953d0.js" async=""></script>


  <script src="./Build an LLM RAG Chatbot With LangChain – Real Python_files/progress.36ae40be5b28.js" async=""></script>





  
    <script id="dsq-count-scr" src="./Build an LLM RAG Chatbot With LangChain – Real Python_files/count.js" async=""></script>
    <script>
      var disqus_config = function () {
        this.page.url = 'https://realpython.com/build-llm-rag-chatbot-with-langchain/';
        this.page.identifier = 'https://realpython.com/build-llm-rag-chatbot-with-langchain/';
        this.callbacks.onReady = [function() {
          if (window.onDisqusReady) {
            window.onDisqusReady();
          }
        }];
      };
      var disqus_script_url = 'https://realpython.disqus.com/embed.js';
    </script>
    <script src="./Build an LLM RAG Chatbot With LangChain – Real Python_files/lazy-disqus.3fe3de69e183.js" defer=""></script>
  


  
  
  <script src="./Build an LLM RAG Chatbot With LangChain – Real Python_files/OneSignalSDK.page.js" defer=""></script>
  <script>
    window.OneSignalDeferred = window.OneSignalDeferred || [];
    OneSignalDeferred.push(function(OneSignal) {
      OneSignal.init({
        appId: "c0081e20-a523-42bb-b0ac-04c5a9e8bf40",
        safari_web_id: "web.onesignal.auto.337e82fd-eeda-48f8-8fe5-d2f6dec774c2",
        notifyButton: {
          enable: true,
          position: "bottom-left",
          showCredit: false,
          text: {
            "tip.state.unsubscribed": "Receive a notification when we post a new tutorial",
            "tip.state.subscribed": "You're subscribed to new tutorial notifications",
            'tip.state.blocked': "You've blocked notifications",
            'message.prenotify': 'Click to subscribe to notifications',
            "message.action.subscribed": "Great, we'll let you know when the next tutorial comes out!",
            'message.action.resubscribed': "You're subscribed to notifications",
            'message.action.unsubscribed': "You won't receive notifications again",
            'dialog.main.title': 'Manage Site Notifications',
            'dialog.main.button.subscribe': 'SUBSCRIBE',
            'dialog.main.button.unsubscribe': 'UNSUBSCRIBE',
            'dialog.blocked.title': 'Unblock Notifications',
            'dialog.blocked.message': "Follow these instructions to allow notifications:"
          },
          
        },
      });
    });
  </script>
  

  
  <script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "Article",
    "headline": "Build an LLM RAG Chatbot With LangChain",
    
    "image": {
      "@type": "ImageObject",
      "url": "https://files.realpython.com/media/Build-a-LLM-Application-with-LangChain_Watermarked.b9d023202ad2.jpg",
      "width": 1920,
      "height": 1080
    },
    
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "https://realpython.com/build-llm-rag-chatbot-with-langchain/"
    },
    "datePublished": "2024-03-06T14:00:00+00:00",
    "dateModified": "2024-03-19T23:50:25.538108+00:00",
     "publisher": {
      "@type": "Organization",
      "name": "Real Python",
      "logo": {
        "@type": "ImageObject",
        "url": "/static/real-python-logo-square-tiny.b2452b6d3823.png",
        "width": 60,
        "height": 60
      }
    },
    "author": {
      "@type": "Organization",
      "name": "Real Python",
      "url": "https://realpython.com",
      "logo": "/static/real-python-logo-square.146e987bf77c.png"
    },
    "description": "Large language models (LLMs) have taken the world by storm, demonstrating unprecedented capabilities in natural language tasks. In this step\u002Dby\u002Dstep tutorial, you\u0027ll leverage LLMs to build your own retrieval\u002Daugmented generation (RAG) chatbot using synthetic data with LangChain and Neo4j."
  }
  </script>
  


    <script src="./Build an LLM RAG Chatbot With LangChain – Real Python_files/optins.12ffd39288e9.js" async=""></script>
    <script src="./Build an LLM RAG Chatbot With LangChain – Real Python_files/autocomplete.7be1f953db49.js" async=""></script>

    

<script>
  var _cio = _cio || [];
  (function(){
      var a,b,c;a=function(f){return function(){_cio.push([f].
      concat(Array.prototype.slice.call(arguments,0)))}};b=["load","identify",
      "sidentify","track","page","on","off"];for(c=0;c<b.length;c++){_cio[b[c]]=a(b[c])};
      var t = document.createElement('script'),
          s = document.getElementsByTagName('script')[0];
      t.async = true;
      t.id    = 'cio-tracker';
      t.setAttribute('data-site-id', '7c2f77c7758d22126955');
      t.setAttribute('data-use-array-params', 'true');
      t.setAttribute('data-in-app-org-id', '0ed756ae-4cd1-4bb7-912c-1b37e39b6595');
      t.setAttribute('data-use-in-app', 'true');
      t.src = 'https://assets.customer.io/assets/track.js';
      s.parentNode.insertBefore(t, s);
  })();
  (function(){
    try {
      var tz = Intl.DateTimeFormat().resolvedOptions().timeZone;
    } catch (e) {
      var tz = null;
    }
    var opts = {
      
      id: 'dad3d522-de2f-4b1e-9b8f-6bbc9fa6200a',
      created_at: 1712122015,
      last_seen_at: 1713090732,
      has_active_subscription: false,
      first_name: 'Raghav',
    };
    if (tz) {
      opts.timezone = tz;
    }
    _cio.identify(opts);
  })();
</script>


    

    

    

    
<script>
  !function(f,b,e,v,n,t,s)
  {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
  n.callMethod.apply(n,arguments):n.queue.push(arguments)};
  if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
  n.queue=[];t=b.createElement(e);t.async=!0;
  t.src=v;s=b.getElementsByTagName(e)[0];
  s.parentNode.insertBefore(t,s)}(window, document,'script',
  'https://connect.facebook.net/en_US/fbevents.js');
  fbq('init', '2220911568135371');
  fbq('track', 'PageView');
</script>
<noscript><img height="1" width="1" style="display:none"
  src="https://www.facebook.com/tr?id=2220911568135371&ev=PageView&noscript=1"
/></noscript>


    

    
<script>!function(e,t,n){function a(){var e=t.getElementsByTagName("script")[0],n=t.createElement("script");n.type="text/javascript",n.async=!0,n.src="https://beacon-v2.helpscout.net",e.parentNode.insertBefore(n,e)}if(e.Beacon=n=function(t,n,a){e.Beacon.readyQueue.push({method:t,options:n,data:a})},n.readyQueue=[],"complete"===t.readyState)return a();e.attachEvent?e.attachEvent("onload",a):e.addEventListener("load",a,!1)}(window,document,window.Beacon||function(){});</script>

<script>
window.Beacon('init', 'f6ddfa28-ffa8-423f-b3b1-50e29e420c43')

Beacon("identify", {
  email: "raghav96@gmail.com",
  name: "Raghav Ravisankar",
  has_active_subscription: "False",
  username: "raghav132",
  userid: "1172783"
});
</script>


  <script>(function(){if (!document.body) return;var js = "window['__CF$cv$params']={r:'8743c34a6d44aae3',t:'MTcxMzA5ODQxMS41MTUwMDA='};_cpo=document.createElement('script');_cpo.nonce='',_cpo.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js',document.getElementsByTagName('head')[0].appendChild(_cpo);";var _0xh = document.createElement('iframe');_0xh.height = 1;_0xh.width = 1;_0xh.style.position = 'absolute';_0xh.style.top = 0;_0xh.style.left = 0;_0xh.style.border = 'none';_0xh.style.visibility = 'hidden';document.body.appendChild(_0xh);function handler() {var _0xi = _0xh.contentDocument || _0xh.contentWindow.document;if (_0xi) {var _0xj = _0xi.createElement('script');_0xj.innerHTML = js;_0xi.getElementsByTagName('head')[0].appendChild(_0xj);}}if (document.readyState !== 'loading') {handler();} else if (window.addEventListener) {document.addEventListener('DOMContentLoaded', handler);} else {var prev = document.onreadystatechange || function () {};document.onreadystatechange = function (e) {prev(e);if (document.readyState !== 'loading') {document.onreadystatechange = prev;handler();}};}})();</script><iframe height="1" width="1" style="position: absolute; top: 0px; left: 0px; border: none; visibility: hidden;" src="./Build an LLM RAG Chatbot With LangChain – Real Python_files/saved_resource(7).html"></iframe>

<div id="onesignal-bell-container" class="onesignal-bell-container onesignal-reset onesignal-bell-container-bottom-left"><div id="onesignal-bell-launcher" class="onesignal-bell-launcher onesignal-bell-launcher-md onesignal-bell-launcher-bottom-left onesignal-bell-launcher-theme-default onesignal-bell-launcher-active"><div class="onesignal-bell-launcher-button"><svg class="onesignal-bell-svg" xmlns="http://www.w3.org/2000/svg" width="99.7" height="99.7" viewBox="0 0 99.7 99.7" style="filter: drop-shadow(0 2px 4px rgba(34,36,38,0.35));; -webkit-filter: drop-shadow(0 2px 4px rgba(34,36,38,0.35));;"><circle class="background" cx="49.9" cy="49.9" r="49.9" style=""></circle><path class="foreground" d="M50.1 66.2H27.7s-2-.2-2-2.1c0-1.9 1.7-2 1.7-2s6.7-3.2 6.7-5.5S33 52.7 33 43.3s6-16.6 13.2-16.6c0 0 1-2.4 3.9-2.4 2.8 0 3.8 2.4 3.8 2.4 7.2 0 13.2 7.2 13.2 16.6s-1 11-1 13.3c0 2.3 6.7 5.5 6.7 5.5s1.7.1 1.7 2c0 1.8-2.1 2.1-2.1 2.1H50.1zm-7.2 2.3h14.5s-1 6.3-7.2 6.3-7.3-6.3-7.3-6.3z" style=""></path><ellipse class="stroke" cx="49.9" cy="49.9" rx="37.4" ry="36.9" style=""></ellipse></svg></div><div class="onesignal-bell-launcher-badge" style="filter: drop-shadow(0 2px 4px rgba(34,36,38,0));; -webkit-filter: drop-shadow(0 2px 4px rgba(34,36,38,0));;"></div><div class="onesignal-bell-launcher-message"><div class="onesignal-bell-launcher-message-body"></div></div><div class="onesignal-bell-launcher-dialog" style="filter: drop-shadow(0px 2px 2px rgba(34,36,38,.15));; -webkit-filter: drop-shadow(0px 2px 2px rgba(34,36,38,.15));;"><div class="onesignal-bell-launcher-dialog-body"></div></div></div></div><div id="G65cdd11b" style="display: none; height: 0px;">
    <div id="gist-embed">
        <style>
            #x-gist-floating-top, #x-gist-floating-top-left, #x-gist-floating-top-right {
                position: fixed;
                top: 0px;
                z-index: 1000000;
            }
            #x-gist-floating-bottom, #x-gist-floating-bottom-left, #x-gist-floating-bottom-right {
                position: fixed;
                bottom: 0px;
                z-index: 1000000;
            }
            #x-gist-bottom, #x-gist-top, #x-gist-floating-top, #x-gist-floating-bottom {
                left: 50%;
                transform: translate(-50%, 0%);
                width: 414px;
            }
            #x-gist-floating-top-left, #x-gist-floating-top-right, #x-gist-floating-bottom-left, #x-gist-floating-bottom-right {
                width: 414px;
            }
            #x-gist-floating-top-right, #x-gist-floating-bottom-right {
                right: 0px;
            }
            #gist-embed {
                position: relative;
                height: 100%;
                width: 100%;
            }
            #gist-embed-container {
                position: relative;
                height: 100%;
                width: 100%;
            }
            #gist-embed-container .gist-frame {
                height: 100%;
                width: 100%;
                border: none;
            }
            @media (max-width: 800px) {
                #x-gist-top, #x-gist-bottom, #x-gist-floating-top, #x-gist-floating-bottom, #x-gist-floating-top-left, #x-gist-floating-top-right, #x-gist-floating-bottom-left, #x-gist-floating-bottom-right {
                width: 100%;
                }
            }
        </style>
        <div id="gist-embed-container">
            <iframe id="gist-ffebe2d0-1325-40a7-b046-baf4b2c03f38" class="gist-frame" src="./Build an LLM RAG Chatbot With LangChain – Real Python_files/index.html"></iframe>
        </div>
    </div></div><div id="beacon-container"><div class="hsds-beacon"><div class="Beacon"><div class="ContainerGradient-sc-62zoy-0 dkxqZi"></div><div class="ContainerFramecss__WrapperUI-sc-d7rzhh-0 iwDBWz BeaconContainer is-configDisplayRight"></div><div class="FabButtonFramecss__FabButtonFrameUI-sc-y1b4md-0 ipeLMS BeaconFabButtonFrame" style="border-radius: 55px; height: 55px; position: fixed; transform: scale(1); width: 104px; z-index: 1049;"><iframe title="Help Scout Beacon - Open" id="" allowtransparency="true" data-cy="FrameComponent" src="./Build an LLM RAG Chatbot With LangChain – Real Python_files/saved_resource(8).html"></iframe></div></div></div></div></body></html>